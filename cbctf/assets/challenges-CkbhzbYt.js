import{j as e,B as d,m as M,r as o,e as Se,t as h}from"./index-D74-Vvq7.js";import{I as O}from"./IconPlus-CxCi8Tai.js";import{I as Fe}from"./IconEdit-BcgJcCls.js";import{I as Q}from"./IconTrash-b1LAdmqV.js";import{c as U}from"./createReactComponent-D1qxsC-S.js";import{A as Me}from"./AdminPagination-B9HcPBMN.js";import{I as V}from"./IconX-CsfapbUz.js";import{I as ze}from"./IconDeviceFloppy-BGbXbvEL.js";import{e as Te,f as _e,h as Ae,r as $e}from"./contest-Dz6z59Rm.js";import{g as Ee,f as He,h as Re,a as Pe}from"./challenge-BIVtKZBf.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Oe=U("outline","bulb","IconBulb",[["path",{d:"M3 12h1m8 -9v1m8 8h1m-15.4 -6.4l.7 .7m12.1 -.7l-.7 .7",key:"svg-0"}],["path",{d:"M9 16a5 5 0 1 1 6 0a3.5 3.5 0 0 0 -1 3a2 2 0 0 1 -4 0a3.5 3.5 0 0 0 -1 -3",key:"svg-1"}],["path",{d:"M9.7 17l4.6 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Be=U("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Le=U("outline","tag","IconTag",[["path",{d:"M7.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M3 6v5.172a2 2 0 0 0 .586 1.414l7.71 7.71a2.41 2.41 0 0 0 3.408 0l5.592 -5.592a2.41 2.41 0 0 0 0 -3.408l-7.71 -7.71a2 2 0 0 0 -1.414 -.586h-5.172a3 3 0 0 0 -3 3z",key:"svg-1"}]]);function De({challenges:u=[],totalCount:b=0,currentPage:l=1,pageSize:p=10,categories:y=[],filterCategory:z="all",filterType:m="all",onPageChange:N,onAddChallenge:T,onEditChallenge:I,onDeleteChallenge:k,onFilterTypeChange:g,onFilterCategoryChange:_}){const C=t=>{const c={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[t.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${c}`,children:t})},w=t=>{const c={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[t]||{label:t,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${c.class}`,children:c.label})},S=t=>!t||t.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map((r,c)=>e.jsx("span",{className:"px-2 py-0.5 bg-black/30 border border-geek-600/30 rounded-full text-xs font-mono text-geek-300",children:r},c))}),f=t=>!t||t.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map((r,c)=>e.jsxs("span",{className:"px-2 py-0.5 bg-black/30 border border-yellow-400/30 rounded text-xs font-mono text-yellow-300",title:r,children:["提示 ",c+1]},c))});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"赛题管理"}),e.jsx(d,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(O,{size:18}),onClick:T,children:"添加赛题"})]}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsxs(d,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${m==="all"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("all"),children:["全部",m==="all"&&e.jsx(M.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(d,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${m==="static"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("static"),children:["静态题目",m==="static"&&e.jsx(M.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(d,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${m==="dynamic"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("dynamic"),children:["动态题目",m==="dynamic"&&e.jsx(M.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(d,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${m==="pods"?"text-geek-400":"text-neutral-400"}`,onClick:()=>g("pods"),children:["容器题目",m==="pods"&&e.jsx(M.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]})]})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:z,onChange:t=>_(t.target.value),className:`w-full h-[38px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                text-neutral-50 placeholder-neutral-500\r
                focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部分类"}),y.map(t=>e.jsx("option",{value:t,children:t},t))]})})]})}),u.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsx(M.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[C(t.category),w(t.type),t.hidden&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-mono bg-red-400/20 text-red-400",children:"隐藏"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>I(t),children:e.jsx(Fe,{size:18})}),e.jsx(d,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>k(t),children:e.jsx(Q,{size:18})})]})]}),e.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:t.desc}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"尝试次数:"}),e.jsx("span",{className:"text-white font-mono",children:t.attempt||0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-geek-400"}),e.jsx("span",{className:"text-neutral-400 font-mono",children:"标签:"}),S(t.tags)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{size:14,className:"text-yellow-400"}),e.jsx("span",{className:"text-neutral-400 font-mono",children:"提示:"}),f(t.hints)]})]})]})},t.id||t.name))}),b>p&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>N(l>1?l-1:1),disabled:l===1,children:"上一页"}),e.jsxs("span",{className:"text-neutral-400 text-sm",children:[l," / ",Math.ceil(b/p)]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>N(l<Math.ceil(b/p)?l+1:Math.ceil(b/p)),disabled:l>=Math.ceil(b/p),children:"下一页"})]})})]})}function Qe({isOpen:u=!1,challenges:b=[],selectedChallenges:l=[],categories:p=[],totalCount:y=0,currentPage:z=1,pageSize:m=10,onClose:N,onSearch:T,onSelect:I,onConfirm:k,onPageChange:g,onFilterCategoryChange:_,onFilterTypeChange:C}){const w="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",S=t=>{const c={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[t.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${c}`,children:t})},f=t=>{const c={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[t]||{label:t,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${c.class}`,children:c.label})};return u?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs(M.div,{className:"w-full max-w-5xl h-[80vh] bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden flex flex-col",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:"选择赛题"}),e.jsx(d,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:N,children:e.jsx(V,{size:18})})]}),e.jsx("div",{className:"p-4 border-b border-neutral-700",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Be,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",className:`${w} pl-10`,placeholder:"搜索赛题...",onChange:t=>T(t.target.value)})]}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{onChange:t=>_(t.target.value),className:`w-full h-[48px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                  text-neutral-50 placeholder-neutral-500\r
                  focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                  transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部分类"}),p.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{onChange:t=>C(t.target.value),className:`w-full h-[48px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                  text-neutral-50 placeholder-neutral-500\r
                  focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                  transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部类型"}),e.jsx("option",{value:"static",children:"静态题目"}),e.jsx("option",{value:"dynamic",children:"动态题目"}),e.jsx("option",{value:"pods",children:"容器题目"})]})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[b.length===0?e.jsx("div",{className:"flex justify-center items-center h-full border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无匹配赛题"})}):e.jsx("div",{className:"space-y-3",children:b.map(t=>{const r=l.some(c=>c.id===t.id);return e.jsx(M.div,{className:`border rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden transition-colors duration-200 ${r?"border-geek-400":"border-neutral-300/30"}`,whileHover:{y:-1,boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},initial:{opacity:0},animate:{opacity:1},children:e.jsxs("div",{className:"p-3 flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[S(t.category),f(t.type)]})]}),e.jsx("p",{className:"text-neutral-300 text-sm font-mono line-clamp-2",children:t.desc})]}),e.jsx(d,{variant:r?"primary":"outline",size:"icon",className:`w-10 h-10 ${r?"!bg-geek-500 !text-white":""}`,onClick:()=>I(t),children:e.jsx(O,{size:18})})]})},t.id||t.name)})}),y>m&&e.jsx("div",{className:"mt-6",children:e.jsx(Me,{total:Math.ceil(y/m),current:z,pageSize:m,onChange:g,showTotal:!0,totalItems:y})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-neutral-700",children:[e.jsxs("div",{className:"text-neutral-300 font-mono",children:["已选择 ",e.jsx("span",{className:"text-geek-400 font-bold",children:l.length})," 个赛题"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(d,{variant:"ghost",onClick:N,children:"取消"}),e.jsx(d,{variant:"primary",onClick:k,disabled:l.length===0,children:"确认添加"})]})]})]})}):null}function Ue({isOpen:u=!1,mode:b="add",challenge:l={name:"",desc:"",attempt:0,hidden:!1,hints:[""],tags:[""]},flags:p=[{blood:[0,0,0],current_score:1e3,decay:100,id:1,last:"0001-01-01T00:00:00Z",min_score:100,score:1e3,score_type:0,solvers:0,value:""}],onClose:y,onSubmit:z,onChange:m,onAddHint:N,onRemoveHint:T,onHintChange:I,onAddTag:k,onRemoveTag:g,onTagChange:_,onFlagChange:C}){const[w,S]=o.useState([...p]),f=(n,i)=>{const x=[...w];x[n]=i,S(x)};o.useEffect(()=>{S(p)},[p]);const t=n=>{C(n,w[n])},r="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",c=`${r} min-h-[100px] resize-none`,$=`${r} opacity-70 cursor-not-allowed`;return u?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs(M.div,{className:"w-full max-w-2xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:b==="add"?"添加赛题":"编辑赛题"}),e.jsx(d,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:y,children:e.jsx(V,{size:18})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),e.jsx("input",{type:"text",value:l.name,onChange:n=>m({...l,name:n.target.value}),className:r,placeholder:"输入题目名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),e.jsx("textarea",{value:l.desc,onChange:n=>m({...l,desc:n.target.value}),className:c,placeholder:"输入题目描述内容"})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"尝试次数"}),e.jsx("input",{type:"number",value:l.attempt,onChange:n=>m({...l,attempt:parseInt(n.target.value)||0}),className:r,placeholder:"0"})]}),e.jsxs("div",{className:"w-1/3 flex items-center pt-6",children:[e.jsx("input",{type:"checkbox",id:"hidden-checkbox",checked:l.hidden,onChange:n=>m({...l,hidden:n.target.checked}),className:"mr-2 h-4 w-4 accent-geek-400"}),e.jsx("label",{htmlFor:"hidden-checkbox",className:"text-sm font-mono text-neutral-400",children:"隐藏题目"})]})]})]})]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag设置 (不可重复)"})}),w.map((n,i)=>e.jsxs("div",{className:"mb-6 p-4 border border-neutral-700 rounded-md bg-black/20",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("h4",{className:"text-md font-mono text-geek-400",children:["Flag #",i+1]}),e.jsx(d,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300 !bg-geek-500/10 hover:!bg-geek-500/20",onClick:()=>t(i),title:"更新Flag",children:e.jsx(ze,{size:18})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Flag值: static{} uuid{} dynamic{}"}),e.jsx("input",{type:"text",value:n.value,onChange:x=>f(i,{...n,value:x.target.value}),className:r,placeholder:"输入Flag值"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"分数曲线"}),e.jsxs("select",{value:n.score_type,onChange:x=>f(i,{...n,score_type:parseInt(x.target.value)}),className:r,children:[e.jsx("option",{value:0,children:"静态分值"}),e.jsx("option",{value:1,children:"线性衰减"}),e.jsx("option",{value:2,children:"Log衰减"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"初始分值"}),e.jsx("input",{type:"number",value:n.score,onChange:x=>f(i,{...n,score:parseFloat(x.target.value)||0}),className:r,placeholder:"1000",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"当前分值"}),e.jsx("input",{type:"number",value:n.current_score,className:$,placeholder:"1000",disabled:!0})]}),n.score_type!==0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"衰减值"}),e.jsx("input",{type:"number",value:n.decay,onChange:x=>f(i,{...n,decay:parseFloat(x.target.value)||0}),className:r,placeholder:"100",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"最低分值"}),e.jsx("input",{type:"number",value:n.min_score,onChange:x=>f(i,{...n,min_score:parseFloat(x.target.value)||0}),className:r,placeholder:"100",step:"0.1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"解出人数"}),e.jsx("input",{type:"number",value:n.solvers,className:$,placeholder:"0",disabled:!0})]})]})]},i))]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"标签设置"}),e.jsx(d,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(O,{size:16}),onClick:k,children:"添加标签"})]}),e.jsx("div",{className:"space-y-2",children:l.tags.map((n,i)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:n,onChange:x=>_(i,x.target.value),className:r,placeholder:`标签 ${i+1}`}),l.tags.length>1&&e.jsx(d,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>g(i),children:e.jsx(Q,{size:18})})]},i))})]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"提示设置"}),e.jsx(d,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(O,{size:16}),onClick:N,children:"添加提示"})]}),e.jsx("div",{className:"space-y-2",children:l.hints.map((n,i)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:n,onChange:x=>I(i,x.target.value),className:r,placeholder:`提示 ${i+1}`}),l.hints.length>1&&e.jsx(d,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>T(i),children:e.jsx(Q,{size:18})})]},i))})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[e.jsx(d,{variant:"ghost",onClick:y,children:"取消"}),e.jsx(d,{variant:"primary",onClick:()=>z(l,p),children:b==="add"?"添加赛题":"保存更改"})]})]})}):null}function ss(){const{id:u}=Se(),[b,l]=o.useState([]),[p,y]=o.useState(0),[z,m]=o.useState(1),[N,T]=o.useState([]),[I,k]=o.useState([]),[g,_]=o.useState("all"),[C,w]=o.useState("all"),[S,f]=o.useState(!1),[t,r]=o.useState([]),[c,$]=o.useState(""),[n,i]=o.useState([]),[x,W]=o.useState("all"),[q,X]=o.useState("all"),[Z,E]=o.useState(1),[Y,ee]=o.useState(0),[se,G]=o.useState(!1),B=5,[te,L]=o.useState(!1),[D,ae]=o.useState(null),[J,ne]=o.useState([{name:"",desc:"",attempt:0,hidden:!1,hints:[""],tags:[""]}]),[j,F]=o.useState({name:"",desc:"",attempt:0,hidden:!1,hints:[""],tags:[""]}),le=10;o.useEffect(()=>{re()},[]),o.useEffect(()=>{R()},[u]),o.useEffect(()=>{K()},[g,C]);const re=async()=>{try{const s=["Web","Misc","Pwn","Crypto","Reverse"],a=await Ee();if(a.code===200){const v=[...new Set([...s,...a.data||[]])];k(v)}else h.danger({description:a.msg||"获取题目分类失败"}),k(s)}catch(s){console.error("获取题目分类失败:",s),h.danger({description:"获取题目分类失败"}),k(["Web","Misc","Pwn","Crypto","Reverse"])}},K=()=>{if(!N||N.length===0)return;let s=[...N];g!=="all"&&(s=s.filter(a=>a.type===g)),C!=="all"&&(s=s.filter(a=>a.category===C)),l(s),y(s.length)},R=async()=>{try{const s=await Te(parseInt(u));if(s.code===200){const a=s.data===null?[]:s.data;T(a.challenges||[]),g==="all"&&C==="all"?(l(a.challenges||[]),y(a.count||0)):K()}else h.danger({description:s.msg||"获取题目列表失败"})}catch(s){h.danger({description:"获取题目列表失败"}),console.error(s)}},H=async(s=Z,a=x,v=q)=>{G(!0);try{const A={limit:B,offset:(s-1)*B};a!=="all"&&(A.type=a),v!=="all"&&(A.category=v),c&&(A.query=c);const P=await Pe(A);P.code===200?(r(P.data.challenges||[]),ee(P.data.count||0)):h.danger({description:P.msg||"获取题库列表失败"})}catch(A){console.error("获取题库列表失败:",A),h.danger({description:"获取题库列表失败"})}finally{G(!1)}},oe=s=>{_(s)},ie=s=>{w(s)},ce=s=>{W(s),E(1),H(1,s,q)},de=s=>{X(s),E(1),H(1,x,s)},me=s=>{$(s),E(1),H(1)},xe=async s=>{console.log("分页",s),E(s),H(s)},he=async()=>{i([]),$(""),W("all"),X("all"),E(1),await H(1,null,null),f(!0)},ue=s=>{n.some(a=>a.id===s.id)?i(n.filter(a=>a.id!==s.id)):i([...n,s])},pe=async()=>{if(n.length===0){h.warning({description:"请选择要添加的题目"});return}try{const s=await _e(parseInt(u),n.map(a=>a.id));s.code===200?(h.success({description:"添加题目成功"}),f(!1),await R()):h.danger({description:s.msg||"添加题目失败"})}catch(s){console.error("添加题目失败:",s),h.danger({description:"添加题目失败"})}},ge=async s=>{ae(s),F({name:s.name||"",desc:s.desc||"",attempt:s.attempt||0,hidden:s.hidden||!1,hints:s.hints||[""],tags:s.tags||[""]});const a=await He(parseInt(u),s.id);a.code===200?ne(a.data):h.danger({description:a.msg||"获取题目flag失败"}),L(!0)},be=s=>{F(s)},fe=()=>{F({...j,hints:[...j.hints,""]})},je=s=>{const a=[...j.hints];a.splice(s,1),F({...j,hints:a})},ve=(s,a)=>{const v=[...j.hints];v[s]=a,F({...j,hints:v})},ye=()=>{F({...j,tags:[...j.tags,""]})},Ne=s=>{const a=[...j.tags];a.splice(s,1),F({...j,tags:a})},Ce=(s,a)=>{const v=[...j.tags];v[s]=a,F({...j,tags:v})},ke=async s=>{if(D)try{const a=await Ae(parseInt(u),D.id,s);a.code===200?(h.success({description:"更新题目成功"}),L(!1),await R()):h.danger({description:a.msg||"更新题目失败"})}catch(a){console.error("更新题目失败:",a),h.danger({description:"更新题目失败"})}},we=async s=>{try{const a=await $e(parseInt(u),s.id);a.code===200?(h.success({description:"移出题目成功"}),await R()):h.danger({description:a.msg||"移出题目失败"})}catch(a){console.error("移出题目失败:",a),h.danger({description:"移出题目失败"})}},Ie=async(s,a)=>{console.log("flag",a);const v=await Re(parseInt(u),D.id,J[s].id,a);v.code===200?h.success({description:"更新题目flag成功"}):h.danger({description:v.msg||"更新题目flag失败"})};return e.jsxs(e.Fragment,{children:[e.jsx(De,{challenges:b,totalCount:p,currentPage:z,pageSize:le,categories:I,filterCategory:C,filterType:g,onPageChange:m,onAddChallenge:he,onEditChallenge:ge,onDeleteChallenge:we,onFilterTypeChange:oe,onFilterCategoryChange:ie}),e.jsx(Qe,{isOpen:S,challenges:t,selectedChallenges:n,categories:I,totalCount:Y,currentPage:Z,pageSize:B,loading:se,onClose:()=>f(!1),onSearch:me,onSelect:ue,onConfirm:pe,onPageChange:xe,onFilterCategoryChange:de,onFilterTypeChange:ce}),e.jsx(Ue,{isOpen:te,mode:"edit",challenge:j,flags:J,onClose:()=>L(!1),onSubmit:ke,onChange:be,onAddHint:fe,onRemoveHint:je,onHintChange:ve,onAddTag:ye,onRemoveTag:Ne,onTagChange:Ce,onFlagChange:Ie})]})}export{ss as default};
