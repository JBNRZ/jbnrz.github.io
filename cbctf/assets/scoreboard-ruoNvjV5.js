import{r as d,j as e,B as P,m as E,e as L,t as y}from"./index-BsY50m5N.js";import{i as O}from"./contest-Dzromak5.js";import{A as $}from"./AdminPagination-qbTRQxQL.js";import{I as z}from"./IconDownload-DU9N2Cgk.js";import{I as B}from"./IconEdit-CUNHlqcy.js";import{c as H}from"./createReactComponent-rXmKsGNp.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var D=H("outline","refresh","IconRefresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]]);const K={WEB:"bg-blue-400",CRYPTO:"bg-purple-400",PWN:"bg-red-400",REVERSE:"bg-green-400",MISC:"bg-yellow-400"};function U({solved:i,totalSolved:m}){const c=m-Object.values(i).reduce((r,s)=>r+s,0);return e.jsxs("div",{className:"flex items-center justify-center gap-2 w-full",children:[Object.entries(i).map(([r,s])=>s<=0?null:e.jsxs("div",{className:"flex items-center gap-1.5 font-mono text-xs",title:`${r}: ${s}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${K[r]||"bg-gray-400"}`}),e.jsx("span",{className:"text-neutral-300",children:s})]},r)),c>0&&e.jsxs("div",{className:"flex items-center gap-1.5 font-mono text-xs",title:`未解题目: ${c}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-600"}),e.jsx("span",{className:"text-neutral-400",children:c})]})]})}function W({totalTeams:i,totalSolves:m,highestScore:c,totalPlayers:r}){const s=[{label:"Total Teams",value:i,valueClass:"text-neutral-50"},{label:"Total Players",value:r,valueClass:"text-neutral-50"},{label:"Total Solves",value:m,valueClass:"text-geek-400"},{label:"Highest Score",value:c,valueClass:"text-yellow-400"}];return e.jsx("div",{className:"grid grid-cols-4 gap-6",children:s.map((n,x)=>{var u;return e.jsxs(E.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:x*.05},children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:n.label}),e.jsx(E.div,{className:`font-mono text-2xl ${n.valueClass}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:x*.05},children:((u=n.value)==null?void 0:u.toLocaleString())||0})]},x)})})}function F({stats:i,teams:m=[],currentPage:c=1,totalPages:r=1,pageSize:s=6,totalCount:n=0,onPageChange:x,onResetTeamScore:u,onUpdateTeamScore:T,onExportScoreboard:f}){const[A,N]=d.useState(null),[h,g]=d.useState(null),[S,k]=d.useState(""),I=t=>{g(t),k(t.score.toString())},o=()=>{if(h&&T){const t=parseInt(S);isNaN(t)||T(h.id,t)}g(null)},l=()=>{g(null)};return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"积分榜管理"}),e.jsx(P,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(z,{size:18}),onClick:f,children:"导出积分榜"})]}),e.jsx(W,{...i}),e.jsxs(E.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"grid grid-cols-[80px_240px_120px_auto_120px_150px] gap-4 p-4 border-b border-neutral-300/30 place-items-center",children:[e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"RANK"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"TEAM"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"SCORE"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-center",children:"CHALLENGES"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"LAST SUBMIT"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"OPERATIONS"})]}),e.jsx("div",{className:"divide-y divide-neutral-300/10",children:m.length===0?e.jsx("div",{className:"py-12 flex justify-center items-center",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):m.map((t,w)=>e.jsxs(E.div,{className:"grid grid-cols-[80px_240px_120px_auto_120px_150px] gap-4 p-4 hover:bg-neutral-300/5 transition-colors duration-200 place-items-center",onMouseEnter:()=>N(w),onMouseLeave:()=>N(null),children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`font-mono text-xl
                                      ${t.rank===1?"text-yellow-400":t.rank===2?"text-neutral-300":t.rank===3?"text-orange-400":"text-neutral-400"}
                                  `,children:["#",t.rank]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300/30 bg-neutral-700/50 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar||"/default-team-avatar.png"})`}}),e.jsx("span",{className:"text-neutral-50 font-mono",children:t.name})]}),e.jsx("div",{className:"flex items-center justify-end",children:h&&h.id===t.id?e.jsx("input",{type:"number",value:S,onChange:v=>k(v.target.value),className:"w-20 bg-black/50 border border-geek-400 rounded-md p-1 text-neutral-50 font-mono text-center",autoFocus:!0,onKeyDown:v=>{v.key==="Enter"&&o(),v.key==="Escape"&&l()},onBlur:o}):e.jsx("span",{className:"text-geek-400 font-mono",children:t.score.toLocaleString()})}),t.solved&&e.jsx(U,{solved:t.solved,totalSolved:t.totalSolved}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:t.lastSubmit})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(P,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>I(t),children:e.jsx(B,{size:18})}),e.jsx(P,{variant:"ghost",size:"icon",className:"!text-yellow-400 hover:!text-yellow-300",onClick:()=>u==null?void 0:u(t.id),children:e.jsx(D,{size:18})})]})]},w))})]}),n>s&&e.jsx("div",{className:"mt-6",children:e.jsx($,{total:Math.ceil(n/s),current:c,pageSize:s,onChange:x,showTotal:!0,totalItems:n})})]})}function Q(){const{id:i}=L(),[m,c]=d.useState([]),[r,s]=d.useState(0),[n,x]=d.useState(1),[u,T]=d.useState(!0),f=20,[A,N]=d.useState({totalTeams:0,totalSolves:0,highestScore:0,totalPlayers:0});d.useEffect(()=>{h()},[i,n]);const h=async(o=!1)=>{try{const l=await O(parseInt(i),{limit:f,offset:(n-1)*f},o);if(l.code===200){let t;u?t=l.data.teams:t=l.data.teams.filter(a=>!a.hidden);const w=Math.max(...t.map(a=>a.score),0),v=t.reduce((a,j)=>a+j.users,0),R=t.reduce((a,j)=>{var b;const C=((b=j.solved)==null?void 0:b.reduce((p,M)=>p+(M.solved||0),0))||0;return a+C},0);N({totalTeams:t.length,totalSolves:R,highestScore:w,totalPlayers:v});const _=t.map((a,j)=>{const C={};let b=0;return a.solved&&Array.isArray(a.solved)&&a.solved.forEach(p=>{p.category&&(C[p.category]=p.solved||0,b+=p.all||0)}),{...a,rank:(n-1)*f+j+1,lastSubmit:g(a.last),solved:C,totalSolved:b}});c(_),s(l.data.count)}else y.danger({description:l.msg||"获取团队列表失败"})}catch(l){console.error("获取团队列表失败:",l),y.danger({description:"获取团队列表失败"})}},g=o=>!o||o==="0001-01-01T00:00:00Z"?"无提交":new Date(o).toLocaleString(),S=async o=>{y.info({description:"此功能暂未实现"})},k=async(o,l)=>{y.info({description:"此功能暂未实现"})},I=async()=>{y.info({description:"此功能暂未实现"})};return e.jsx(F,{stats:A,teams:m,currentPage:n,pageSize:f,totalCount:r,onPageChange:x,onResetTeamScore:S,onUpdateTeamScore:k,onExportScoreboard:I})}export{Q as default};
