import{r,j as e,m as L,B as E,e as Z,t as v}from"./index-B2OOpqor.js";import{i as q,j as J}from"./contest-CIixa3wg.js";import{A as V}from"./AdminPagination-D7Q5WjX8.js";import{I as Q}from"./IconEdit-ZTILNOb9.js";import{I as X}from"./IconRefresh-BcEs6dkF.js";import{S as ee,I as te}from"./ScoreboardTable-xnuSxJX0.js";import{I as se}from"./IconTable-C4uDu9pa.js";import"./createReactComponent-MT3epsTv.js";const ae={WEB:"bg-blue-400",CRYPTO:"bg-purple-400",PWN:"bg-red-400",REVERSE:"bg-green-400",MISC:"bg-yellow-400"};function ne({solved:i,totalSolved:a}){const d=a-Object.values(i).reduce((c,n)=>c+n,0);return e.jsxs("div",{className:"flex items-center justify-center gap-2 w-full",children:[Object.entries(i).map(([c,n])=>n<=0?null:e.jsxs("div",{className:"flex items-center gap-1.5 font-mono text-xs",title:`${c}: ${n}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${ae[c]||"bg-gray-400"}`}),e.jsx("span",{className:"text-neutral-300",children:n})]},c)),d>0&&e.jsxs("div",{className:"flex items-center gap-1.5 font-mono text-xs",title:`未解题目: ${d}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-600"}),e.jsx("span",{className:"text-neutral-400",children:d})]})]})}function re({totalTeams:i,totalSolves:a,highestScore:d,totalPlayers:c}){const n=[{label:"Total Teams",value:i,valueClass:"text-neutral-50"},{label:"Total Players",value:c,valueClass:"text-neutral-50"},{label:"Total Solves",value:a,valueClass:"text-geek-400"},{label:"Highest Score",value:d,valueClass:"text-yellow-400"}];return e.jsx("div",{className:"grid grid-cols-4 gap-6",children:n.map((m,g)=>{var u;return e.jsxs(L.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:g*.05},children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:m.label}),e.jsx(L.div,{className:`font-mono text-2xl ${m.valueClass}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:g*.05},children:((u=m.value)==null?void 0:u.toLocaleString())||0})]},g)})})}function oe({stats:i,teams:a=[],currentPage:d=1,totalPages:c=1,pageSize:n=6,totalCount:m=0,onPageChange:g,onResetTeamScore:u,onUpdateTeamScore:N,onExportScoreboard:$}){const[D,h]=r.useState(null),[b,C]=r.useState(null),[I,P]=r.useState(""),R=t=>{C(t),P(t.score.toString())},A=()=>{if(b&&N){const t=parseInt(I);isNaN(t)||N(b.id,t)}C(null)},k=()=>{C(null)};return e.jsxs("div",{className:"w-full space-y-6",children:[e.jsx(re,{...i}),e.jsxs(L.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"grid grid-cols-[80px_240px_120px_auto_120px_150px] gap-4 p-4 border-b border-neutral-300/30 place-items-center",children:[e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"RANK"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"TEAM"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"SCORE"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-center",children:"CHALLENGES"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"LAST SUBMIT"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"OPERATIONS"})]}),e.jsx("div",{className:"divide-y divide-neutral-300/10",children:a.length===0?e.jsx("div",{className:"py-12 flex justify-center items-center",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):a.map((t,M)=>e.jsxs(L.div,{className:"grid grid-cols-[80px_240px_120px_auto_120px_150px] gap-4 p-4 hover:bg-neutral-300/5 transition-colors duration-200 place-items-center",onMouseEnter:()=>h(M),onMouseLeave:()=>h(null),children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`font-mono text-xl
                                      ${t.rank===1?"text-yellow-400":t.rank===2?"text-neutral-300":t.rank===3?"text-orange-400":"text-neutral-400"}
                                  `,children:["#",t.rank]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300/30 bg-neutral-700/50 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar||"/default-team-avatar.png"})`}}),e.jsx("span",{className:"text-neutral-50 font-mono",children:t.name})]}),e.jsx("div",{className:"flex items-center justify-end",children:b&&b.id===t.id?e.jsx("input",{type:"number",value:I,onChange:j=>P(j.target.value),className:"w-20 bg-black/50 border border-geek-400 rounded-md p-1 text-neutral-50 font-mono text-center",autoFocus:!0,onKeyDown:j=>{j.key==="Enter"&&A(),j.key==="Escape"&&k()},onBlur:A}):e.jsx("span",{className:"text-geek-400 font-mono",children:t.score.toLocaleString()})}),t.solved&&e.jsx(ne,{solved:t.solved,totalSolved:t.totalSolved}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:t.lastSubmit})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(E,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>R(t),children:e.jsx(Q,{size:18})}),e.jsx(E,{variant:"ghost",size:"icon",className:"!text-yellow-400 hover:!text-yellow-300",onClick:()=>u==null?void 0:u(t.id),children:e.jsx(X,{size:18})})]})]},M))})]}),m>n&&e.jsx("div",{className:"mt-6",children:e.jsx(V,{total:Math.ceil(m/n),current:d,pageSize:n,onChange:g,showTotal:!0,totalItems:m})})]})}function le({teams:i=[],challenges:a=[],totalCount:d=0,currentPage:c=1,pageSize:n=10,onPageChange:m}){return e.jsx(ee,{teams:i,challenges:a,totalCount:d,currentPage:c,pageSize:n,onPageChange:m,isAdmin:!0,PaginationComponent:V})}function he(){const{id:i}=Z(),[a,d]=r.useState("ranking"),[c,n]=r.useState([]),[m,g]=r.useState(0),[u,N]=r.useState(1),[$,D]=r.useState(!0),h=a==="ranking"?20:10,[b,C]=r.useState({totalTeams:0,totalSolves:0,highestScore:0,totalPlayers:0}),[I,P]=r.useState([]),[R,A]=r.useState([]),[k,t]=r.useState(1),[M,j]=r.useState(0),O=10;r.useEffect(()=>{a==="ranking"?K():U()},[i,a,u,k]);const K=async(o=!1)=>{try{const s=await q(parseInt(i),{limit:h,offset:(u-1)*h},o);if(s.code===200){let x;$?x=s.data.teams:x=s.data.teams.filter(l=>!l.hidden);const z=Math.max(...x.map(l=>l.score),0),p=x.reduce((l,T)=>l+T.users,0),f=x.reduce((l,T)=>{var w;const _=((w=T.solved)==null?void 0:w.reduce((y,Y)=>y+(Y.solved||0),0))||0;return l+_},0);C({totalTeams:x.length,totalSolves:f,highestScore:z,totalPlayers:p});const S=x.map((l,T)=>{const _={};let w=0;return l.solved&&Array.isArray(l.solved)&&l.solved.forEach(y=>{y.category&&(_[y.category]=y.solved||0,w+=y.all||0)}),{...l,rank:(u-1)*h+T+1,lastSubmit:W(l.last),solved:_,totalSolved:w}});n(S),g(s.data.count)}else v.danger({description:s.msg||"获取团队列表失败"})}catch(s){console.error("获取团队列表失败:",s),v.danger({description:"获取团队列表失败"})}},U=async()=>{var o;try{const s=await J(parseInt(i),{limit:O,offset:(k-1)*O});if(s.code===200){P(s.data.teams||[]),j(s.data.count||0);const x=[],z=new Map;(o=s.data.teams)==null||o.forEach(p=>{var f;(f=p.challenges)==null||f.forEach(S=>{z.has(S.id)||(z.set(S.id,S),x.push(S))})}),x.sort((p,f)=>p.category!==f.category?p.category.localeCompare(f.category):p.name.localeCompare(f.name)),A(x)}else v.danger({description:s.msg||"获取积分榜失败"})}catch(s){console.error("获取积分榜失败:",s),v.danger({description:"获取积分榜失败"})}},W=o=>!o||o==="0001-01-01T00:00:00Z"?"无提交":new Date(o).toLocaleString(),F=async o=>{v.info({description:"此功能暂未实现"})},G=async(o,s)=>{v.info({description:"此功能暂未实现"})},B=async()=>{v.info({description:"此功能暂未实现"})},H=o=>{d(o),o==="table"?t(1):N(1)};return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"积分榜管理"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-black/30 border border-neutral-300/30 rounded-md",children:[e.jsx(E,{variant:a==="ranking"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(te,{size:16}),onClick:()=>H("ranking"),children:"排名视图"}),e.jsx(E,{variant:a==="table"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(se,{size:16}),onClick:()=>H("table"),children:"表格视图"})]}),e.jsx(E,{variant:"outline",size:"sm",onClick:B,children:"导出积分榜"})]})]}),a==="ranking"?e.jsx(oe,{stats:b,teams:c,currentPage:u,pageSize:h,totalCount:m,onPageChange:N,onResetTeamScore:F,onUpdateTeamScore:G,onExportScoreboard:B}):e.jsx(le,{teams:I,challenges:R,totalCount:M,currentPage:k,pageSize:O,onPageChange:t})]})}export{he as default};
