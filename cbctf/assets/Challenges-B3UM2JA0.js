import{r as p,R as Z,j as e,B as O,m as ie,t as T}from"./index-BE8PTdY9.js";import{I as K}from"./IconPlus-D10H8ZHD.js";import{I as Fe}from"./IconUpload-DDp0ON20.js";import{I as Pe}from"./IconDownload-Dj_R1v-8.js";import{I as Ae}from"./IconEdit-C0RBpQ3d.js";import{I as q}from"./IconTrash-8VnIVa1I.js";import{I as De}from"./IconServer-Cl8Zszn1.js";import{c as pe}from"./createReactComponent-BXxSeqD2.js";import{I as $e}from"./IconChevronRight-CMrt6GdH.js";import{I as ge}from"./IconX-B9WjC-FK.js";import{g as Re,a as Ve,d as He,u as Ue,b as Te,c as We,e as Be}from"./challenge-B7P2P-eo.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ge=pe("outline","chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ye=pe("outline","maximize","IconMaximize",[["path",{d:"M4 8v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M4 16v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M16 20h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var qe=pe("outline","shield","IconShield",[["path",{d:"M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3",key:"svg-0"}]]);function Ke(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function ve(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,a)}return r}function be(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ve(Object(r),!0).forEach(function(a){Ke(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function Xe(t,n){if(t==null)return{};var r={},a=Object.keys(t),l,m;for(m=0;m<a.length;m++)l=a[m],!(n.indexOf(l)>=0)&&(r[l]=t[l]);return r}function Je(t,n){if(t==null)return{};var r=Xe(t,n),a,l;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(t);for(l=0;l<m.length;l++)a=m[l],!(n.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}function Qe(t,n){return Ze(t)||Ie(t,n)||et(t,n)||tt()}function Ze(t){if(Array.isArray(t))return t}function Ie(t,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var r=[],a=!0,l=!1,m=void 0;try{for(var x=t[Symbol.iterator](),M;!(a=(M=x.next()).done)&&(r.push(M.value),!(n&&r.length===n));a=!0);}catch(_){l=!0,m=_}finally{try{!a&&x.return!=null&&x.return()}finally{if(l)throw m}}return r}}function et(t,n){if(typeof t=="string")return je(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return je(t,n)}function je(t,n){(n==null||n>t.length)&&(n=t.length);for(var r=0,a=new Array(n);r<n;r++)a[r]=t[r];return a}function tt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rt(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function ye(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,a)}return r}function Ne(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ye(Object(r),!0).forEach(function(a){rt(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function nt(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(a){return n.reduceRight(function(l,m){return m(l)},a)}}function I(t){return function n(){for(var r=this,a=arguments.length,l=new Array(a),m=0;m<a;m++)l[m]=arguments[m];return l.length>=t.length?t.apply(this,l):function(){for(var x=arguments.length,M=new Array(x),_=0;_<x;_++)M[_]=arguments[_];return n.apply(r,[].concat(l,M))}}}function oe(t){return{}.toString.call(t).includes("Object")}function st(t){return!Object.keys(t).length}function te(t){return typeof t=="function"}function at(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function it(t,n){return oe(n)||X("changeType"),Object.keys(n).some(function(r){return!at(t,r)})&&X("changeField"),n}function ot(t){te(t)||X("selectorType")}function lt(t){te(t)||oe(t)||X("handlerType"),oe(t)&&Object.values(t).some(function(n){return!te(n)})&&X("handlersType")}function ct(t){t||X("initialIsRequired"),oe(t)||X("initialType"),st(t)&&X("initialContent")}function dt(t,n){throw new Error(t[n]||t.default)}var ut={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},X=I(dt)(ut),ne={changes:it,selector:ot,handler:lt,initial:ct};function mt(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ne.initial(t),ne.handler(n);var r={current:t},a=I(xt)(r,n),l=I(pt)(r),m=I(ne.changes)(t),x=I(ft)(r);function M(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(E){return E};return ne.selector(S),S(r.current)}function _(S){nt(a,l,m,x)(S)}return[M,_]}function ft(t,n){return te(n)?n(t.current):n}function pt(t,n){return t.current=Ne(Ne({},t.current),n),n}function xt(t,n,r){return te(n)?n(t.current):Object.keys(r).forEach(function(a){var l;return(l=n[a])===null||l===void 0?void 0:l.call(n,t.current[a])}),r}var ht={create:mt},gt={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function vt(t){return function n(){for(var r=this,a=arguments.length,l=new Array(a),m=0;m<a;m++)l[m]=arguments[m];return l.length>=t.length?t.apply(this,l):function(){for(var x=arguments.length,M=new Array(x),_=0;_<x;_++)M[_]=arguments[_];return n.apply(r,[].concat(l,M))}}}function bt(t){return{}.toString.call(t).includes("Object")}function jt(t){return t||we("configIsRequired"),bt(t)||we("configType"),t.urls?(yt(),{paths:{vs:t.urls.monacoBase}}):t}function yt(){console.warn(Ce.deprecation)}function Nt(t,n){throw new Error(t[n]||t.default)}var Ce={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},we=vt(Nt)(Ce),wt={config:jt},kt=function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return function(l){return r.reduceRight(function(m,x){return x(m)},l)}};function Oe(t,n){return Object.keys(n).forEach(function(r){n[r]instanceof Object&&t[r]&&Object.assign(n[r],Oe(t[r],n[r]))}),be(be({},t),n)}var Ct={type:"cancelation",msg:"operation is manually canceled"};function ue(t){var n=!1,r=new Promise(function(a,l){t.then(function(m){return n?l(Ct):a(m)}),t.catch(l)});return r.cancel=function(){return n=!0},r}var Ot=ht.create({config:gt,isInitialized:!1,resolve:null,reject:null,monaco:null}),ze=Qe(Ot,2),re=ze[0],le=ze[1];function zt(t){var n=wt.config(t),r=n.monaco,a=Je(n,["monaco"]);le(function(l){return{config:Oe(l.config,a),monaco:r}})}function Mt(){var t=re(function(n){var r=n.monaco,a=n.isInitialized,l=n.resolve;return{monaco:r,isInitialized:a,resolve:l}});if(!t.isInitialized){if(le({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),ue(me);if(window.monaco&&window.monaco.editor)return Me(window.monaco),t.resolve(window.monaco),ue(me);kt(_t,Et)(Lt)}return ue(me)}function _t(t){return document.body.appendChild(t)}function St(t){var n=document.createElement("script");return t&&(n.src=t),n}function Et(t){var n=re(function(a){var l=a.config,m=a.reject;return{config:l,reject:m}}),r=St("".concat(n.config.paths.vs,"/loader.js"));return r.onload=function(){return t()},r.onerror=n.reject,r}function Lt(){var t=re(function(r){var a=r.config,l=r.resolve,m=r.reject;return{config:a,resolve:l,reject:m}}),n=window.require;n.config(t.config),n(["vs/editor/editor.main"],function(r){Me(r),t.resolve(r)},function(r){t.reject(r)})}function Me(t){re().monaco||le({monaco:t})}function Ft(){return re(function(t){var n=t.monaco;return n})}var me=new Promise(function(t,n){return le({resolve:t,reject:n})}),_e={config:zt,init:Mt,__getMonacoInstance:Ft},Pt={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},fe=Pt,At={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},Dt=At;function $t({children:t}){return Z.createElement("div",{style:Dt.container},t)}var Rt=$t,Vt=Rt;function Ht({width:t,height:n,isEditorReady:r,loading:a,_ref:l,className:m,wrapperProps:x}){return Z.createElement("section",{style:{...fe.wrapper,width:t,height:n},...x},!r&&Z.createElement(Vt,null,a),Z.createElement("div",{ref:l,style:{...fe.fullWidth,...!r&&fe.hide},className:m}))}var Ut=Ht,Se=p.memo(Ut);function Tt(t){p.useEffect(t,[])}var Ee=Tt;function Wt(t,n,r=!0){let a=p.useRef(!0);p.useEffect(a.current||!r?()=>{a.current=!1}:t,n)}var W=Wt;function ee(){}function Q(t,n,r,a){return Bt(t,a)||Gt(t,n,r,a)}function Bt(t,n){return t.editor.getModel(Le(t,n))}function Gt(t,n,r,a){return t.editor.createModel(n,r,a?Le(t,a):void 0)}function Le(t,n){return t.Uri.parse(n)}function Yt({original:t,modified:n,language:r,originalLanguage:a,modifiedLanguage:l,originalModelPath:m,modifiedModelPath:x,keepCurrentOriginalModel:M=!1,keepCurrentModifiedModel:_=!1,theme:S="light",loading:E="Loading...",options:A={},height:Y="100%",width:V="100%",className:P,wrapperProps:B={},beforeMount:L=ee,onMount:G=ee}){let[w,$]=p.useState(!1),[H,N]=p.useState(!0),c=p.useRef(null),v=p.useRef(null),k=p.useRef(null),C=p.useRef(G),y=p.useRef(L),R=p.useRef(!1);Ee(()=>{let s=_e.init();return s.then(i=>(v.current=i)&&N(!1)).catch(i=>(i==null?void 0:i.type)!=="cancelation"&&console.error("Monaco initialization: error:",i)),()=>c.current?F():s.cancel()}),W(()=>{if(c.current&&v.current){let s=c.current.getOriginalEditor(),i=Q(v.current,t||"",a||r||"text",m||"");i!==s.getModel()&&s.setModel(i)}},[m],w),W(()=>{if(c.current&&v.current){let s=c.current.getModifiedEditor(),i=Q(v.current,n||"",l||r||"text",x||"");i!==s.getModel()&&s.setModel(i)}},[x],w),W(()=>{let s=c.current.getModifiedEditor();s.getOption(v.current.editor.EditorOption.readOnly)?s.setValue(n||""):n!==s.getValue()&&(s.executeEdits("",[{range:s.getModel().getFullModelRange(),text:n||"",forceMoveMarkers:!0}]),s.pushUndoStop())},[n],w),W(()=>{var s,i;(i=(s=c.current)==null?void 0:s.getModel())==null||i.original.setValue(t||"")},[t],w),W(()=>{let{original:s,modified:i}=c.current.getModel();v.current.editor.setModelLanguage(s,a||r||"text"),v.current.editor.setModelLanguage(i,l||r||"text")},[r,a,l],w),W(()=>{var s;(s=v.current)==null||s.editor.setTheme(S)},[S],w),W(()=>{var s;(s=c.current)==null||s.updateOptions(A)},[A],w);let D=p.useCallback(()=>{var f;if(!v.current)return;y.current(v.current);let s=Q(v.current,t||"",a||r||"text",m||""),i=Q(v.current,n||"",l||r||"text",x||"");(f=c.current)==null||f.setModel({original:s,modified:i})},[r,n,l,t,a,m,x]),U=p.useCallback(()=>{var s;!R.current&&k.current&&(c.current=v.current.editor.createDiffEditor(k.current,{automaticLayout:!0,...A}),D(),(s=v.current)==null||s.editor.setTheme(S),$(!0),R.current=!0)},[A,S,D]);p.useEffect(()=>{w&&C.current(c.current,v.current)},[w]),p.useEffect(()=>{!H&&!w&&U()},[H,w,U]);function F(){var i,f,h,b;let s=(i=c.current)==null?void 0:i.getModel();M||((f=s==null?void 0:s.original)==null||f.dispose()),_||((h=s==null?void 0:s.modified)==null||h.dispose()),(b=c.current)==null||b.dispose()}return Z.createElement(Se,{width:V,height:Y,isEditorReady:w,loading:E,_ref:k,className:P,wrapperProps:B})}var qt=Yt;p.memo(qt);function Kt(t){let n=p.useRef();return p.useEffect(()=>{n.current=t},[t]),n.current}var Xt=Kt,se=new Map;function Jt({defaultValue:t,defaultLanguage:n,defaultPath:r,value:a,language:l,path:m,theme:x="light",line:M,loading:_="Loading...",options:S={},overrideServices:E={},saveViewState:A=!0,keepCurrentModel:Y=!1,width:V="100%",height:P="100%",className:B,wrapperProps:L={},beforeMount:G=ee,onMount:w=ee,onChange:$,onValidate:H=ee}){let[N,c]=p.useState(!1),[v,k]=p.useState(!0),C=p.useRef(null),y=p.useRef(null),R=p.useRef(null),D=p.useRef(w),U=p.useRef(G),F=p.useRef(),s=p.useRef(a),i=Xt(m),f=p.useRef(!1),h=p.useRef(!1);Ee(()=>{let d=_e.init();return d.then(o=>(C.current=o)&&k(!1)).catch(o=>(o==null?void 0:o.type)!=="cancelation"&&console.error("Monaco initialization: error:",o)),()=>y.current?g():d.cancel()}),W(()=>{var o,u,j,z;let d=Q(C.current,t||a||"",n||l||"",m||r||"");d!==((o=y.current)==null?void 0:o.getModel())&&(A&&se.set(i,(u=y.current)==null?void 0:u.saveViewState()),(j=y.current)==null||j.setModel(d),A&&((z=y.current)==null||z.restoreViewState(se.get(m))))},[m],N),W(()=>{var d;(d=y.current)==null||d.updateOptions(S)},[S],N),W(()=>{!y.current||a===void 0||(y.current.getOption(C.current.editor.EditorOption.readOnly)?y.current.setValue(a):a!==y.current.getValue()&&(h.current=!0,y.current.executeEdits("",[{range:y.current.getModel().getFullModelRange(),text:a,forceMoveMarkers:!0}]),y.current.pushUndoStop(),h.current=!1))},[a],N),W(()=>{var o,u;let d=(o=y.current)==null?void 0:o.getModel();d&&l&&((u=C.current)==null||u.editor.setModelLanguage(d,l))},[l],N),W(()=>{var d;M!==void 0&&((d=y.current)==null||d.revealLine(M))},[M],N),W(()=>{var d;(d=C.current)==null||d.editor.setTheme(x)},[x],N);let b=p.useCallback(()=>{var d;if(!(!R.current||!C.current)&&!f.current){U.current(C.current);let o=m||r,u=Q(C.current,a||t||"",n||l||"",o||"");y.current=(d=C.current)==null?void 0:d.editor.create(R.current,{model:u,automaticLayout:!0,...S},E),A&&y.current.restoreViewState(se.get(o)),C.current.editor.setTheme(x),M!==void 0&&y.current.revealLine(M),c(!0),f.current=!0}},[t,n,r,a,l,m,S,E,A,x,M]);p.useEffect(()=>{N&&D.current(y.current,C.current)},[N]),p.useEffect(()=>{!v&&!N&&b()},[v,N,b]),s.current=a,p.useEffect(()=>{var d,o;N&&$&&((d=F.current)==null||d.dispose(),F.current=(o=y.current)==null?void 0:o.onDidChangeModelContent(u=>{h.current||$(y.current.getValue(),u)}))},[N,$]),p.useEffect(()=>{if(N){let d=C.current.editor.onDidChangeMarkers(o=>{var j;let u=(j=y.current.getModel())==null?void 0:j.uri;if(u&&o.find(z=>z.path===u.path)){let z=C.current.editor.getModelMarkers({resource:u});H==null||H(z)}});return()=>{d==null||d.dispose()}}return()=>{}},[N,H]);function g(){var d,o;(d=F.current)==null||d.dispose(),Y?A&&se.set(m,y.current.saveViewState()):(o=y.current.getModel())==null||o.dispose(),y.current.dispose()}return Z.createElement(Se,{width:V,height:P,isEditorReady:N,loading:_,_ref:R,className:B,wrapperProps:L})}var Qt=Jt,Zt=p.memo(Qt),ae=Zt;function It({challenges:t=[],totalCount:n=0,currentPage:r=1,pageSize:a=10,categories:l=[],filterCategory:m="all",filterType:x="all",onPageChange:M,onAddChallenge:_,onEditChallenge:S,onDeleteChallenge:E,onUploadAttachment:A,onDownloadAttachment:Y,onFilterTypeChange:V,onFilterCategoryChange:P}){const[B,L]=p.useState({}),G=(c,v)=>{const k=`${c}-${v}`;L(C=>({...C,[k]:!C[k]}))},w=c=>{const k={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[c.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${k}`,children:c})},$=c=>{const k={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[c]||{label:c,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${k.class}`,children:k.label})},H=c=>!c||c.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:c.map((v,k)=>e.jsx("span",{className:"px-2 py-1 bg-black/30 border border-neutral-300/30 rounded text-xs font-mono text-neutral-300",title:v.value,children:v.value.length>15?`${v.value.substring(0,15)}...`:v.value},k))}),N=(c,v)=>!c||c.length===0?null:e.jsxs("div",{className:"mt-3 border-t border-neutral-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(De,{size:14,className:"text-cyan-400"}),e.jsx("span",{className:"text-sm text-neutral-400 font-mono",children:"容器配置："})]}),e.jsx("div",{className:"space-y-2",children:c.map((k,C)=>{const y=`${v}-${C}`,R=B[y];return e.jsxs("div",{className:"p-2 bg-black/40 border border-neutral-300/20 rounded-md text-xs font-mono",children:[e.jsx("div",{className:"flex items-center gap-1 mb-2",children:e.jsxs("span",{className:"text-cyan-400",children:["Docker 组 ",C+1]})}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1 cursor-pointer hover:text-neutral-300 transition-colors",onClick:()=>G(v,C),children:[R?e.jsx(Ge,{size:14,className:"text-neutral-400"}):e.jsx($e,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-neutral-400",children:"YAML 配置"}),e.jsxs("span",{className:"text-neutral-500",children:["(",R?"点击收缩":"点击展开",")"]})]}),R&&e.jsx("div",{className:"border border-neutral-300/20 rounded overflow-hidden",children:e.jsx(ae,{value:k.yaml||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:12,fontFamily:'Consolas, "Courier New", monospace',renderLineHighlight:"none"},height:`${16*k.yaml.split(`
`).length}px`,theme:"vs-dark"})}),!R&&e.jsx("div",{className:"p-2 bg-black/50 border border-neutral-300/20 rounded text-neutral-500 overflow-hidden",children:e.jsx("div",{className:"text-xs",children:k.yaml?e.jsxs(e.Fragment,{children:[k.yaml.split(`
`).slice(0,2).map((D,U)=>e.jsx("div",{className:"truncate",children:D||" "},U)),k.yaml.split(`
`).length>2&&e.jsx("div",{className:"text-neutral-600",children:"..."})]}):e.jsx("div",{className:"truncate",children:"暂无配置"})})})]}),k.network_policies&&k.network_policies.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-neutral-700 border-dashed",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(qe,{size:12,className:"text-geek-400"}),e.jsx("span",{className:"text-neutral-400",children:"网络策略:"})]}),e.jsx("div",{className:"space-y-2 pl-2 mt-1",children:k.network_policies.map((D,U)=>e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"mb-1",children:e.jsxs("span",{className:"text-neutral-300",children:["策略 ",U+1]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 pl-2",children:[D.from&&D.from.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"From:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:D.from.map((F,s)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:F.cidr||"任意"}),F.except&&F.except.length>0&&F.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",F.except.join(", ")]})]},s))})]}),D.to&&D.to.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"To:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:D.to.map((F,s)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:F.cidr||"任意"}),F.except&&F.except.length>0&&F.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",F.except.join(", ")]})]},s))})]})]})]},U))})]})]},C)})})]});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"题目管理"}),e.jsx(O,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(K,{size:16}),onClick:_,children:"添加题目"})]}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"flex gap-8",children:[{id:"all",label:"全部"},{id:"static",label:"静态题目"},{id:"dynamic",label:"动态题目"},{id:"pods",label:"容器题目"}].map(c=>e.jsxs("div",{className:"relative",children:[e.jsx(O,{variant:x===c.id?"primary":"ghost",size:"sm",className:`!px-2 !min-w-0 !border-0 pb-3 ${x===c.id?"!bg-transparent !text-geek-400":"!text-neutral-400"}`,onClick:()=>V(c.id),children:c.label}),x===c.id&&e.jsx(ie.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]},c.id))})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:m,onChange:c=>P(c.target.value),className:`w-full h-[38px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                text-neutral-50 placeholder-neutral-500\r
                focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部分类"}),l.map(c=>e.jsx("option",{value:c,children:c},c))]})})]})}),t.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"space-y-4",children:t.map(c=>e.jsx(ie.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:c.name}),e.jsxs("div",{className:"flex gap-2",children:[w(c.category),$(c.type)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>A(c),children:e.jsx(Fe,{size:18})}),e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>Y(c),children:e.jsx(Pe,{size:18})}),e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>S(c),children:e.jsx(Ae,{size:18})}),e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>E(c),children:e.jsx(q,{size:18})})]})]}),e.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:c.desc}),c.type!=="pods"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"Flags:"}),H(c.flags)]}),c.type==="pods"&&N(c.dockers,c.id||c.name)]})},c.id||c.name))}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"ghost",size:"sm",disabled:r===1,onClick:()=>M(r>1?r-1:1),className:r===1?"!border-neutral-700 !text-neutral-600":"",children:"上一页"}),e.jsxs("span",{className:"text-neutral-400 text-sm",children:[r," / ",Math.ceil(n/a)]}),e.jsx(O,{variant:"ghost",size:"sm",disabled:r>=Math.ceil(n/a),onClick:()=>M(r<Math.ceil(n/a)?r+1:Math.ceil(n/a)),className:r>=Math.ceil(n/a)?"!border-neutral-700 !text-neutral-600":"",children:"下一页"})]})})]})}const ke=`
services:

  test_service:
    image: docker.example.com/example/test_image:123
    expose:
      - "80"
      - "443"
    ports:
      - "8080:80"
    environment:
      - FLAG=static{static_flag}
      - FLAG_2=dynamic{dynamic_flag}
      - FLAG_3=uuid{}
    volumes:
      - FLAG_0:/path/to/flag
    working_dir: /path

  another_service:
    image: docker.example.com/example/test2_image:123
    expose:
      - "80"
      - "443"
    ports:
      - "8080:80"
    environment:
      - FLAG_3=another_env_flag_value
    volumes:
      - FLAG_1:/path/to/another_flag
    working_dir: /path

volumes:
  FLAG_0:
    labels:
      - value=static{static_flag_value}
  FLAG_1:
    labels:
      - value=dynamic{dynamic_flag_value}
`.trim();function er({isOpen:t=!1,mode:n="add",challenge:r={name:"",desc:"",category:"",type:"static",generator_image:"",flags:[""],dockers:[{yaml:"",network_policies:[{from:[{cidr:"",except:[""]}],to:[{cidr:"",except:[""]}]}]}]},categories:a=[],onClose:l,onSubmit:m,onChange:x,onAddFlag:M,onRemoveFlag:_,onFlagChange:S}){const[E,A]=p.useState({isOpen:!1,dockerIndex:null,value:""}),Y=s=>{var i;A({isOpen:!0,dockerIndex:s,value:((i=r.dockers[s])==null?void 0:i.yaml)||ke})},V=()=>{A({isOpen:!1,dockerIndex:null,value:""})},P=()=>{E.dockerIndex!==null&&c(E.dockerIndex,E.value),V()},B=s=>{A(i=>({...i,value:s}))};p.useEffect(()=>{const s=i=>{E.isOpen&&(i.ctrlKey&&i.key==="s"&&(i.preventDefault(),P()),i.key==="Escape"&&(i.preventDefault(),V()))};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[E.isOpen]);const L="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",G=`${L} min-h-[100px] resize-none`,w=`${L} h-[48px] appearance-none`,$=()=>{const s=[...r.dockers||[],{yaml:"",network_policies:[{from:[{cidr:"",except:[""]}],to:[{cidr:"",except:[""]}]}]}];x({...r,dockers:s})},H=s=>{const i=[...r.dockers];i.splice(s,1),x({...r,dockers:i})},N=(s,i)=>{const f=[...r.dockers];f[s]=i,x({...r,dockers:f})},c=(s,i)=>{const f={...r.dockers[s]};f.yaml=i,N(s,f)},v=s=>{const i={...r.dockers[s]};i.network_policies||(i.network_policies=[]),i.network_policies=[...i.network_policies,{from:[{cidr:"",except:[""]}],to:[{cidr:"0.0.0.0/0",except:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","100.64.0.0/10"]}]}],N(s,i)},k=(s,i)=>{const f={...r.dockers[s]};f.network_policies=f.network_policies.filter((h,b)=>b!==i),N(s,f)},C=(s,i,f)=>{const h={...r.dockers[s]},b={...h.network_policies[i]};b[f]=[...b[f],{cidr:"",except:[""]}],h.network_policies[i]=b,N(s,h)},y=(s,i,f,h)=>{const b={...r.dockers[s]},g={...b.network_policies[i]};g[f]=g[f].filter((d,o)=>o!==h),b.network_policies[i]=g,N(s,b)},R=(s,i,f,h,b)=>{const g={...r.dockers[s]},d={...g.network_policies[i]},o={...d[f][h]};o.cidr=b,d[f]=[...d[f]],d[f][h]=o,g.network_policies[i]=d,N(s,g)},D=(s,i,f,h)=>{const b={...r.dockers[s]},g={...b.network_policies[i]},d={...g[f][h]};d.except=[...d.except,""],g[f]=[...g[f]],g[f][h]=d,b.network_policies[i]=g,N(s,b)},U=(s,i,f,h,b)=>{const g={...r.dockers[s]},d={...g.network_policies[i]},o={...d[f][h]};o.except=o.except.filter((u,j)=>j!==b),d[f]=[...d[f]],d[f][h]=o,g.network_policies[i]=d,N(s,g)},F=(s,i,f,h,b,g)=>{const d={...r.dockers[s]},o={...d.network_policies[i]},u={...o[f][h]};u.except=[...u.except],u.except[b]=g,o[f]=[...o[f]],o[f][h]=u,d.network_policies[i]=o,N(s,d)};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:[e.jsxs(ie.div,{className:"w-full max-w-4xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:n==="add"?"添加题目":n==="edit"?"编辑题目":"删除题目"}),e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:l,children:e.jsx(ge,{size:18})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:n==="delete"?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-red-400/20 rounded-full flex items-center justify-center mb-6",children:e.jsx(q,{size:40,className:"text-red-400"})}),e.jsx("h3",{className:"text-2xl font-mono text-neutral-50 mb-4",children:"确认删除题目"}),e.jsx("p",{className:"text-neutral-400 font-mono text-lg mb-2",children:"您确定要删除这个题目吗？"}),e.jsx("p",{className:"text-red-400 font-mono text-sm",children:"⚠️ 此操作无法撤销，请谨慎操作"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>x({...r,name:s.target.value}),className:L,placeholder:"输入题目名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目分类"}),e.jsxs("select",{value:r.category,onChange:s=>x({...r,category:s.target.value}),className:w,children:[e.jsx("option",{value:"",children:"请选择分类"}),a.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目类型"}),e.jsxs("select",{value:r.type,onChange:s=>x({...r,type:s.target.value}),className:w,children:[e.jsx("option",{value:"static",children:"静态题目"}),e.jsx("option",{value:"dynamic",children:"动态题目"}),e.jsx("option",{value:"pods",children:"容器题目"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),e.jsx("textarea",{value:r.desc,onChange:s=>x({...r,desc:s.target.value}),className:G,placeholder:"输入题目描述内容"})]})]})]}),r.type==="dynamic"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Generator 设置"})}),e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"附件生成器镜像"}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("input",{type:"text",value:r.generator_image,onChange:s=>x({...r,generator_image:s.target.value}),className:L})})})]}),r.type!=="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag 设置"}),e.jsx(O,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(K,{size:16}),onClick:M,children:"添加 Flag"})]}),e.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["Flags: ","static{}, uuid{}, dynamic{}"]}),e.jsx("div",{className:"space-y-2",children:r.flags.map((s,i)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:s.value,onChange:f=>S(i,f.target.value),className:L,placeholder:`Flag ${i+1}`}),r.flags.length>1&&e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>_(i),children:e.jsx(q,{size:18})})]},i))})]}),r.type==="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"容器组(Pod)设置"}),n==="add"&&e.jsx(O,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(K,{size:16}),onClick:$,children:"添加容器组(Pod)"}),n==="edit"&&e.jsx("span",{className:"text-xs text-neutral-500",children:"容器组(Pod)配置仅在创建时确定"})]}),e.jsx("div",{className:"space-y-6",children:(r.dockers||[]).map((s,i)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"text-md font-mono text-neutral-50",children:["容器组(Pod) ",i+1]}),n==="add"&&r.dockers.length>1&&e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>H(i),children:e.jsx(q,{size:18})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["docker-compose.yaml",n==="edit"&&e.jsx("span",{className:"ml-2 text-xs text-neutral-500",children:"(只读)"})]}),n==="add"&&e.jsx(O,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(Ye,{size:14}),className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300 !text-xs",onClick:()=>Y(i),children:"全屏编辑"})]}),n==="add"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:e.jsx(ae,{value:s.yaml||ke,onChange:f=>c(i,f),language:"yaml",options:{readOnly:!1,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:14,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:"400px",theme:"vs-dark"})}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-500 font-mono",children:["flag格式: ","`static{}`, `dynamic{}`, `uuid{}`",e.jsx("br",{}),"flag `环境变量` / `文件挂载` 必须以 `FLAG` 为前缀; 变量名可重复，不作为注入时的标识符使用",e.jsx("br",{}),"flag `文件挂载` 通过 labels value 字段指定值",e.jsx("br",{}),"Docker参数只接受: image, expose, ports, environment, volumes, working_dir, command",e.jsx("br",{}),"同一道题目中, 所有的容器名必须唯一, 作为唯一 DNS Hostname",e.jsx("br",{}),"容器组(Pod)内, 容器间通过 Hostname 或 本地地址 通信; 容器组(Pod)外, 容器间通过 Hostname 通信"]})]}):e.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:e.jsx(ae,{value:s.yaml||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",renderLineHighlight:"none"},height:"300px",theme:"vs-dark"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"网络策略"}),e.jsx(O,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(K,{size:14}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>v(i),children:"添加策略"})]}),e.jsx("div",{className:"space-y-4",children:(s.network_policies||[]).map((f,h)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md p-3 bg-black/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h5",{className:"text-sm font-mono text-neutral-200",children:["策略 ",h+1]}),e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>k(i,h),children:e.jsx(q,{size:16})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"入站规则"}),e.jsx(O,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(K,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>C(i,h,"from"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(f.from||[]).map((b,g)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"}),f.from.length>1&&e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>y(i,h,"from",g),children:e.jsx(q,{size:12})})]}),e.jsx("input",{type:"text",value:b.cidr,onChange:d=>R(i,h,"from",g,d.target.value),className:`${L} text-sm mb-2`,placeholder:"CIDR (例如: 192.168.0.0/16)"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"Except"}),e.jsx(O,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(K,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>D(i,h,"from",g),children:"添加"})]}),e.jsx("div",{className:"space-y-2",children:(b.except||[""]).map((d,o)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:d,onChange:u=>F(i,h,"from",g,o,u.target.value),className:`${L} text-sm`,placeholder:"排除 CIDR"}),b.except.length>1&&e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>U(i,h,"from",g,o),children:e.jsx(q,{size:14})})]},o))})]})]},g))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"出站规则"}),e.jsx(O,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(K,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>C(i,h,"to"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(f.to||[]).map((b,g)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"}),f.to.length>1&&e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>y(i,h,"to",g),children:e.jsx(q,{size:12})})]}),e.jsx("input",{type:"text",value:b.cidr,onChange:d=>R(i,h,"to",g,d.target.value),className:`${L} text-sm mb-2`,placeholder:"CIDR (例如: 192.168.0.0/16)"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"Except"}),e.jsx(O,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(K,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>D(i,h,"to",g),children:"添加"})]}),e.jsx("div",{className:"space-y-2",children:(b.except||[""]).map((d,o)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:d,onChange:u=>F(i,h,"to",g,o,u.target.value),className:`${L} text-sm`,placeholder:"排除 CIDR"}),b.except.length>1&&e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>U(i,h,"to",g,o),children:e.jsx(q,{size:14})})]},o))})]})]},g))})]})]},h))})]})]},i))})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:l,children:"取消"}),e.jsx(O,{variant:"primary",size:"sm",onClick:()=>m(r),children:n==="add"?"添加题目":n==="edit"?"保存更改":"确认删除"})]})]}),E.isOpen&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center",children:e.jsxs(ie.div,{className:"w-[95vw] h-[95vh] bg-neutral-900 border border-neutral-700 rounded-lg overflow-hidden",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700 bg-neutral-800",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h3",{className:"text-lg font-mono text-neutral-50",children:["YAML配置编辑器 - 容器组 ",(E.dockerIndex||0)+1]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{variant:"primary",size:"sm",onClick:P,children:"保存"}),e.jsx(O,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:V,children:e.jsx(ge,{size:18})})]})]}),e.jsx("div",{className:"h-[calc(95vh-80px)] overflow-hidden",children:e.jsx(ae,{value:E.value,onChange:B,language:"yaml",options:{readOnly:!1,minimap:{enabled:!0},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:16,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line",automaticLayout:!0,suggest:{showKeywords:!0,showSnippets:!0}},theme:"vs-dark"})}),e.jsxs("div",{className:"absolute bottom-4 left-4 text-xs text-neutral-500 font-mono bg-neutral-800/80 px-3 py-2 rounded border border-neutral-700",children:[e.jsx("div",{children:"使用 Ctrl+S 保存并关闭 • ESC 取消编辑"}),e.jsxs("div",{className:"mt-1",children:["flag格式: static","{}",", dynamic","{}",", uuid","{}"]})]})]})})]}):null}function fr(){const[t,n]=p.useState([]),[r,a]=p.useState(0),[l,m]=p.useState(1),[x,M]=p.useState("all"),[_,S]=p.useState([]),[E,A]=p.useState("all"),[Y,V]=p.useState(!1),[P,B]=p.useState("add"),[L,G]=p.useState(null),[w,$]=p.useState({name:"",desc:"",category:"",type:"static",flags:[""],dockers:[{pod_group:0,flags:[""],image:"",ports:[0],hostname:"",network_policies:[]}]}),H=p.useRef(null),N=10;p.useEffect(()=>{c()},[]),p.useEffect(()=>{v()},[l,x,E]);const c=async()=>{try{const o=await Re();if(o.code===200){const u=["Web","Misc","Pwn","Crypto","Reverse"],j=[...new Set([...u,...o.data||[]])];S(j)}else T.danger({description:o.msg||"获取题目分类失败"}),S(["Web","Misc","Pwn","Crypto","Reverse"])}catch(o){console.error("获取题目分类失败:",o),T.danger({description:"获取题目分类失败"}),S(["Web","Misc","Pwn","Crypto","Reverse"])}},v=async()=>{try{const o={limit:N,offset:(l-1)*N};x!=="all"&&(o.type=x),E!=="all"&&(o.category=E);const u=await Ve(o);u.code===200?(n(u.data.challenges.map(j=>{let z=[];j.flags&&Array.isArray(j.flags)?z=j.flags:j.flag?z=[j.flag]:z=[""];let J=[];return j.docker_groups&&Array.isArray(j.docker_groups)&&j.docker_groups.length>0&&(J=j.docker_groups.map((de,tr)=>{var xe;return{id:de.id,yaml:de.yaml||"",network_policies:((xe=de.network_policies)==null?void 0:xe.map(he=>({from:he.from||[],to:he.to||[]})))||[]}})),{...j,flags:z,docker_groups:J,dockers:J}})),a(u.data.count)):T.danger({description:u.msg||"获取题目列表失败"})}catch(o){T.danger({description:"获取题目列表失败"}),console.error(o)}},k=o=>{M(o),m(1)},C=o=>{A(o),m(1)},y=()=>{B("add"),$({name:"",desc:"",category:"",type:"static",flags:[""],dockers:[{yaml:"",network_policies:[]}]}),V(!0)},R=o=>{B("edit"),G(o),$(o),V(!0)},D=o=>{B("delete"),G(o),V(!0)},U=o=>{var u;(u=H.current)==null||u.click(),G(o)},F=async o=>{try{const u=await He(o.id,"attachment.zip"),j=window.URL.createObjectURL(new Blob([u.data])),z=document.createElement("a");z.href=j,z.setAttribute("download","attachment.zip"),document.body.appendChild(z),z.click(),z.remove()}catch(u){console.error("下载附件失败:",u),T.danger({description:"下载附件失败"})}},s=async o=>{var j;const u=(j=o.target.files)==null?void 0:j[0];if(o.target.value="",!!u){if(L.type==="static"&&u.name!=="attachment.zip"||L.type==="dynamic"&&u.name!=="generator.zip"||L.type==="pods"&&u.name!=="attachment.zip"){T.danger({description:"文件名必须与题目类型匹配"});return}try{const z=await Ue(L.id,u);z.code===200?T.success({description:"上传附件成功"}):T.danger({description:z.msg||"上传附件失败"})}catch(z){console.error("上传附件失败:",z),T.danger({description:"上传附件失败"})}}},i=o=>{$(o)},f=()=>{$({...w,flags:[...w.flags,{id:0,value:""}]})},h=o=>{const u=[...w.flags];u.splice(o,1),$({...w,flags:u})},b=(o,u)=>{const j=[...w.flags];j[o]={id:w.flags[o].id,value:u},$({...w,flags:j})},g=()=>{V(!1)},d=async o=>{try{let u;if(P==="delete")u=await Te(L.id);else{const j={name:o.name,desc:o.desc,category:o.category,type:o.type};if(o.type==="static")j.flags=o.flags||[""];else if(o.type==="dynamic")j.flags=o.flags||[""],j.generator_image=o.generator_image||"";else if(o.type==="pods")o.dockers&&o.dockers.length>0&&(j.docker_groups=o.dockers.map(z=>{var J;return{...z.id&&{id:z.id},yaml:z.yaml||"",network_policies:((J=z.network_policies)==null?void 0:J.map(ce=>({from:ce.from||[],to:ce.to||[]})))||[]}}));else{T.danger({description:"错误的题目类型"});return}P==="add"?u=await We(j):P==="edit"&&(u=await Be(L.id,j))}u.code===200?(T.success({description:`${P==="add"?"创建":P==="edit"?"更新":"删除"}题目成功`}),V(!1),await v()):T.danger({description:u.msg||`${P==="add"?"创建":P==="edit"?"更新":"删除"}题目失败`})}catch(u){console.error(`${P==="add"?"创建":P==="edit"?"更新":"删除"}题目失败:`,u),T.danger({description:`${P==="add"?"创建":P==="edit"?"更新":"删除"}题目失败`})}};return e.jsxs(e.Fragment,{children:[e.jsx(It,{challenges:t,totalCount:r,currentPage:l,pageSize:N,categories:_,filterCategory:E,filterType:x,onPageChange:m,onAddChallenge:y,onEditChallenge:R,onDeleteChallenge:D,onUploadAttachment:U,onDownloadAttachment:F,onFilterTypeChange:k,onFilterCategoryChange:C}),e.jsx(er,{isOpen:Y,mode:P,challenge:w,categories:_,onClose:g,onSubmit:d,onChange:i,onAddFlag:f,onRemoveFlag:h,onFlagChange:b}),e.jsx("input",{type:"file",ref:H,className:"hidden",onChange:s})]})}export{fr as default};
