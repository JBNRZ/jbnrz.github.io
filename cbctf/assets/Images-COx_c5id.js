import{r as c,j as e,m as C,B as I,L as S,b as w,t as j}from"./index-Cr6yBo_s.js";import{A as E}from"./AdminPagination-3ogsZ7vT.js";import{I as z}from"./IconTrash-CyuJpb2M.js";import{I as L}from"./IconUpload-AGl5YKGm.js";import{I as T}from"./IconDownload-DYkXHqio.js";import{A,M}from"./AdminModal-D3Nmo6pC.js";import"./createReactComponent-51hhZont.js";import"./IconX-CUWo3TtQ.js";function B({images:a=[],totalCount:l=0,currentPage:k=1,pageSize:x=12,loading:u=!1,onPageChange:y,onDelete:h,onBatchDelete:i,onDownload:f}){const[n,d]=c.useState([]),b=t=>{if(t===0)return"0 B";const r=1024,g=["B","KB","MB","GB"],v=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,v)).toFixed(2))+" "+g[v]},p=t=>{d(r=>r.includes(t)?r.filter(g=>g!==t):[...r,t])},N=()=>{d(t=>t.length===a.length?[]:a.map(r=>r.id))};return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(C.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-mono text-neutral-50",children:"图片管理"}),e.jsx("div",{className:"flex items-center gap-4",children:n.length>0&&e.jsxs(I,{variant:"danger",size:"sm",align:"icon-left",icon:e.jsx(z,{size:16}),onClick:()=>{i==null||i(n),d([])},children:["批量删除 (",n.length,")"]})})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.length===a.length&&a.length>0,onChange:N,className:"w-4 h-4 rounded border-neutral-300/30 bg-black/30 text-geek-400 focus:ring-0 focus:ring-offset-0"}),e.jsx("span",{className:"text-sm font-mono text-neutral-400",children:"全选"})]}),u?e.jsx(S,{}):a.length===0?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(L,{size:48,className:"text-neutral-400/30"}),e.jsx("span",{className:"text-sm font-mono text-neutral-400",children:"暂无图片"})]})}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6",children:a.map(t=>e.jsxs(C.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 overflow-hidden group",whileHover:{y:-2,borderColor:"rgba(89, 126, 247, 0.5)"},children:[e.jsxs("div",{className:"relative h-48 bg-black/50",children:[e.jsx("img",{src:t.url,alt:t.filename,className:"w-full h-full object-contain"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"!bg-black/50 !text-neutral-300 hover:!text-geek-400",onClick:()=>f==null?void 0:f(t),children:e.jsx(T,{size:20})}),e.jsx(I,{variant:"ghost",size:"icon",className:"!bg-black/50 !text-neutral-300 hover:!text-red-400",onClick:()=>h==null?void 0:h(t),children:e.jsx(z,{size:20})})]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.includes(t.id),onChange:()=>p(t.id),className:"w-4 h-4 rounded border-neutral-300/30 bg-black/30 text-geek-400 focus:ring-0 focus:ring-offset-0"}),e.jsx("span",{className:"text-sm font-mono text-neutral-300 truncate max-w-[150px]",children:t.filename})]}),e.jsx("span",{className:"text-xs font-mono text-neutral-400",children:b(t.size)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-mono text-neutral-400",children:new Date(t.uploadTime).toLocaleDateString()}),e.jsx("span",{className:"text-xs font-mono text-neutral-400 uppercase",children:t.type})]})]})]},t.id))}),l>x&&e.jsx(E,{total:Math.ceil(l/x),current:k,pageSize:x,onChange:y,showTotal:!0,totalItems:l})]})})}function F({limit:a=12,offset:l=0}){return w({url:"/admin/avatars",method:"GET",params:{limit:a,offset:l}})}function P({force:a=!0,file_ids:l=[]}){return w({url:"/admin/avatars",method:"DELETE",data:{force:a,file_ids:l}})}function O(a){return`${w.defaults.baseURL}/avatars/${a}`}function D(){const[a,l]=c.useState([]),[k,x]=c.useState(0),[u,y]=c.useState(1),[h,i]=c.useState(!1),[f,n]=c.useState(!1),[d,b]=c.useState([]),p=12;c.useEffect(()=>{N()},[u]);const N=async()=>{i(!0);try{const s=await F({limit:p,offset:(u-1)*p});if(s.code===200){const o=s.data.avatars.map(m=>({id:m.id,url:O(m.id),filename:m.filename,size:m.size,type:m.type,uploadTime:m.date}));l(o),x(s.data.count)}else j.danger({description:s.msg||"获取图片列表失败"})}catch(s){j.danger({description:"获取图片列表失败"}),console.error(s)}finally{i(!1)}},t=s=>{b([s.id]),n(!0)},r=s=>{b(s),n(!0)},g=s=>{const o=document.createElement("a");o.href=s.url,o.download=s.filename,document.body.appendChild(o),o.click(),o.remove()},v=async()=>{try{const s=await P({force:!0,file_ids:d});s.code===200?(j.success({description:"删除图片成功"}),n(!1),N()):j.danger({description:s.msg||"删除图片失败"})}catch(s){console.error("删除图片失败:",s),j.danger({description:"删除图片失败"})}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{images:a,totalCount:k,currentPage:u,pageSize:p,loading:h,onPageChange:y,onDelete:t,onBatchDelete:r,onDownload:g}),e.jsx(A,{isOpen:f,onClose:()=>n(!1),title:"确认删除",size:"sm",footer:e.jsxs(e.Fragment,{children:[e.jsx(M,{variant:"default",onClick:()=>n(!1),children:"取消"}),e.jsx(M,{variant:"danger",onClick:v,children:"确认"})]}),children:e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("p",{className:"text-neutral-50",children:["确定要删除选中的 ",d.length," 张图片吗？"]}),e.jsx("p",{className:"text-red-400 text-sm mt-2",children:"此操作不可恢复。"})]})})]})}export{D as default};
