import{r as g,j as e,m as p,B as y,d as S,a as A,u as _,t as d,f as k}from"./index-C2v50R19.js";import{u as M,b as $,c as z}from"./system-CXHDZ9k2.js";import{c as P}from"./createReactComponent-5FEVX3_B.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var B=P("outline","lock","IconLock",[["path",{d:"M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z",key:"svg-0"}],["path",{d:"M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0",key:"svg-1"}],["path",{d:"M8 11v-4a4 4 0 1 1 8 0v4",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var L=P("outline","logout","IconLogout",[["path",{d:"M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M9 12h12l-3 -3",key:"svg-1"}],["path",{d:"M18 15l3 -3",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var E=P("outline","user","IconUser",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2",key:"svg-1"}]]);function U({admin:t,onUpdate:w,onPasswordChange:f,onAvatarChange:N,onLogout:l}){const[u,v]=g.useState("profile"),[o,x]=g.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[a,n]=g.useState({currentPassword:"",newPassword:"",confirmPassword:""}),r=[{id:"profile",label:"个人资料",icon:e.jsx(E,{size:18})},{id:"security",label:"安全设置",icon:e.jsx(B,{size:18})},{id:"divider",type:"divider"},{id:"logout",label:"退出登录",icon:e.jsx(L,{size:18}),color:"text-red-400"}],b=s=>{const{name:c,value:i}=s.target;x(m=>({...m,[c]:i}))},j=s=>{const{name:c,value:i}=s.target;c==="newPassword"&&(i&&i.length<6?n(m=>({...m,newPassword:"密码至少需要6个字符"})):n(m=>({...m,newPassword:""}))),c==="confirmPassword"&&o.newPassword&&n(m=>({...m,confirmPassword:i!==o.newPassword?"两次输入的密码不一致":""}))},C=s=>{s.preventDefault();const c={currentPassword:o.currentPassword?"":"请输入当前密码",newPassword:o.newPassword.length<6?"密码至少需要6个字符":"",confirmPassword:o.newPassword!==o.confirmPassword?"两次输入的密码不一致":""};n(c),Object.values(c).some(i=>i)||(f(o),x({currentPassword:"",newPassword:"",confirmPassword:""}),n({currentPassword:"",newPassword:"",confirmPassword:""}))},I=()=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=c=>{const i=c.target.files[0];i&&N(i)},s.click()},h="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200";return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsxs(p.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"p-6 border-b border-neutral-300/30",children:e.jsx("h2",{className:"text-2xl font-mono text-neutral-50",children:"管理员设置"})}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-[240px] border-r border-neutral-300/30 p-4",children:e.jsx("div",{className:"space-y-2",children:r.map(s=>s.type==="divider"?e.jsx("div",{className:"my-4 border-t border-neutral-300/30"},s.id):e.jsx(y,{variant:s.id==="logout"?"danger":u===s.id?"primary":"ghost",size:"sm",align:"icon-left",icon:s.icon,className:`w-full min-w-0 h-[42px] justify-start ${s.id==="logout"?"hover:!bg-red-400/10":u===s.id?"!bg-geek-400/10":"hover:!bg-neutral-700/10"}`,onClick:()=>{s.id==="logout"?l():v(s.id)},children:s.label},s.id))})}),e.jsxs("div",{className:"flex-1 p-6",children:[u==="profile"&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative group",onClick:I,children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar})`}}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center\r
                               bg-black/60 rounded-full opacity-0 group-hover:opacity-100 transition-opacity\r
                               cursor-pointer`,children:e.jsx("span",{className:"text-neutral-200 text-sm font-mono",children:"更换头像"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-neutral-50 font-mono mb-1",children:t.name}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"管理员账户"})]})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),w({name:s.target.name.value,email:s.target.email.value})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-400 text-sm mb-2",children:"用户名"}),e.jsx("input",{name:"name",type:"text",defaultValue:t.name,className:h})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-400 text-sm mb-2",children:"邮箱"}),e.jsx("input",{name:"email",type:"email",defaultValue:t.email,className:h})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-neutral-300/30",children:e.jsx(y,{type:"submit",variant:"primary",size:"sm",children:"保存更改"})})]})]}),u==="security"&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[e.jsxs("form",{onSubmit:C,className:"p-4 border border-neutral-300/30 rounded-md",children:[e.jsx("h3",{className:"text-neutral-50 font-mono mb-4",children:"修改密码"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{name:"currentPassword",type:"password",placeholder:"当前密码",value:o.currentPassword,onChange:b,onBlur:j,className:`${h} ${a.currentPassword?"border-red-400 focus:border-red-400 shadow-[0_0_10px_rgba(248,113,113,0.1)]":""}`,required:!0}),e.jsx(p.div,{initial:{opacity:0,height:0},animate:{opacity:a.currentPassword?1:0,height:a.currentPassword?"auto":0},transition:{duration:.2},children:a.currentPassword&&e.jsx("p",{className:"mt-1 text-red-400 text-sm",children:a.currentPassword})})]}),e.jsxs("div",{children:[e.jsx("input",{name:"newPassword",type:"password",placeholder:"新密码",value:o.newPassword,onChange:b,onBlur:j,className:`${h} ${a.newPassword?"border-red-400 focus:border-red-400 shadow-[0_0_10px_rgba(248,113,113,0.1)]":""}`,required:!0}),e.jsx(p.div,{initial:{opacity:0,height:0},animate:{opacity:a.newPassword?1:0,height:a.newPassword?"auto":0},transition:{duration:.2},children:a.newPassword&&e.jsx("p",{className:"mt-1 text-red-400 text-sm",children:a.newPassword})})]}),e.jsxs("div",{children:[e.jsx("input",{name:"confirmPassword",type:"password",placeholder:"确认新密码",value:o.confirmPassword,onChange:b,onBlur:j,className:`${h} ${a.confirmPassword?"border-red-400 focus:border-red-400 shadow-[0_0_10px_rgba(248,113,113,0.1)]":""}`,required:!0}),e.jsx(p.div,{initial:{opacity:0,height:0},animate:{opacity:a.confirmPassword?1:0,height:a.confirmPassword?"auto":0},transition:{duration:.2},children:a.confirmPassword&&e.jsx("p",{className:"mt-1 text-red-400 text-sm",children:a.confirmPassword})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(y,{type:"submit",variant:"primary",size:"sm",children:"更新密码"})})]})]}),e.jsxs("div",{className:"p-4 border border-geek-400/30 rounded-md bg-geek-400/5",children:[e.jsx("h3",{className:"text-geek-400 font-mono mb-2",children:"账户安全提示"}),e.jsx("p",{className:"text-neutral-400 text-sm mb-4",children:"作为管理员，请确保使用强密码并定期更新。请勿与他人共享您的登录凭据，并确保您的操作设备安全。"})]})]})]})]})]})})}function R(){const{user:t}=S(n=>n.user),w=A(),f=_(),[N,l]=g.useState(!1),u=async n=>{try{l(!0);const r=await M(n);r.code===200?(d.success({description:"个人信息更新成功"}),await w(k(!0))):d.danger({description:r.msg||"更新个人信息失败"})}catch(r){console.error("更新管理员信息失败",r),d.danger({description:"更新个人信息失败"})}finally{l(!1)}},v=async n=>{try{l(!0);const r=await $({old:n.currentPassword,new:n.newPassword});r.code===200?d.success({description:"密码修改成功"}):d.danger({description:r.msg||"密码修改失败"})}catch(r){console.error("更新密码失败",r),d.danger({description:"密码修改失败"})}finally{l(!1)}},o=async n=>{try{l(!0);const r=await z(n);r.code===200?(d.success({description:"头像更新成功"}),await w(k(!0))):d.danger({description:r.msg||"头像更新失败"})}catch(r){console.error("上传头像失败",r),d.danger({description:"头像更新失败"})}finally{l(!1)}},x=()=>{localStorage.removeItem("token"),d.success({description:"已成功退出登录"}),f("/login")},a={name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",avatar:(t==null?void 0:t.avatar)||""};return e.jsx(U,{admin:a,onUpdate:u,onPasswordChange:v,onAvatarChange:o,onLogout:x})}export{R as default};
