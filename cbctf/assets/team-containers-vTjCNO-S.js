import{j as e,B as v,m as b,e as ce,r as n,t as f}from"./index-B2OOpqor.js";import{p as de,q as me,s as xe,t as fe,v as he,w as ue}from"./contest-CIixa3wg.js";import{A as $}from"./AdminPagination-D7Q5WjX8.js";import{c as A}from"./createReactComponent-MT3epsTv.js";import{I as G}from"./IconDownload-CINhcXHo.js";import{I as pe}from"./IconServer-BUMxFNH7.js";import{A as je}from"./AdminModal-gxjqcunZ.js";import"./IconX-CfQf5QeQ.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ge=A("outline","eye","IconEye",[["path",{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var be=A("outline","file-check","IconFileCheck",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M9 15l2 2l4 -4",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ne=A("outline","file","IconFile",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}]]);function ve(r){try{if(r=r.replace(/\s/g,""),!/^[0-9A-Fa-f]*$/.test(r))return"无效的hex数据";const o=new Uint8Array(r.match(/.{1,2}/g).map(d=>parseInt(d,16)));return new TextDecoder("utf-8").decode(o)}catch(o){return console.error("Hex解析错误:",o),"解析错误"}}function we({recentSubmissions:r=[],teamWriteups:o=[],containerTraffic:c=[],submissionCount:d=0,writeupCount:h=0,trafficCount:u=0,currentSubmissionPage:I=1,currentWriteupPage:S=1,currentTrafficPage:w=1,onPageChange:k,onViewTraffic:y,onDownloadTraffic:T,onDownloadWriteup:D,loading:j={submissions:!1,writeups:!1,traffic:!1},activeTab:i="submissions",onTabChange:C}){const M=t=>new Date(t).toLocaleString("zh-CN"),E=t=>t<1024?t+" B":t<1048576?(t/1024).toFixed(2)+" KB":(t/1048576).toFixed(2)+" MB",L=t=>{const m=t/1e9;if(m<60)return`${Math.round(m)}秒`;if(m<3600)return`${Math.floor(m/60)}分钟${Math.round(m%60)}秒`;{const F=Math.floor(m/3600),P=Math.floor(m%3600/60);return`${F}小时${P>0?`${P}分钟`:""}`}},g=t=>Math.ceil(t/10);return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsxs(v,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${i==="submissions"?"text-geek-400":"text-neutral-400"}`,onClick:()=>C("submissions"),children:["最近提交",i==="submissions"&&e.jsx(b.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTabIndicator"})]}),e.jsxs(v,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${i==="writeups"?"text-geek-400":"text-neutral-400"}`,onClick:()=>C("writeups"),children:["题解列表",i==="writeups"&&e.jsx(b.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTabIndicator"})]}),e.jsxs(v,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${i==="traffic"?"text-geek-400":"text-neutral-400"}`,onClick:()=>C("traffic"),children:["靶机流量",i==="traffic"&&e.jsx(b.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTabIndicator"})]})]})}),i==="submissions"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{className:"text-xl font-mono text-neutral-50 flex items-center",children:[e.jsx(be,{size:20,className:"mr-2 text-geek-400"}),"最近提交"]})}),j.submissions?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-geek-500 rounded-full border-t-transparent"})}):r.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无提交记录"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:r.map((t,m)=>e.jsx(b.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden p-4",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"赛题ID:"}),e.jsx("span",{className:"text-white font-mono",children:t.challenge_id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"队伍ID:"}),e.jsx("span",{className:"text-white font-mono",children:t.team_id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"用户ID:"}),e.jsx("span",{className:"text-white font-mono",children:t.user_id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"提交Flag:"}),e.jsx("span",{className:"text-white font-mono max-w-xxs truncate",children:t.value})]})]}),e.jsx("div",{children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-mono ${t.solved?"bg-green-400/20 text-green-400":"bg-red-400/20 text-red-400"}`,children:t.solved?"正确":"错误"})})]})},m))}),e.jsx("div",{className:"mt-6",children:e.jsx($,{total:g(d),current:I,pageSize:10,onChange:t=>k("submissions",t),showTotal:!0,totalItems:d})})]})]}),i==="writeups"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{className:"text-xl font-mono text-neutral-50 flex items-center",children:[e.jsx(Ne,{size:20,className:"mr-2 text-geek-400"}),"题解列表"]})}),j.writeups?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-geek-500 rounded-full border-t-transparent"})}):o.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无题解提交"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:o.map(t=>e.jsx(b.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden p-4",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"提交日期:"}),e.jsx("span",{className:"text-white font-mono",children:M(t.date)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"文件名:"}),e.jsx("span",{className:"text-white font-mono",children:t.filename})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"大小:"}),e.jsx("span",{className:"text-white font-mono",children:E(t.size)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"哈希值:"}),e.jsx("span",{className:"text-white font-mono text-xs max-w-xs truncate",children:t.hash})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"上传者:"}),e.jsx("span",{className:"text-white font-mono",children:t.uploader})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(v,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>D(t),title:"下载题解",children:e.jsx(G,{size:18})})})]})},t.id))}),e.jsx("div",{className:"mt-6",children:e.jsx($,{total:g(h),current:S,pageSize:10,onChange:t=>k("writeups",t),showTotal:!0,totalItems:h})})]})]}),i==="traffic"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{className:"text-xl font-mono text-neutral-50 flex items-center",children:[e.jsx(pe,{size:20,className:"mr-2 text-geek-400"}),"靶机流量"]})}),j.traffic?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-geek-500 rounded-full border-t-transparent"})}):c.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无靶机流量数据"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:c.map(t=>e.jsx(b.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden p-4",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"容器ID:"}),e.jsx("span",{className:"text-white font-mono",children:t.id})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"IP区间:"}),e.jsx("span",{className:"text-white font-mono",children:t.ip_block})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"开始时间:"}),e.jsx("span",{className:"text-white font-mono",children:M(t.start)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"持续时间:"}),e.jsx("span",{className:"text-white font-mono",children:L(t.duration)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"状态:"}),e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-mono ${ye(t.start,t.duration)}`,children:ke(t.start,t.duration)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>y(t),title:"查看流量",children:e.jsx(ge,{size:18})}),e.jsx(v,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>T(t),title:"下载流量文件",children:e.jsx(G,{size:18})})]})]})},t.id))}),e.jsx("div",{className:"mt-6",children:e.jsx($,{total:g(u),current:w,pageSize:10,onChange:t=>k("traffic",t),showTotal:!0,totalItems:u})})]})]})]})}const ke=(r,o)=>{const c=new Date,d=new Date(r),h=o/1e6,u=new Date(d.getTime()+h);return c<d?"未开始":c>u?"已结束":"运行中"},ye=(r,o)=>{const c=new Date,d=new Date(r),h=o/1e6,u=new Date(d.getTime()+h);return c<d?"bg-blue-400/20 text-blue-400":c>u?"bg-red-400/20 text-red-400":"bg-green-400/20 text-green-400"};function $e(){const{id:r,teamId:o}=ce(),[c,d]=n.useState(!1),[h,u]=n.useState(null),[I,S]=n.useState([]),[w,k]=n.useState(0),[y,T]=n.useState(1),[D,j]=n.useState(null),[i,C]=n.useState("submissions"),[W,M]=n.useState([]),[E,L]=n.useState(0),[g,t]=n.useState(1),[m,F]=n.useState([]),[P,J]=n.useState(0),[R,_]=n.useState(1),[Q,X]=n.useState([]),[Y,Z]=n.useState(0),[U,O]=n.useState(1),[H,p]=n.useState({submissions:!1,writeups:!1,traffic:!1,modalTraffic:!1}),N=10,z=6;n.useEffect(()=>{switch(i){case"submissions":q();break;case"writeups":B();break;case"traffic":V();break}},[i]),n.useEffect(()=>{i==="submissions"&&q()},[g]),n.useEffect(()=>{i==="writeups"&&B()},[R]),n.useEffect(()=>{i==="traffic"&&V()},[U]);const q=async()=>{p(s=>({...s,submissions:!0}));try{const s=await de(parseInt(r),parseInt(o),{limit:N,offset:(g-1)*N});s.code===200?(M(s.data.submissions||[]),L(s.data.count||0)):f.danger({description:s.msg||"获取提交记录失败"})}catch(s){console.log(s),f.danger({description:"获取提交记录失败"})}finally{p(s=>({...s,submissions:!1}))}},B=async()=>{p(s=>({...s,writeups:!0}));try{const s=await me(parseInt(r),parseInt(o),{limit:N,offset:(R-1)*N});s.code===200?(F(s.data.writeups||[]),J(s.data.count||0)):f.danger({description:s.msg||"获取题解列表失败"})}catch(s){console.log(s),f.danger({description:"获取题解列表失败"})}finally{p(s=>({...s,writeups:!1}))}},V=async()=>{p(s=>({...s,traffic:!0}));try{const s=await xe(parseInt(r),parseInt(o),{limit:N,offset:(U-1)*N});s.code===200?(X(s.data.victims||[]),Z(s.data.count||0)):f.danger({description:s.msg||"获取容器列表失败"})}catch(s){console.log(s),f.danger({description:"获取容器列表失败"})}finally{p(s=>({...s,traffic:!1}))}},ee=async s=>{u(s),S([]),T(1),p(a=>({...a,modalTraffic:!0})),d(!0);try{await K(s.id)}catch(a){console.log(a),f.danger({description:"操作失败"})}finally{p(a=>({...a,modalTraffic:!1}))}},K=async s=>{try{const a=await fe(parseInt(r),parseInt(o),s,{limit:z,offset:(y-1)*z});a.code===200?(S(a.data.traffics||[]),k(a.data.count||0)):f.danger({description:a.msg||"获取流量数据失败"})}catch(a){console.log(a),f.danger({description:"获取流量数据失败"})}};n.useEffect(()=>{h&&c&&K(h.id)},[y,h,c]);const se=(s,a)=>{switch(s){case"submissions":t(a);break;case"writeups":_(a);break;case"traffic":O(a);break}},te=()=>{d(!1),j(null)},ae=s=>{switch(console.log("切换标签页",s),C(s),s){case"submissions":t(1);break;case"writeups":_(1);break;case"traffic":O(1);break}},ne=async s=>{try{const a=await he(parseInt(r),parseInt(o),s.id),x=window.URL.createObjectURL(new Blob([a.data])),l=document.createElement("a");l.href=x,l.setAttribute("download",`traffic_${s.id}.zip`),document.body.appendChild(l),l.click(),l.parentNode.removeChild(l),window.URL.revokeObjectURL(x)}catch(a){console.log(a),f.danger({description:"下载流量文件失败"})}},re=async s=>{try{const a=await ue(parseInt(r),parseInt(o),s.id),x=window.URL.createObjectURL(new Blob([a.data])),l=document.createElement("a");l.href=x,l.setAttribute("download",`${s.filename}`),document.body.appendChild(l),l.click(),l.parentNode.removeChild(l),window.URL.revokeObjectURL(x)}catch(a){console.log(a),f.danger({description:"下载题解失败"})}},oe=({className:s=""})=>e.jsxs("div",{className:`flex justify-center items-center ${s}`,children:[e.jsxs("div",{className:"relative w-12 h-12",children:[e.jsx("div",{className:"absolute inset-0 border-2 border-t-geek-400 border-r-geek-400 border-b-transparent border-l-transparent rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-1 border-2 border-t-transparent border-r-transparent border-b-geek-400 border-l-geek-400 rounded-full animate-spin animate-delay-150"})]}),e.jsx("span",{className:"ml-3 text-neutral-300 font-mono",children:"加载中..."})]}),le=s=>{j(D===s?null:s)},ie=(s,a)=>{if(!s)return e.jsx("span",{className:"text-neutral-400",children:"空"});try{const x=ve(s),l=D===a;return e.jsxs("div",{children:[e.jsx("div",{onClick:()=>le(a),className:"cursor-pointer font-mono text-sm hover:text-geek-400 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:`line-clamp-2 ${l?"text-geek-400":""}`,children:[x.substring(0,100),x.length>100?"...":""]}),e.jsx("span",{className:"ml-2 text-xs text-neutral-400",children:l?"收起":"展开"})]})}),l&&e.jsx(b.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"mt-2 border border-neutral-800 rounded-md p-3 bg-black/50 max-h-[300px] overflow-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm",children:x})})]})}catch(x){return console.log(x),e.jsx("span",{className:"text-red-400",children:"解析错误"})}};return e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-8",children:"队伍详情"}),e.jsx(we,{recentSubmissions:W,teamWriteups:m,containerTraffic:Q,submissionCount:E,writeupCount:P,trafficCount:Y,currentSubmissionPage:g,currentWriteupPage:R,currentTrafficPage:U,onPageChange:se,onViewTraffic:ee,onDownloadTraffic:ne,onDownloadWriteup:re,loading:H,onTabChange:ae,activeTab:i}),e.jsxs(je,{isOpen:c,onClose:te,title:"容器流量记录",size:"lg",children:[H.modalTraffic?e.jsx(oe,{className:"h-40"}):I.length===0?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无流量数据"})}):e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto pr-2",children:I.map((s,a)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md bg-black/30 p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"类型:"}),e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-mono ${s.type==="request"?"bg-geek-500/20 text-geek-400":s.type==="response"?"bg-green-400/20 text-green-400":"bg-blue-400/20 text-blue-400"}`,children:s.type==="request"?"请求":s.type==="response"?"响应":"TCP"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"源IP:"}),e.jsx("span",{className:"text-white font-mono",children:s.src_ip})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"源端口:"}),e.jsx("span",{className:"text-white font-mono",children:s.src_port})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"时间戳:"}),e.jsx("span",{className:"text-white font-mono",children:new Date(s.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"目标IP:"}),e.jsx("span",{className:"text-white font-mono",children:s.dst_ip})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"目标端口:"}),e.jsx("span",{className:"text-white font-mono",children:s.dst_port})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"负载:"}),e.jsx("div",{className:"mt-2",children:ie(s.payload,a)})]})]},s.id||a))}),w>z&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx($,{total:Math.ceil(w/z),current:y,onChange:T,showTotal:!0,totalItems:w})})]})]})}export{$e as default};
