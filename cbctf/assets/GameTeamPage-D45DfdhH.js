import{j as e,A as S,m as g,B as p,r as f,e as M,u as A,d as D,L as I,t as d}from"./index-zkf441mv.js";import{g as T,a as R,u as z,b as L,k as K,d as $,e as B,f as O}from"./team-CR13uR_B.js";function E({isOpen:t,onClose:l,onConfirm:c,title:m,message:u,confirmText:h="CONFIRM",type:b="default"}){return e.jsx(S,{children:t&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:[e.jsx(g.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l}),e.jsxs(g.div,{className:"relative w-full max-w-[400px] m-4 p-6 border border-neutral-300 rounded-md bg-black/80",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-4",children:m}),e.jsx("p",{className:"text-neutral-300 mb-6",children:u}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:l,children:"CANCEL"}),e.jsx(p,{variant:b==="danger"?"danger":"primary",size:"sm",onClick:c,children:h})]})]})]})})}function P({isOpen:t,onClose:l,team:c,onSave:m}){const[u,h]=f.useState({name:c.name,description:c.description,newLeader:""}),b=r=>{r.preventDefault(),m(u)};return e.jsx(S,{children:t&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:[e.jsx(g.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l}),e.jsxs(g.div,{className:"relative w-full max-w-[600px] m-4 border border-neutral-300 rounded-md bg-black/80",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("div",{className:"p-6 border-b border-neutral-300/30",children:e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Edit Team"})}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-400 text-sm mb-2",children:"Team Name"}),e.jsx("input",{type:"text",value:u.name,onChange:r=>h(o=>({...o,name:r.target.value})),className:`w-full p-3 bg-neutral-900 border border-neutral-300/30 rounded-md\r
                                        text-neutral-50 font-mono\r
                                        focus:outline-none focus:border-geek-400`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-400 text-sm mb-2",children:"Description"}),e.jsx("textarea",{value:u.description,onChange:r=>h(o=>({...o,description:r.target.value})),rows:4,className:`w-full p-3 bg-neutral-900 border border-neutral-300/30 rounded-md\r
                                        text-neutral-50\r
                                        focus:outline-none focus:border-geek-400`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-neutral-400 text-sm mb-2",children:"Transfer Leadership"}),e.jsxs("select",{value:u.newLeader,onChange:r=>h(o=>({...o,newLeader:r.target.value})),className:`w-full p-3 bg-neutral-900 border border-neutral-300/30 rounded-md\r
                                        text-neutral-50 font-mono\r
                                        focus:outline-none focus:border-geek-400`,children:[e.jsx("option",{value:"",children:"Select a new leader"}),c.members.map(r=>e.jsx("option",{value:r.name,children:r.name},r.name))]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:l,children:"CANCEL"}),e.jsx(p,{variant:"primary",size:"sm",type:"submit",children:"SAVE CHANGES"})]})]})]})]})})}function G({team:t,isLeader:l,onCopyCode:c=()=>{},onRefreshCode:m=()=>{},onEditTeam:u=()=>{},onKickMember:h=()=>{},onDisbandTeam:b=()=>{},onAvatarUpload:r=()=>{}}){const[o,w]=f.useState(!1),[C,v]=f.useState(!1),[j,y]=f.useState(null),[k,N]=f.useState(!1),a=()=>{c(),w(!0),setTimeout(()=>w(!1),2e3)},s=n=>{const i=n.target.files[0];n.target.value="",i&&r(i)};return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs(g.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg border-2 border-neutral-300 bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar||"/default-team-avatar.png"})`}}),l&&e.jsxs("label",{className:`absolute inset-0 flex items-center justify-center \r
                                    bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity \r
                                    cursor-pointer rounded-lg`,children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:s}),e.jsx("span",{className:"text-neutral-50 text-sm font-mono",children:"CHANGE"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-50 font-mono text-lg",children:t.name}),e.jsxs("div",{className:"text-neutral-400 text-sm",children:[t.members.length+1," members"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsx(p,{variant:"danger",size:"sm",onClick:()=>N(!0),children:"DISBAND TEAM"}),l&&e.jsx(p,{variant:"primary",size:"sm",onClick:()=>v(!0),children:"EDIT TEAM"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-2",children:"Description"}),e.jsx("div",{className:"p-3 bg-neutral-900 rounded-md",children:e.jsx("p",{className:"text-neutral-300 text-sm",children:t.description||"No team description available."})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:"Invitation Code"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 flex items-center justify-between p-3 bg-neutral-900 rounded-md",children:[e.jsx("span",{className:"font-mono text-neutral-50",children:t.inviteCode}),e.jsx(p,{variant:"ghost",className:"p-0 min-w-0 h-auto",onClick:a,children:o?"✓":"📋"})]}),l&&e.jsx(p,{variant:"primary",size:"icon",className:"border-yellow-400 text-yellow-400 hover:bg-yellow-400/10",onClick:m,children:"↻"})]})]})]}),e.jsxs(g.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx("div",{className:"p-4 border-b border-neutral-300/30",children:e.jsx("h2",{className:"text-neutral-50 font-mono",children:"Team Members"})}),e.jsxs("div",{className:"divide-y divide-neutral-300/10",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg border-2 border-yellow-400 bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${t.leader.avatar})`}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-50 font-mono",children:t.leader.name}),e.jsx("div",{className:"text-yellow-400 text-sm font-mono",children:"LEADER"})]})]}),e.jsx("div",{className:"text-neutral-400 text-sm",children:t.leader.email})]}),t.members.map((n,i)=>e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg border-2 border-neutral-300 bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${n.avatar})`}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-50 font-mono",children:n.name}),e.jsx("div",{className:"text-neutral-400 text-sm font-mono",children:"MEMBER"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:n.email}),l&&e.jsx(p,{variant:"danger",size:"icon",className:"w-6 h-6",onClick:()=>y(n.name),children:"✕"})]})]},i))]})]}),e.jsx(P,{isOpen:C,onClose:()=>v(!1),team:t,onSave:n=>{u(n),v(!1)}}),e.jsx(E,{isOpen:!!j,onClose:()=>y(null),onConfirm:()=>{h(j),y(null)},title:"Kick Member",message:`Are you sure you want to kick ${j} from the team?`,confirmText:"KICK",type:"danger"}),e.jsx(E,{isOpen:k,onClose:()=>N(!1),onConfirm:()=>{b(),N(!1)},title:"Disband Team",message:"Are you sure you want to disband the team? This action cannot be undone.",confirmText:"DISBAND",type:"danger"})]})}function H(){const{contestId:t}=M(),l=A(),[c,m]=f.useState(null),[u,h]=f.useState(!0),[b,r]=f.useState(!1),o=D(a=>a.user.user),w=async(a,s)=>{const n=s.find(x=>x.id===a.captain_id),i=s.filter(x=>x.id!==a.captain_id);return{name:a.name,avatar:a.avatar,description:a.desc,inviteCode:await O(t).then(x=>x.data),leader:{name:n.name,avatar:n.avatar,email:n.email},members:i.map(x=>({name:x.name,avatar:x.avatar,email:x.email}))}};f.useEffect(()=>{(async()=>{try{const[s,n]=await Promise.all([T(t),R(t)]);if(console.log(s,"teamInfoRes",n,"membersRes"),s.code===200&&n.code===200){const i=await w(s.data,n.data);m(i),r((o==null?void 0:o.id)===s.data.captain_id)}else throw new Error(s.msg||n.msg||"获取队伍信息失败")}catch(s){d.danger({title:"获取队伍信息失败",description:s.message})}finally{h(!1)}})()},[t,o]);const C=()=>{navigator.clipboard.writeText(c.inviteCode),d.success({title:"邀请码已复制"})},v=async()=>{try{const a=await z(t);if(a.code===200)m(s=>({...s,inviteCode:a.data})),d.success({title:"邀请码已刷新"});else throw new Error(a.msg||"刷新邀请码失败")}catch(a){d.danger({title:"刷新邀请码失败",description:a.message})}},j=async a=>{try{const s=await L(t,{name:a.name,desc:a.description});if(s.code===200)m(n=>({...n,name:a.name,description:a.description})),d.success({title:"队伍信息已更新"});else throw new Error(s.msg||"更新队伍信息失败")}catch(s){d.danger({title:"更新队伍信息失败",description:s.message})}},y=async a=>{try{const s=c.members.find(i=>i.name===a);if(!s)return;const n=await K(t,s.id);if(n.code===200)m(i=>({...i,members:i.members.filter(x=>x.name!==a)})),d.warning({title:"队员已移除",description:`${a} 已被移出队伍`});else throw new Error(n.msg||"移除队员失败")}catch(s){d.danger({title:"移除队员失败",description:s.message})}},k=async()=>{try{const a=await $(t);if(a.code===200)d.success({title:"队伍已解散"}),l(`/contests/${t}`);else throw new Error(a.msg||"解散队伍失败")}catch(a){d.danger({title:"解散队伍失败",description:a.message})}},N=async a=>{try{const s=await B(t,a);if(s.code===200){const n=await T(t);n.code===200&&(m(i=>({...i,avatar:n.data.avatar})),d.success({title:"头像已更新"}))}else throw new Error(s.msg||"上传头像失败")}catch(s){d.danger({title:"上传头像失败",description:s.message})}};return u?e.jsx(I,{}):c?e.jsx(G,{team:c,isLeader:b,onCopyCode:C,onRefreshCode:v,onEditTeam:j,onKickMember:y,onDisbandTeam:k,onAvatarUpload:N}):e.jsx("div",{className:"flex items-center justify-center min-h-[500px]",children:e.jsx("span",{className:"text-neutral-300",children:"暂无队伍信息"})})}export{H as default};
