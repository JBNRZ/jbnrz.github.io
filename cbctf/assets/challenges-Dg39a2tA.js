import{j as e,B as m,m as I,r as o,e as Se,t as h}from"./index-C2v50R19.js";import{I as O}from"./IconPlus-rvp4yk3l.js";import{I as Fe}from"./IconEdit-BhoRorwb.js";import{I as D}from"./IconTrash-DgVydjXk.js";import{c as K}from"./createReactComponent-5FEVX3_B.js";import{A as Me}from"./AdminPagination-Dwq4Ddos.js";import{I as V}from"./IconX-DoMMG-7_.js";import{I as ze}from"./IconSearch-CZ5_YS-J.js";import{I as Te}from"./IconDeviceFloppy-BIfsRVz5.js";import{e as _e,f as Ae,h as $e,r as Ee}from"./contest-DvGwVayd.js";import{g as He,f as Re,h as Le,a as Pe}from"./challenge-BSN6wsF7.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var qe=K("outline","bulb","IconBulb",[["path",{d:"M3 12h1m8 -9v1m8 8h1m-15.4 -6.4l.7 .7m12.1 -.7l-.7 .7",key:"svg-0"}],["path",{d:"M9 16a5 5 0 1 1 6 0a3.5 3.5 0 0 0 -1 3a2 2 0 0 1 -4 0a3.5 3.5 0 0 0 -1 -3",key:"svg-1"}],["path",{d:"M9.7 17l4.6 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Be=K("outline","tag","IconTag",[["path",{d:"M7.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M3 6v5.172a2 2 0 0 0 .586 1.414l7.71 7.71a2.41 2.41 0 0 0 3.408 0l5.592 -5.592a2.41 2.41 0 0 0 0 -3.408l-7.71 -7.71a2 2 0 0 0 -1.414 -.586h-5.172a3 3 0 0 0 -3 3z",key:"svg-1"}]]);function Oe({challenges:p=[],totalCount:b=0,currentPage:l=1,pageSize:g=10,categories:y=[],filterCategory:z="all",filterType:c="all",onPageChange:N,onAddChallenge:T,onEditChallenge:S,onDeleteChallenge:k,onFilterTypeChange:u,onFilterCategoryChange:_}){const C=s=>{const d={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[s.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${d}`,children:s})},w=s=>{const d={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},question:{label:"问答题目",class:"bg-geek-400/20 text-geek-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[s]||{label:s,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${d.class}`,children:d.label})},F=s=>!s||s.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:s.map((r,d)=>e.jsx("span",{className:"px-2 py-0.5 bg-black/30 border border-geek-600/30 rounded-full text-xs font-mono text-geek-300",children:r},d))}),f=s=>!s||s.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:s.map((r,d)=>e.jsxs("span",{className:"px-2 py-0.5 bg-black/30 border border-yellow-400/30 rounded text-xs font-mono text-yellow-300",title:r,children:["提示 ",d+1]},d))});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"赛题管理"}),e.jsx(m,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(O,{size:18}),onClick:T,children:"添加赛题"})]}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsxs(m,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="all"?"text-geek-400":"text-neutral-400"}`,onClick:()=>u("all"),children:["全部",c==="all"&&e.jsx(I.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(m,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="static"?"text-geek-400":"text-neutral-400"}`,onClick:()=>u("static"),children:["静态题目",c==="static"&&e.jsx(I.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(m,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="question"?"text-geek-400":"text-neutral-400"}`,onClick:()=>u("question"),children:["问答题目",c==="question"&&e.jsx(I.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(m,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="dynamic"?"text-geek-400":"text-neutral-400"}`,onClick:()=>u("dynamic"),children:["动态题目",c==="dynamic"&&e.jsx(I.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]}),e.jsxs(m,{variant:"ghost",className:`pb-3 px-2 relative font-mono text-sm ${c==="pods"?"text-geek-400":"text-neutral-400"}`,onClick:()=>u("pods"),children:["容器题目",c==="pods"&&e.jsx(I.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]})]})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:z,onChange:s=>_(s.target.value),className:`w-full h-[38px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                text-neutral-50 placeholder-neutral-500\r
                focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部分类"}),y.map(s=>e.jsx("option",{value:s,children:s},s))]})})]})}),p.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"space-y-4",children:p.map(s=>e.jsx(I.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[C(s.category),w(s.type),s.hidden&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-mono bg-red-400/20 text-red-400",children:"隐藏"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>S(s),children:e.jsx(Fe,{size:18})}),e.jsx(m,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>k(s),children:e.jsx(D,{size:18})})]})]}),e.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:s.desc}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"尝试次数:"}),e.jsx("span",{className:"text-white font-mono",children:s.attempt||0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{size:14,className:"text-geek-400"}),e.jsx("span",{className:"text-neutral-400 font-mono",children:"标签:"}),F(s.tags)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{size:14,className:"text-yellow-400"}),e.jsx("span",{className:"text-neutral-400 font-mono",children:"提示:"}),f(s.hints)]})]})]})},s.id||s.name))}),b>g&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>N(l>1?l-1:1),disabled:l===1,children:"上一页"}),e.jsxs("span",{className:"text-neutral-400 text-sm",children:[l," / ",Math.ceil(b/g)]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>N(l<Math.ceil(b/g)?l+1:Math.ceil(b/g)),disabled:l>=Math.ceil(b/g),children:"下一页"})]})})]})}function De({isOpen:p=!1,challenges:b=[],selectedChallenges:l=[],categories:g=[],totalCount:y=0,currentPage:z=1,pageSize:c=10,onClose:N,onSearch:T,onSelect:S,onConfirm:k,onPageChange:u,onFilterCategoryChange:_,onFilterTypeChange:C}){const w="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",F=s=>{const d={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[s.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${d}`,children:s})},f=s=>{const d={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},question:{label:"问答题目",class:"bg-geek-400/20 text-geek-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[s]||{label:s,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${d.class}`,children:d.label})};return p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs(I.div,{className:"w-full max-w-5xl h-[80vh] bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden flex flex-col",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:"选择赛题"}),e.jsx(m,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:N,children:e.jsx(V,{size:18})})]}),e.jsx("div",{className:"p-4 border-b border-neutral-700",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ze,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",className:`${w} pl-10`,placeholder:"搜索赛题...",onChange:s=>T(s.target.value)})]}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{onChange:s=>_(s.target.value),className:`w-full h-[48px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                  text-neutral-50 placeholder-neutral-500\r
                  focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                  transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部分类"}),g.map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{onChange:s=>C(s.target.value),className:`w-full h-[48px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                  text-neutral-50 placeholder-neutral-500\r
                  focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                  transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部类型"}),e.jsx("option",{value:"static",children:"静态题目"}),e.jsx("option",{value:"question",children:"问答题目"}),e.jsx("option",{value:"dynamic",children:"动态题目"}),e.jsx("option",{value:"pods",children:"容器题目"})]})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[b.length===0?e.jsx("div",{className:"flex justify-center items-center h-full border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无匹配赛题"})}):e.jsx("div",{className:"space-y-3",children:b.map(s=>{const r=l.some(d=>d.id===s.id);return e.jsx(I.div,{className:`border rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden transition-colors duration-200 ${r?"border-geek-400":"border-neutral-300/30"}`,whileHover:{y:-1,boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},initial:{opacity:0},animate:{opacity:1},children:e.jsxs("div",{className:"p-3 flex items-start gap-3",children:[e.jsx("div",{className:`w-5 h-5 border-2 cursor-pointer transition-all duration-200 flex items-center justify-center flex-shrink-0 mt-1 ${r?"bg-geek-400 border-geek-400 text-white":"border-neutral-400 text-transparent hover:border-geek-400 hover:bg-geek-400/10"}`,onClick:()=>S(s),children:r&&e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20,6 9,17 4,12"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[F(s.category),f(s.type)]})]}),e.jsx("p",{className:"text-neutral-300 text-sm font-mono line-clamp-2",children:s.desc})]})]})},s.id||s.name)})}),y>c&&e.jsx("div",{className:"mt-6",children:e.jsx(Me,{total:Math.ceil(y/c),current:z,pageSize:c,onChange:u,showTotal:!0,totalItems:y})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-neutral-700",children:[e.jsxs("div",{className:"text-neutral-300 font-mono",children:["已选择 ",e.jsx("span",{className:"text-geek-400 font-bold",children:l.length})," 个赛题"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(m,{variant:"ghost",onClick:N,children:"取消"}),e.jsx(m,{variant:"primary",onClick:k,disabled:l.length===0,children:"确认添加"})]})]})]})}):null}function We({isOpen:p=!1,mode:b="add",challenge:l={name:"",desc:"",attempt:0,hidden:!1,hints:[],tags:[]},flags:g=[{blood:[0,0,0],current_score:1e3,decay:100,id:1,last:"0001-01-01T00:00:00Z",min_score:100,score:1e3,score_type:0,solvers:0,value:""}],onClose:y,onSubmit:z,onChange:c,onAddHint:N,onRemoveHint:T,onHintChange:S,onAddTag:k,onRemoveTag:u,onTagChange:_,onFlagChange:C}){const[w,F]=o.useState([...g]),f=(n,i)=>{const x=[...w];x[n]=i,F(x)};o.useEffect(()=>{F(g)},[g]);const s=n=>{C(n,w[n])},r="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",d=`${r} min-h-[100px] resize-none`,$=`${r} opacity-70 cursor-not-allowed`;return p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs(I.div,{className:"w-full max-w-2xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:b==="add"?"添加赛题":"编辑赛题"}),e.jsx(m,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:y,children:e.jsx(V,{size:18})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),e.jsx("input",{type:"text",value:l.name,onChange:n=>c({...l,name:n.target.value}),className:r,placeholder:"输入题目名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),e.jsx("textarea",{value:l.desc,onChange:n=>c({...l,desc:n.target.value}),className:d,placeholder:"输入题目描述内容"})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"尝试次数"}),e.jsx("input",{type:"number",value:l.attempt,onChange:n=>c({...l,attempt:parseInt(n.target.value)||0}),className:r,placeholder:"0"})]}),e.jsxs("div",{className:"w-1/3 flex items-center pt-6",children:[e.jsx("input",{type:"checkbox",id:"hidden-checkbox",checked:l.hidden,onChange:n=>c({...l,hidden:n.target.checked}),className:"mr-2 h-4 w-4 accent-geek-400"}),e.jsx("label",{htmlFor:"hidden-checkbox",className:"text-sm font-mono text-neutral-400",children:"隐藏题目"})]})]})]})]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag设置 (不可重复)"})}),w.map((n,i)=>e.jsxs("div",{className:"mb-6 p-4 border border-neutral-700 rounded-md bg-black/20",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("h4",{className:"text-md font-mono text-geek-400",children:["Flag #",i+1]}),e.jsx(m,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300 !bg-geek-500/10 hover:!bg-geek-500/20",onClick:()=>s(i),title:"更新Flag",children:e.jsx(Te,{size:18})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Flag值: static{} uuid{} dynamic{}"}),e.jsx("input",{type:"text",value:n.value,onChange:x=>f(i,{...n,value:x.target.value}),className:r,placeholder:"输入Flag值"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"分数曲线"}),e.jsxs("select",{value:n.score_type,onChange:x=>f(i,{...n,score_type:parseInt(x.target.value)}),className:r,children:[e.jsx("option",{value:0,children:"静态分值"}),e.jsx("option",{value:1,children:"线性衰减"}),e.jsx("option",{value:2,children:"Log衰减"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"初始分值"}),e.jsx("input",{type:"number",value:n.score,onChange:x=>f(i,{...n,score:parseFloat(x.target.value)||0}),className:r,placeholder:"1000",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"当前分值"}),e.jsx("input",{type:"number",value:n.current_score,className:$,placeholder:"1000",disabled:!0})]}),n.score_type!==0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"衰减值"}),e.jsx("input",{type:"number",value:n.decay,onChange:x=>f(i,{...n,decay:parseFloat(x.target.value)||0}),className:r,placeholder:"100",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"最低分值"}),e.jsx("input",{type:"number",value:n.min_score,onChange:x=>f(i,{...n,min_score:parseFloat(x.target.value)||0}),className:r,placeholder:"100",step:"0.1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"解出人数"}),e.jsx("input",{type:"number",value:n.solvers,className:$,placeholder:"0",disabled:!0})]})]})]},i))]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"标签设置"}),e.jsx(m,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(O,{size:16}),onClick:k,children:"添加标签"})]}),e.jsx("div",{className:"space-y-2",children:l.tags.map((n,i)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:n,onChange:x=>_(i,x.target.value),className:r,placeholder:`标签 ${i+1}`}),e.jsx(m,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>u(i),children:e.jsx(D,{size:18})})]},i))})]}),e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"提示设置"}),e.jsx(m,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(O,{size:16}),onClick:N,children:"添加提示"})]}),e.jsx("div",{className:"space-y-2",children:l.hints.map((n,i)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:n,onChange:x=>S(i,x.target.value),className:r,placeholder:`提示 ${i+1}`}),e.jsx(m,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>T(i),children:e.jsx(D,{size:18})})]},i))})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[e.jsx(m,{variant:"ghost",onClick:y,children:"取消"}),e.jsx(m,{variant:"primary",onClick:()=>z(l,g),children:b==="add"?"添加赛题":"保存更改"})]})]})}):null}function st(){const{id:p}=Se(),[b,l]=o.useState([]),[g,y]=o.useState(0),[z,c]=o.useState(1),[N,T]=o.useState([]),[S,k]=o.useState([]),[u,_]=o.useState("all"),[C,w]=o.useState("all"),[F,f]=o.useState(!1),[s,r]=o.useState([]),[d,$]=o.useState(""),[n,i]=o.useState([]),[x,W]=o.useState("all"),[Q,U]=o.useState("all"),[X,E]=o.useState(1),[Y,ee]=o.useState(0),[te,Z]=o.useState(!1),P=5,[se,q]=o.useState(!1),[B,ae]=o.useState(null),[G,ne]=o.useState([{name:"",desc:"",attempt:0,hidden:!1,hints:[""],tags:[""]}]),[j,M]=o.useState({name:"",desc:"",attempt:0,hidden:!1,hints:[],tags:[]}),le=10;o.useEffect(()=>{re()},[]),o.useEffect(()=>{R()},[p]),o.useEffect(()=>{J()},[u,C]);const re=async()=>{try{const t=["Web","Misc","Pwn","Crypto","Reverse"],a=await He();if(a.code===200){const v=[...new Set([...t,...a.data||[]])];k(v)}else h.danger({description:a.msg||"获取题目分类失败"}),k(t)}catch(t){console.error("获取题目分类失败:",t),h.danger({description:"获取题目分类失败"}),k(["Web","Misc","Pwn","Crypto","Reverse"])}},J=()=>{if(!N||N.length===0)return;let t=[...N];u!=="all"&&(t=t.filter(a=>a.type===u)),C!=="all"&&(t=t.filter(a=>a.category===C)),l(t),y(t.length)},R=async()=>{try{const t=await _e(parseInt(p));if(t.code===200){const a=t.data===null?[]:t.data;T(a.challenges||[]),u==="all"&&C==="all"?(l(a.challenges||[]),y(a.count||0)):J()}else h.danger({description:t.msg||"获取题目列表失败"})}catch(t){h.danger({description:"获取题目列表失败"}),console.error(t)}},H=async(t=X,a=x,v=Q)=>{Z(!0);try{const A={limit:P,offset:(t-1)*P};a!=="all"&&(A.type=a),v!=="all"&&(A.category=v),d&&(A.query=d);const L=await Pe(A);L.code===200?(r(L.data.challenges||[]),ee(L.data.count||0)):h.danger({description:L.msg||"获取题库列表失败"})}catch(A){console.error("获取题库列表失败:",A),h.danger({description:"获取题库列表失败"})}finally{Z(!1)}},oe=t=>{_(t)},ie=t=>{w(t)},ce=t=>{W(t),E(1),H(1,t,Q)},de=t=>{U(t),E(1),H(1,x,t)},me=t=>{$(t),E(1),H(1)},xe=async t=>{console.log("分页",t),E(t),H(t)},he=async()=>{i([]),$(""),W("all"),U("all"),E(1),await H(1,null,null),f(!0)},ue=t=>{n.some(a=>a.id===t.id)?i(n.filter(a=>a.id!==t.id)):i([...n,t])},pe=async()=>{if(n.length===0){h.warning({description:"请选择要添加的题目"});return}try{const t=await Ae(parseInt(p),n.map(a=>a.id));t.code===200?(h.success({description:"添加题目成功"}),f(!1),await R()):h.danger({description:t.msg||"添加题目失败"})}catch(t){console.error("添加题目失败:",t),h.danger({description:"添加题目失败"})}},ge=async t=>{ae(t),M({name:t.name||"",desc:t.desc||"",attempt:t.attempt||0,hidden:t.hidden||!1,hints:t.hints||[],tags:t.tags||[]});const a=await Re(parseInt(p),t.id);a.code===200?ne(a.data):h.danger({description:a.msg||"获取题目flag失败"}),q(!0)},be=t=>{M(t)},fe=()=>{M({...j,hints:[...j.hints,""]})},je=t=>{const a=[...j.hints];a.splice(t,1),M({...j,hints:a})},ve=(t,a)=>{const v=[...j.hints];v[t]=a,M({...j,hints:v})},ye=()=>{M({...j,tags:[...j.tags,""]})},Ne=t=>{const a=[...j.tags];a.splice(t,1),M({...j,tags:a})},Ce=(t,a)=>{const v=[...j.tags];v[t]=a,M({...j,tags:v})},ke=async t=>{if(B)try{const a=await $e(parseInt(p),B.id,t);a.code===200?(h.success({description:"更新题目成功"}),q(!1),await R()):h.danger({description:a.msg||"更新题目失败"})}catch(a){console.error("更新题目失败:",a),h.danger({description:"更新题目失败"})}},we=async t=>{try{const a=await Ee(parseInt(p),t.id);a.code===200?(h.success({description:"移出题目成功"}),await R()):h.danger({description:a.msg||"移出题目失败"})}catch(a){console.error("移出题目失败:",a),h.danger({description:"移出题目失败"})}},Ie=async(t,a)=>{console.log("flag",a);const v=await Le(parseInt(p),B.id,G[t].id,a);v.code===200?h.success({description:"更新题目flag成功"}):h.danger({description:v.msg||"更新题目flag失败"})};return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{challenges:b,totalCount:g,currentPage:z,pageSize:le,categories:S,filterCategory:C,filterType:u,onPageChange:c,onAddChallenge:he,onEditChallenge:ge,onDeleteChallenge:we,onFilterTypeChange:oe,onFilterCategoryChange:ie}),e.jsx(De,{isOpen:F,challenges:s,selectedChallenges:n,categories:S,totalCount:Y,currentPage:X,pageSize:P,loading:te,onClose:()=>f(!1),onSearch:me,onSelect:ue,onConfirm:pe,onPageChange:xe,onFilterCategoryChange:de,onFilterTypeChange:ce}),e.jsx(We,{isOpen:se,mode:"edit",challenge:j,flags:G,onClose:()=>q(!1),onSubmit:ke,onChange:be,onAddHint:fe,onRemoveHint:je,onHintChange:ve,onAddTag:ye,onRemoveTag:Ne,onTagChange:Ce,onFlagChange:Ie})]})}export{st as default};
