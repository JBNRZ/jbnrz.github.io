import{j as e,B as y,m as b,e as I,r as i,t as o}from"./index-sl4cmWVi.js";import{B as S,C}from"./contest-C7UNa2C4.js";import{I as k}from"./IconRefresh-vsUyFrr3.js";import{I as P}from"./IconServer-CJcj2CEI.js";import{I as A}from"./IconDownload-D0dAC_09.js";import"./createReactComponent-B-nHkIKf.js";function W({images:n=[],selectedImages:a=[],pullPolicy:x="IfNotPresent",loading:j=!1,submitting:p=!1,onImageToggle:c,onSelectAll:N,onPullPolicyChange:l,onWarmup:d,onRefresh:f}){const v=t=>t?e.jsx("span",{className:"px-2 py-1 text-xs font-mono rounded border bg-green-400/20 text-green-400 border-green-400/30",children:"已存在"}):e.jsx("span",{className:"px-2 py-1 text-xs font-mono rounded border bg-neutral-400/20 text-neutral-400 border-neutral-400/30",children:"未加载"}),m=[{value:"Always",label:"Always - 总是拉取最新镜像"},{value:"IfNotPresent",label:"IfNotPresent - 本地不存在时拉取"},{value:"Never",label:"Never - 仅使用本地镜像"}];return j?e.jsx("div",{className:"w-full max-w-[1200px] mx-auto",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex items-center gap-3 text-neutral-400",children:[e.jsx("div",{className:"animate-spin",children:e.jsx(k,{size:20})}),e.jsx("span",{className:"font-mono",children:"加载中..."})]})})}):e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"镜像预热"}),e.jsx(y,{variant:"outline",size:"sm",align:"icon-left",icon:e.jsx(k,{size:18}),onClick:f,children:"刷新状态"})]}),e.jsxs(b.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-mono text-neutral-50",children:"预热控制"}),e.jsxs("div",{className:"flex items-center gap-2 text-neutral-400 font-mono text-sm",children:[e.jsx(P,{size:16}),e.jsx("span",{children:"预热比赛中使用到的Docker镜像"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"拉取策略"}),e.jsx("select",{value:x,onChange:t=>l(t.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                         text-neutral-50 font-mono\r
                         focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                         transition-all duration-200`,children:m.map(t=>e.jsx("option",{value:t.value,className:"bg-black/90 text-neutral-50",children:t.label},t.value))})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(y,{variant:"outline",onClick:N,className:"w-full",children:a.length===n.length?"取消全选":"全选"})}),e.jsx("div",{className:"flex items-end",children:e.jsxs(y,{variant:"primary",onClick:d,loading:p,disabled:a.length===0,className:"w-full",align:"icon-left",icon:e.jsx(A,{size:18}),children:["执行预热 (",a.length,")"]})})]})]}),e.jsxs(b.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx("div",{className:"px-6 py-4 border-b border-neutral-300/30",children:e.jsx("h2",{className:"text-lg font-mono text-neutral-50",children:"镜像状态"})}),n.length===0?e.jsx("div",{className:"py-12 flex justify-center items-center",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无镜像数据"})}):e.jsx("div",{className:"divide-y divide-neutral-300/10",children:n.map((t,g)=>{const r=Object.keys(t)[0],s=t[r],u=a.includes(r);return e.jsx(b.div,{className:"p-6 hover:bg-neutral-300/5 transition-colors duration-200",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:g*.05},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"pt-1",children:e.jsx("input",{type:"checkbox",checked:u,onChange:()=>c(r),className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                                   focus:ring-geek-400 focus:ring-offset-0 bg-black/20\r
                                   transition-colors duration-200`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-mono text-neutral-50 mb-4 break-all",children:r}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-3",children:s.map((h,w)=>e.jsxs(b.div,{className:"flex items-center gap-3 p-3 bg-black/20 border border-neutral-300/20 rounded-md",whileHover:{backgroundColor:"rgba(0,0,0,0.4)"},transition:{duration:.2},children:[e.jsx("span",{className:"text-sm font-mono text-neutral-300 flex-1 truncate",children:h.node}),v(h.status)]},w))})]})]})},g)})})]})]})}function D(){const{id:n}=I(),[a,x]=i.useState(!0),[j,p]=i.useState(!1),[c,N]=i.useState([]),[l,d]=i.useState([]),[f,v]=i.useState("IfNotPresent");i.useEffect(()=>{m()},[n]);const m=async()=>{x(!0);try{const s=await S(parseInt(n));s.code===200?N(s.data||[]):o.danger({description:s.msg||"获取预热镜像信息失败"})}catch(s){console.error("获取预热镜像信息失败:",s),o.danger({description:"获取预热镜像信息失败"})}finally{x(!1)}},t=s=>{d(u=>u.includes(s)?u.filter(h=>h!==s):[...u,s])},g=()=>{l.length===c.length?d([]):d(c.map(s=>Object.keys(s)[0]))},r=async()=>{if(l.length===0){o.warning({description:"请选择要预热的镜像"});return}p(!0);try{const s=await C(parseInt(n),{images:l,pull_policy:f});s.code===200?(o.success({description:"预热镜像任务已提交"}),setTimeout(()=>{m()},2e3)):o.danger({description:s.msg||"预热镜像失败"})}catch(s){console.error("预热镜像失败:",s),o.danger({description:"预热镜像失败"})}finally{p(!1)}};return e.jsx(W,{images:c,selectedImages:l,pullPolicy:f,loading:a,submitting:j,onImageToggle:t,onSelectAll:g,onPullPolicyChange:v,onWarmup:r,onRefresh:m})}export{D as default};
