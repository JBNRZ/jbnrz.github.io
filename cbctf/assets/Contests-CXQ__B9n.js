import{j as e,m as z,B as p,r as o,u as $,t as i}from"./index-BE8PTdY9.js";import{I as E}from"./IconPlus-D10H8ZHD.js";import{I as L}from"./IconEdit-C0RBpQ3d.js";import{I as H}from"./IconTrash-8VnIVa1I.js";import{c as _}from"./createReactComponent-BXxSeqD2.js";import{I as q}from"./IconChevronRight-CMrt6GdH.js";import{A as G,M as F}from"./AdminModal-7Wz7xtnW.js";import{g as J,u as K,c as Q,d as V}from"./contest-D0dI1zQa.js";import"./IconX-B9WjC-FK.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var W=_("outline","chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]);function X({contests:u=[],totalCount:h=0,currentPage:d=1,pageSize:f=6,onPageChange:r,onCreateContest:w,onDeleteContest:b,onContestClick:l,onAvatarUpload:n}){const j=(t,a)=>{const c=new Date().getTime()/1e3,x=new Date(t).getTime()/1e3,k=x+a;return c<x?"upcoming":c>k?"ended":"running"},m=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),v=t=>`${Math.floor(t/3600)}h`;return e.jsx("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:e.jsxs(z.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-mono text-neutral-50",children:"比赛管理"}),e.jsx(p,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(E,{size:16}),onClick:w,children:"添加比赛"})]}),e.jsx("div",{className:"space-y-4",children:u.map(t=>{const a=j(t.start,t.duration);return e.jsx(z.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(89, 126, 247, 0.1)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4 flex h-[200px]",onClick:()=>l==null?void 0:l(t),children:[e.jsx("div",{className:"w-[200px] p-4",children:e.jsxs("div",{className:"relative w-full h-full rounded-md overflow-hidden group cursor-pointer",onClick:c=>{c.stopPropagation(),n==null||n(t)},children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-neutral-300",children:"更换封面"})})]})}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-mono
                                                        ${a==="upcoming"?"bg-green-400/20 text-green-400":a==="running"?"bg-geek-400/20 text-geek-400":"bg-neutral-400/20 text-neutral-400"}`,children:a==="upcoming"?"未开始":a==="running"?"进行中":"已结束"}),t.hidden&&e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-mono bg-yellow-400/20 text-yellow-400",children:"隐藏"})]})]}),e.jsx("p",{className:"text-sm text-neutral-400 mt-2 line-clamp-2",children:t.desc})]}),e.jsx("div",{className:"h-[1px] bg-neutral-300/30 my-4"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-neutral-400 font-mono",children:[e.jsxs("span",{children:["开始时间: ",m(t.start)]}),e.jsxs("span",{children:["持续时间: ",v(t.duration)]}),e.jsxs("span",{children:["每队人数: ",t.size,"人"]}),e.jsxs("span",{children:["报名总数: ",t.users,"人"]}),e.jsxs("span",{children:["队伍总数: ",t.teams,"队"]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"!bg-yellow-400/20 !text-yellow-400 hover:!bg-yellow-400/30",children:e.jsx(L,{size:18})}),e.jsx(p,{variant:"ghost",size:"icon",className:"!bg-red-400/20 !text-red-400 hover:!bg-red-400/30",onClick:c=>{c.stopPropagation(),b==null||b(t)},children:e.jsx(H,{size:18})})]})]})]})]})},t.id)})}),h>f&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"!bg-black/30",onClick:()=>r==null?void 0:r(d-1),disabled:d===1,children:e.jsx(W,{size:18})}),Array.from({length:Math.ceil(h/f)}).map((t,a)=>e.jsx(p,{variant:d===a+1?"primary":"ghost",size:"icon",className:d===a+1?"":"!bg-black/30",onClick:()=>r==null?void 0:r(a+1),children:a+1},a)),e.jsx(p,{variant:"ghost",size:"icon",className:"!bg-black/30",onClick:()=>r==null?void 0:r(d+1),disabled:d===Math.ceil(h/f),children:e.jsx(q,{size:18})})]})]})})}const I=()=>{const u=new Date;return u.setDate(u.getDate()+1),u.toISOString().slice(0,16)};function ne(){const[u,h]=o.useState([]),[d,f]=o.useState(0),[r,w]=o.useState(1),[b,l]=o.useState(!1),[n,j]=o.useState("create"),[m,v]=o.useState(null),[t,a]=o.useState({name:"",desc:"",captcha:"",prefix:"CBCTF",size:4,start:I(),duration:24}),c=o.useRef(null),x=6,k=$();o.useEffect(()=>{N()},[r]);const N=async()=>{try{const s=await J({limit:x,offset:(r-1)*x});s.code===200?(h(s.data.contests),f(s.data.count)):i.danger({description:s.msg||"Failed to fetch contests"})}catch(s){i.danger({description:"Failed to fetch contests"}),console.error(s)}},S=()=>{j("create"),a({name:"",desc:"",captcha:"",prefix:"CBCTF",size:4,start:I(),duration:24}),l(!0)},M=s=>{j("delete"),v(s),l(!0)},D=s=>{k(`/admin/contests/${s.id}`)},T=s=>{var g;v(s),(g=c.current)==null||g.click()},A=async s=>{var C;const g=(C=s.target.files)==null?void 0:C[0];if(s.target.value="",!!g)try{const y=await K(m.id,g);y.code===200?(i.success({description:"Cover image updated successfully"}),N()):i.danger({description:y.msg||"Failed to update cover image"})}catch(y){console.error("Failed to update cover image:",y),i.danger({description:"Failed to update cover image"})}},B=async()=>{try{if(n==="create"){t.start=new Date(t.start).toISOString(),t.duration=parseInt(t.duration)*3600;const s=await Q(t);s.code===200?(i.success({description:"Contest created successfully"}),l(!1),N()):i.danger({description:s.msg||"Failed to create contest"})}else{const s=await V(m.id);s.code===200?(i.success({description:"Contest deleted successfully"}),l(!1),N()):i.danger({description:s.msg||"Failed to delete contest"})}}catch(s){console.error(`Failed to ${n==="create"?"create":"delete"} contest:`,s),i.danger({description:`Failed to ${n==="create"?"create":"delete"} contest`})}},O=()=>n==="create"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Contest Name"}),e.jsx("input",{type:"text",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.name,onChange:s=>a({...t,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Description"}),e.jsx("textarea",{className:"w-full h-[100px] bg-black/20 border border-neutral-300 rounded-md p-4 text-neutral-50 resize-none",value:t.desc,onChange:s=>a({...t,desc:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Flag Prefix"}),e.jsx("input",{type:"text",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.prefix,onChange:s=>a({...t,prefix:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Team Size"}),e.jsx("input",{type:"number",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.size,onChange:s=>a({...t,size:parseInt(s.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.start,onChange:s=>a({...t,start:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-neutral-400 text-sm block mb-1",children:"Duration (hours)"}),e.jsx("input",{type:"number",className:"w-full h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4 text-neutral-50",value:t.duration,onChange:s=>a({...t,duration:parseInt(s.target.value)})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("p",{className:"text-neutral-50",children:["Are you sure you want to delete the contest ",e.jsx("span",{className:"font-bold",children:m==null?void 0:m.name}),"?"]}),e.jsx("p",{className:"text-red-400 text-sm mt-2",children:"This action cannot be undone."})]}),R=()=>e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"default",onClick:()=>l(!1),children:"Cancel"}),e.jsx(F,{variant:n==="delete"?"danger":"primary",onClick:B,children:n==="create"?"Create":"Delete"})]});return e.jsxs(e.Fragment,{children:[e.jsx(X,{contests:u,totalCount:d,currentPage:r,pageSize:x,onPageChange:w,onCreateContest:S,onDeleteContest:M,onContestClick:D,onAvatarUpload:T}),e.jsx(G,{isOpen:b,onClose:()=>l(!1),title:n==="create"?"Create Contest":"Delete Contest",size:n==="create"?"lg":"sm",footer:R(),children:O()}),e.jsx("input",{type:"file",ref:c,className:"hidden",accept:"image/*",onChange:A})]})}export{ne as default};
