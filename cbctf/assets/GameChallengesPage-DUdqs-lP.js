import{j as e,m as c,r as m,B as y,R as K,b as N,h as Q,u as ee,t as h,L as te}from"./index-rx4aKaNR.js";import{A as se}from"./index-_3tUDhvJ.js";import{a as ae,b as ne}from"./contest-BEUaM0c1.js";import{a as re,g as ie}from"./team-DjEDO2k0.js";function I({title:t,value:i,valueColor:a="text-neutral-50",subTitle:d,subValue:g,subValueColor:x,showProgress:u,progressValue:p}){return e.jsxs("div",{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:t}),e.jsx("div",{className:`font-mono text-xl ${a}`,children:i})]}),d&&g&&e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:d}),e.jsx("div",{className:`font-mono text-xl ${x}`,children:g})]}),u&&e.jsx("div",{className:"h-2 bg-neutral-700 rounded-full overflow-hidden mt-2",children:e.jsx(c.div,{className:"h-full bg-geek-400",initial:{width:0},animate:{width:`${p}%`},transition:{duration:1}})})]})}function X({notifications:t}){return e.jsxs(c.div,{className:`border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4\r
                overflow-hidden`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("span",{className:"text-neutral-400 text-sm",children:"Notifications"})}),e.jsx("div",{className:"space-y-2",children:t.map((i,a)=>e.jsxs(c.div,{className:"text-sm",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.1},children:[e.jsx("span",{className:`
                            ${i.type==="success"?"text-green-400":i.type==="info"?"text-geek-400":"text-yellow-400"}
                        `,children:"•"}),e.jsx("span",{className:"text-neutral-300 ml-2",children:i.message})]},a))})]})}function le({contestStatus:t,notifications:i,onStatusExpired:a}){const[d,g]=m.useState(0);m.useEffect(()=>{let u;const p=()=>{const b=Date.parse(t.endTime),o=Date.now(),f=b-o;return f<=0?(g(0),t.status==="upcoming"?a==null||a("active"):t.status==="active"&&(a==null||a("ended")),!1):(g(Math.floor(f/1e3)),!0)};return p(),u=setInterval(()=>{p()},1e3),()=>{clearInterval(u)}},[t.status,t.startTime,t.endTime]);const x=u=>{const p=Math.floor(u/3600),b=Math.floor(u%3600/60),o=u%60;return`${String(p).padStart(2,"0")}:${String(b).padStart(2,"0")}:${String(o).padStart(2,"0")}`};return t.status==="upcoming"?e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsxs(c.div,{className:"col-span-3 grid grid-cols-3 gap-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx(I,{title:"Contest Status",value:"UPCOMING",valueColor:"text-yellow-400"}),e.jsx(I,{title:"Start Time",value:new Date(t.startTime).toLocaleString(),valueColor:"text-neutral-50"}),e.jsx(I,{title:"Time Until Start",value:x(d),valueColor:"text-neutral-50"})]}),e.jsx(X,{notifications:i})]}):t.status==="ended"?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsxs(c.div,{className:"col-span-3 grid grid-cols-3 gap-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx(I,{title:"Time Remaining",value:x(d),valueColor:"text-neutral-50"}),e.jsx(I,{title:"Team Score",value:t.team.score.toLocaleString(),valueColor:"text-geek-400",subTitle:"Rank",subValue:`#${t.team.rank}`,subValueColor:"text-yellow-400"}),e.jsx(I,{title:"Challenges Solved",value:`${t.team.solved}/${t.totalChallenges}`,valueColor:"text-neutral-50",showProgress:!0,progressValue:t.team.solved/t.totalChallenges*100})]}),e.jsx(X,{notifications:i})]})}function oe({categories:t,selectedCategory:i,onCategoryChange:a,challenges:d,onChallengeClick:g,teamInfo:x}){const[u,p]=m.useState(null),b=m.useMemo(()=>i==="ALL"?d:d.filter(o=>o.category===i),[d,i]);return e.jsxs(c.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("div",{className:"flex gap-4",children:t.map(o=>e.jsx(y,{variant:i===o?"primary":"ghost",size:"sm",className:`min-w-0 px-4 py-1 ${i===o?"":"text-neutral-400 hover:text-neutral-200"}`,onClick:()=>a(o),children:o},o))}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex -space-x-2",children:x.members.map((o,f)=>e.jsx("div",{className:"w-8 h-8 rounded-lg border-2 border-black bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${o})`}},f))}),e.jsx("span",{className:"text-neutral-400 font-mono",children:x.name})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:b.map((o,f)=>e.jsxs(c.div,{className:`p-4 border rounded-md transition-all duration-200 cursor-pointer backdrop-blur-none
                ${o.solved?"border-geek-400/50 bg-geek-400/5 hover:bg-geek-400/10":"border-neutral-300/30 bg-black/30 hover:bg-black/50"}
                ${u===f?"scale-[1.02]":""}`,onMouseEnter:()=>p(f),onMouseLeave:()=>p(null),whileHover:{y:-2},onClick:()=>g(o),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-geek-400 font-mono",children:o.category}),e.jsx("h3",{className:"text-neutral-50 font-mono",children:o.title}),e.jsxs("span",{className:"text-yellow-400 font-mono text-sm",children:[o.points," pts"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400 text-sm",children:"Solves:"}),e.jsx("span",{className:"text-neutral-50 font-mono",children:o.solves})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:o.tags&&o.tags.map((n,C)=>e.jsx("span",{className:`
                      px-2 py-0.5 rounded 
                      text-xs font-mono
                      border backdrop-blur-none
                      ${o.solved?"border-geek-400/30 bg-geek-400/20 text-neutral-50":"border-neutral-600 bg-neutral-900 text-neutral-300"}
                    `,children:n},C))}),e.jsxs("div",{className:"flex items-center gap-3",children:[!o.isInitialized&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-black/50 border border-yellow-400/30 rounded",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-yellow-400 animate-pulse"}),e.jsx("span",{className:"text-yellow-400 text-xs font-mono",children:"Not Initialized"})]}),o.hasInstance&&o.instanceRunning&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-black/50 border border-green-400/30 rounded",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"}),e.jsx("span",{className:"text-green-400 text-xs font-mono",children:"Instance Running"})]}),o.solved&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-black/50 border border-geek-400/30 rounded",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-geek-400"}),e.jsx("span",{className:"text-geek-400 text-xs font-mono",children:"Solved"})]})]})]})]},o.id))})]})}function de({startTime:t,joined:i,onJoin:a}){const[d,g]=m.useState({days:0,hours:0,minutes:0,seconds:0});return m.useEffect(()=>{const x=()=>{const p=new Date(t)-new Date;p>0&&g({days:Math.floor(p/864e5),hours:Math.floor(p/36e5%24),minutes:Math.floor(p/1e3/60%60),seconds:Math.floor(p/1e3%60)})};x();const u=setInterval(x,1e3);return()=>clearInterval(u)},[t]),e.jsx(c.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl text-neutral-50 font-mono mb-2",children:"Contest Starting In"}),e.jsx("p",{className:"text-neutral-400",children:"Get ready for the challenge"})]}),e.jsx("div",{className:"flex gap-8",children:[{label:"DAYS",value:d.days},{label:"HOURS",value:d.hours},{label:"MINUTES",value:d.minutes},{label:"SECONDS",value:d.seconds}].map((x,u)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-[100px] h-[100px] border border-geek-400 rounded-md \r
                                bg-black/50 flex items-center justify-center\r
                                text-4xl text-geek-400 font-mono\r
                                shadow-[0_0_15px_rgba(89,126,247,0.1)]`,children:String(x.value).padStart(2,"0")}),e.jsx("span",{className:"mt-2 text-neutral-400 text-sm font-mono",children:x.label})]},u))}),e.jsx("div",{className:"flex flex-col items-center space-y-4",children:i?e.jsx("div",{className:`px-8 py-2 border border-green-400 rounded-md\r
                            bg-green-400/5 text-green-400 font-mono\r
                            shadow-[0_0_15px_rgba(74,222,128,0.1)]`,children:"JOINED"}):e.jsx(y,{variant:"primary",size:"lg",className:"!text-lg",onClick:a,children:"JOIN NOW"})})]})})}function ce({contestInfo:t,onViewScoreboard:i,onUploadWriteup:a,writeups:d=[]}){const[g,x]=m.useState(!1),u=n=>n<1024?`${n} B`:n<1024*1024?`${(n/1024).toFixed(1)} KB`:`${(n/(1024*1024)).toFixed(1)} MB`,p=n=>new Date(n).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),b=n=>{n.preventDefault(),x(!0)},o=()=>{x(!1)},f=n=>{n.preventDefault(),x(!1),n.dataTransfer.files&&n.dataTransfer.files[0]&&a(n.dataTransfer.files[0])};return e.jsx("div",{className:"w-full max-w-[800px] mx-auto",children:e.jsxs(c.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center space-y-4 mb-8",children:[e.jsx(c.div,{className:`w-16 h-16 mx-auto border-2 border-yellow-400 rounded-full\r
                            flex items-center justify-center`,initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},children:e.jsx("span",{className:"text-3xl",children:"🏆"})}),e.jsxs("h2",{className:"text-2xl font-mono text-neutral-50",children:["Contest ",e.jsx("span",{className:"text-yellow-400",children:"Completed"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(c.div,{className:"p-4 border border-neutral-300/30 rounded-md text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Duration"}),e.jsx("div",{className:"text-neutral-50 font-mono",children:(t==null?void 0:t.duration)||"24h"})]}),e.jsxs(c.div,{className:"p-4 border border-neutral-300/30 rounded-md text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Teams"}),e.jsx("div",{className:"text-neutral-50 font-mono",children:(t==null?void 0:t.totalTeams)||"256"})]}),e.jsxs(c.div,{className:"p-4 border border-neutral-300/30 rounded-md text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Challenges"}),e.jsx("div",{className:"text-neutral-50 font-mono",children:(t==null?void 0:t.totalChallenges)||"30"})]})]}),e.jsxs(c.div,{className:"p-6 border border-geek-400 rounded-md bg-geek-400/5",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-neutral-50 font-mono",children:"Your Team Performance"}),e.jsxs("span",{className:"text-geek-400 font-mono",children:["#",(t==null?void 0:t.teamRank)||"1"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Score"}),e.jsx("div",{className:"text-geek-400 font-mono text-xl",children:(t==null?void 0:t.teamScore)||"0"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Solved"}),e.jsxs("div",{className:"text-neutral-50 font-mono text-xl",children:[(t==null?void 0:t.teamSolved)||"0","/",(t==null?void 0:t.totalChallenges)||"0"]})]})]})]}),e.jsxs(c.div,{className:"space-y-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},children:[e.jsx("div",{className:"text-neutral-50 font-mono text-lg",children:"Writeups"}),e.jsxs(c.div,{className:`border-2 border-dashed rounded-md p-6 text-center cursor-pointer transition-all duration-300
                ${g?"border-yellow-400 bg-yellow-400/10":"border-neutral-400 hover:border-yellow-400 hover:bg-yellow-400/5"}`,whileHover:{scale:1.01},onDragOver:b,onDragLeave:o,onDrop:f,onClick:()=>document.getElementById("writeup-upload").click(),children:[e.jsx("input",{id:"writeup-upload",type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:n=>{n.target.files&&n.target.files[0]&&(a(n.target.files[0]),n.target.value="")}}),e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("span",{className:"text-2xl",children:"📄"}),e.jsx("span",{className:"text-neutral-300 font-mono",children:"Drag and drop files or click here to upload your writeups"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Supports PDF, DOC, DOCX"})]})]}),d.length>0&&e.jsxs(c.div,{className:"mt-4 border border-neutral-300/30 rounded-md overflow-hidden",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{delay:.8},children:[e.jsx("div",{className:"p-3 bg-neutral-800/50 border-b border-neutral-300/30",children:e.jsx("div",{className:"text-neutral-300 font-mono text-sm",children:"Uploaded Writeups"})}),e.jsx("div",{className:"divide-y divide-neutral-300/20",children:d.map(n=>e.jsx("div",{className:"p-3 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-xl",children:n.suffix===".pdf"?"📕":n.suffix===".docx"||n.suffix===".doc"?"📘":"📄"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-50 font-mono text-sm",children:n.filename}),e.jsxs("div",{className:"text-neutral-400 text-xs flex space-x-3",children:[e.jsx("span",{children:u(n.size)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:p(n.date)})]})]})]})},n.id))})]})]}),e.jsx(c.div,{className:"flex justify-center pt-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.9},children:e.jsx(y,{variant:"primary",size:"lg",onClick:i,children:"VIEW FINAL SCOREBOARD"})})]})]})})}const q=K.memo(({hint:t,index:i})=>{const[a,d]=m.useState(!1);return e.jsxs(c.div,{className:`
                border border-neutral-300/30 rounded-md overflow-hidden
                transition-colors duration-200
                ${a?"bg-neutral-900/50":"bg-black/20"}
            `,children:[e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer hover:bg-neutral-800/30",onClick:()=>d(!a),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-geek-400 font-mono text-sm",children:["#",i+1]}),e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:a?"Hide Hint":"Show Hint"})]}),e.jsx(c.span,{className:"text-neutral-400 text-[10px]",animate:{rotate:a?180:0},transition:{duration:.2},children:"▼"})]}),e.jsx(c.div,{initial:!1,animate:{height:a?"auto":0,opacity:a?1:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"p-3 border-t border-neutral-300/10",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:t})})})]})});q.displayName="HintItem";function me({challenge:t,contest:i,isOpen:a,onClose:d,onInitialize:g,onReset:x,onLaunchInstance:u,onExtendInstance:p,onDestroyInstance:b,onSubmitFlag:o,onDownloadAttachment:f}){var r;const[n,C]=m.useState({initializing:!1,resetting:!1,launching:!1,extending:!1,destroying:!1,submitting:!1}),[T,L]=m.useState(null),[E,S]=m.useState(""),[F,O]=m.useState({}),[z,A]=m.useState(0),k=m.useRef(null);m.useEffect(()=>{t!=null&&t.instanceTimeLeft&&A(t.instanceTimeLeft)},[t==null?void 0:t.instanceTimeLeft]),m.useEffect(()=>{if(!(!t||!a)&&!(!t.instanceRunning||!z))return k.current&&clearInterval(k.current),k.current=setInterval(()=>{A(s=>s<=0?(clearInterval(k.current),0):s-1)},1e3),()=>{k.current&&clearInterval(k.current)}},[t==null?void 0:t.instanceRunning,a]);const $=s=>{s=Math.floor(s);const l=Math.floor(s/3600),j=Math.floor(s%3600/60),v=Math.floor(s%60);return`${l.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`},D=async(s,l,...j)=>{C(v=>({...v,[s]:!0})),L(null);try{await l(...j)}catch(v){L(v.message)}finally{C(v=>({...v,[s]:!1}))}},G=()=>{D("initializing",g,t.id)},U=()=>{D("resetting",x,t.id)},H=()=>{D("launching",u,t.id)},_=()=>{D("extending",p,t.id)},W=()=>{D("destroying",b,t.id)},B=async s=>{if(s.preventDefault(),!!E.trim()){C(l=>({...l,submitting:!0})),L(null);try{(await o(t.id,E)).success&&(S(""),d())}catch(l){L(l.message)}finally{C(l=>({...l,submitting:!1}))}}},M=s=>{navigator.clipboard.writeText(s),O(l=>({...l,[s]:!0})),setTimeout(()=>{O(l=>({...l,[s]:!1}))},2e3)},V=()=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.instanceRunning?"bg-green-400":"bg-neutral-400"}`}),e.jsx("span",{className:"text-neutral-50 font-mono text-sm",children:t.instanceRunning?"RUNNING":"NOT RUNNING"})]}),t.instanceRunning&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400 text-sm",children:"Time:"}),e.jsx("span",{className:"text-yellow-400 font-mono text-sm",children:$(z)})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.instanceRunning?e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"primary",size:"sm",onClick:_,disabled:n.extending,className:"border-yellow-400 text-yellow-400 hover:bg-yellow-400/10",children:n.extending?"EXTENDING...":"EXTEND TIME"}),e.jsx(y,{variant:"danger",size:"sm",onClick:W,disabled:n.destroying,children:n.destroying?"DESTROYING...":"DESTROY"})]}):e.jsx(y,{variant:"primary",size:"sm",onClick:H,disabled:n.launching,loading:n.launching,className:n.launching?"border-yellow-400 text-yellow-400":"",children:n.launching?"LAUNCHING...":"LAUNCH INSTANCE"})})]}),t.instanceRunning&&e.jsx("div",{className:"h-1.5 bg-neutral-700 rounded-full overflow-hidden",children:e.jsx(c.div,{className:"h-full bg-yellow-400",initial:{width:0},animate:{width:`${z/t.instanceDuration*100}%`},transition:{duration:.5}})}),t.instanceRunning&&t.instanceIP&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between p-2 bg-neutral-900 rounded-md",children:e.jsx("span",{className:"text-neutral-400 text-xs",children:"Address:"})}),t.instanceIP.map((s,l)=>e.jsxs("div",{className:"flex justify-between p-1.5",children:[e.jsx("span",{className:"font-mono text-neutral-50 text-sm",onClick:()=>M(s),children:s}),e.jsx(y,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-geek-400",onClick:()=>M(s),children:F[s]?"✓":"📋"})]},l))]})]}),Y=()=>!t.hints||t.hints.length===0?null:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Hints"}),e.jsx("div",{className:"space-y-2",children:t.hints.map((s,l)=>e.jsx(q,{hint:s,index:l},`hint-${t.id}-${l}`))})]});return a?t.isInitialized?e.jsx(se,{children:a&&e.jsxs("div",{className:"fixed inset-0 z-[900] flex items-center justify-center",children:[e.jsx(c.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{S(""),d()}}),e.jsx("div",{className:"relative z-10 w-full max-w-[800px] p-4",children:e.jsxs(c.div,{className:"relative w-full bg-black/80 border border-neutral-300 rounded-md",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("div",{className:"p-5 border-b border-neutral-300/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-geek-400 font-mono",children:t.category}),e.jsx("h2",{className:"text-2xl text-neutral-50 font-mono",children:t.title}),e.jsxs("span",{className:"text-yellow-400 font-mono",children:[t.points," pts"]})]}),e.jsx(y,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-50",onClick:()=>{S(""),d()},children:"✕"})]})}),e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1.5 flex-1 min-w-0",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Description"}),e.jsx("p",{className:"text-neutral-50",children:t.description})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(y,{variant:"primary",size:"action",onClick:U,disabled:n.resetting,loading:n.resetting,className:n.resetting?"border-yellow-400 text-yellow-400":"",children:n.resetting?"RESETTING...":"RESET FLAG"})})]}),((r=t.attachments)==null?void 0:r.length)>0&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Attachments"}),e.jsx("div",{className:"space-y-1.5",children:t.attachments.map((s,l)=>e.jsxs(c.a,{href:s.url,target:"_blank",rel:"noopener noreferrer",className:`flex items-center gap-2 p-2 border border-neutral-300/30 rounded-md\r
                                                        text-neutral-300 hover:text-geek-400 hover:border-geek-400\r
                                                        transition-colors duration-200 cursor-pointer`,whileHover:{x:5},onClick:j=>{j.preventDefault(),f(s)},children:[e.jsx("span",{className:"text-sm",children:"📎"}),e.jsx("span",{className:"font-mono text-sm",children:s.name}),e.jsx("span",{className:"text-neutral-400 text-sm ml-auto",children:s.size})]},l))})]}),Y(),t.hasInstance&&V(),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Submit Flag"}),e.jsxs("form",{onSubmit:B,className:"flex gap-2",children:[e.jsx("input",{type:"text",onChange:s=>S(s.target.value),placeholder:`${i.prefix}{...}`,className:`flex-1 h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4\r
                                                text-neutral-50 placeholder-neutral-400\r
                                                focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                                                transition-all duration-200`}),e.jsx(y,{type:"submit",variant:"primary",size:"action",disabled:t.isSolved||n.submitting||!E.trim(),children:n.submitting?"SUBMITTING...":`${t.isSolved?"SOLVED":"SUBMIT"} ${t.attempts}/${t.maxAttempts||"∞"}`})]}),T&&e.jsx(c.div,{className:"text-red-400 text-sm mt-2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:T})]})]})]})})]})}):e.jsxs("div",{className:"fixed inset-0 z-[900] flex items-center justify-center",children:[e.jsx(c.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{S(""),d()}}),e.jsx("div",{className:"relative z-10 w-full max-w-[800px] p-4",children:e.jsxs(c.div,{className:"relative w-full bg-black/80 border border-neutral-300 rounded-md",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("div",{className:"p-5 border-b border-neutral-300/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-geek-400 font-mono",children:t.category}),e.jsx("h2",{className:"text-2xl text-neutral-50 font-mono",children:t.title}),e.jsxs("span",{className:"text-yellow-400 font-mono",children:[t.points," pts"]})]}),e.jsx(y,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-50",onClick:()=>{S(""),d()},children:"✕"})]})}),e.jsxs("div",{className:"p-12 flex flex-col items-center justify-center space-y-4",children:[T&&e.jsx(c.div,{className:"text-red-400 text-sm",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:T}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Initialize the challenge to view its content"}),e.jsx(y,{variant:"primary",size:"action",onClick:G,disabled:n.initializing,loading:n.initializing,className:n.initializing?"border-yellow-400 text-yellow-400":"",children:n.initializing?"INITIALIZING...":"INITIALIZE CHALLENGE"})]})]})})]}):null}const xe=t=>N({url:`/contests/${t}/challenges`,method:"GET"}),Z=(t,i)=>N({url:`/contests/${t}/challenges/${i}`,method:"GET"}),ue=(t,i)=>N({url:`/contests/${t}/challenges/${i}/init`,method:"POST"}),pe=(t,i)=>N({url:`/contests/${t}/challenges/${i}/attachment`,method:"GET",responseType:"blob"}).then(a=>a),he=(t,i)=>N({url:`/contests/${t}/challenges/${i}/start`,method:"POST"}),ge=(t,i)=>N({url:`/contests/${t}/challenges/${i}/increase`,method:"POST"}),fe=(t,i)=>N({url:`/contests/${t}/challenges/${i}/stop`,method:"POST"}),je=(t,i,a)=>N({url:`/contests/${t}/challenges/${i}/submit`,method:"POST",data:a}),ve=(t,i)=>N({url:`/contests/${t}/challenges/${i}/reset`,method:"POST"}),ye=(t,i)=>{const a=new FormData;return a.append("writeup",i),N({url:`/contests/${t}/writeups`,method:"POST",data:a,headers:{"Content-Type":"multipart/form-data"}})},be=t=>N({url:`/contests/${t}/writeups`,method:"GET"}),Ne=(t,i)=>{const a=new Date().getTime(),d=new Date(t.start).getTime(),g=d+t.duration*1e3;return{status:a<d?"upcoming":a>g?"ended":"running",startTime:new Date(d).toISOString(),endTime:new Date(g).toISOString(),joined:!0,duration:t.duration/3600,prefix:t.prefix,team:{score:i.data.score,rank:i.data.rank||0,solved:i.data.solved.reduce((x,u)=>x+u.solved,0)},teams:t.teams,totalChallenges:i.data.solved.reduce((x,u)=>x+u.all,0)}},we=t=>{const i=new Set(["ALL"]);return t.forEach(a=>{a.category&&i.add(a.category)}),Array.from(i)},Ce=t=>({id:t.id,category:t.category,title:t.name,points:t.current_score,description:t.desc,attachments:[],hasInstance:t.type==="pods",instanceRunning:t.remote.status==="Running",instanceIP:t.remote.target||[""],instanceDuration:t.remote.remaining||0,instanceTimeLeft:t.remote.remaining||0,solves:t.solvers||0,isInitialized:t.init,solved:t.solved,attempts:t.attempts,maxAttempts:t.attempt,scoreInfo:{initial:t.score,current:t.current_score,minimum:t.min_score,decay:t.decay,scoreType:t.score_type},hints:t.hints,tags:t.tags,hidden:t.hidden});function De(){const{contestId:t}=Q(),i=ee(),[a,d]=m.useState({}),[g,x]=m.useState(["ALL"]),[u,p]=m.useState("ALL"),[b,o]=m.useState([]),[f,n]=m.useState(null),[C,T]=m.useState(!0),[L,E]=m.useState(null),[S,F]=m.useState([]),[O,z]=m.useState([]);m.useEffect(()=>{A()},[t]),m.useEffect(()=>{(a==null?void 0:a.status)==="ended"&&k()},[t,a==null?void 0:a.status]);const A=async()=>{try{const[r,s,l,j,v]=await Promise.all([ae(t),xe(t),re(t),ie(t),ne(t)]);if(r.code===200&&l.code===200){const J=Ne(r.data,j);d(J),F(v.data.notices.map(w=>({type:w.type||"info",message:w.content})));const P=we(s.data.challenges);x(P),E({members:l.data.map(w=>w.avatar),name:j.data.name});const R=s.data.challenges.map(w=>Ce(w));o(R)}}catch(r){if((r==null?void 0:r.response.status)===403){h.danger({title:"403 Forbidden",description:"您的队伍已被封禁"}),i(`/contests/${t}`);return}h.danger({title:"获取数据失败",description:r.message})}finally{T(!1)}},k=async()=>{try{const r=await be(t);r.code===200&&r.data.writeups&&z(r.data.writeups)}catch(r){console.error("Failed to fetch writeups:",r)}},$=async()=>{if(f)try{const r=await Z(t,f.id);if(r.code===200){const s={...f,attachments:r.data.files?[{name:r.data.files}]:[],isInitialized:r.data.init,isSolved:r.data.solved,instanceRunning:r.data.remote.status==="Running",instanceIP:r.data.remote.target||[""],instanceDuration:r.data.remote.remaining||0,instanceTimeLeft:r.data.remote.remaining||0};n(s),o(l=>l.map(j=>j.id===s.id?s:j))}}catch(r){console.error("Failed to refresh challenge status:",r)}},D=async r=>{try{const s=await ue(t,r);s.code===200&&(h.success({title:s.msg||"题目初始化成功"}),await $())}catch(s){h.danger({title:"初始化失败",description:s.message})}},G=async r=>{try{const s=await ve(t,r);s.code===200&&(h.success({title:s.msg||"题目重置成功"}),await $())}catch(s){h.danger({title:"重置失败",description:s.message})}},U=async r=>{try{const s=await he(t,r);s.code===200&&(h.success({title:s.msg||"靶机启动成功"}),await $())}catch(s){h.danger({title:"启动失败",description:s.message})}},H=async r=>{try{const s=await ge(t,r);if(s.code===200){h.success({title:s.msg||"延长时间成功"}),await $();return}h.danger({title:"延长时间失败",description:s.msg})}catch(s){h.danger({title:"延长时间失败",description:s.message})}},_=async r=>{try{const s=await fe(t,r);s.code===200&&(h.success({title:s.msg||"靶机已销毁"}),await $())}catch(s){h.danger({title:"销毁失败",description:s.message})}},W=async(r,s)=>{try{const l=await je(t,r,{flag:s});return await $(),await A(),l.code===200?(h.success({title:l.msg||"提交成功"}),{success:!0,message:"提交成功！"}):(h.danger({title:l.msg}),{success:!0,message:l.msg})}catch(l){return{success:!1,message:l.message}}},B=r=>{p(r)},M=async r=>{try{const s=await Z(t,r.id);if(console.log(s),s.code===200){const l={...r,attachments:s.data.file?[{name:s.data.file}]:[],isInitialized:s.data.init,isSolved:s.data.solved,instanceRunning:s.data.remote.status==="Running",instanceIP:s.data.remote.target||[""],instanceTimeLeft:s.data.remote.remaining||0,instanceDuration:s.data.remote.duration||3600};n(l)}}catch(s){console.error("Failed to get challenge status:",s),h.danger({title:"获取题目状态失败",description:s.message}),n(r)}},V=async r=>{var s;try{const l=await pe(t,f.id),j=(s=l.headers)==null?void 0:s["content-disposition"];let v=r.name;if(j){const w=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(j);w!=null&&w[1]&&(v=w[1].replace(/['"]/g,""))}const J=new Blob([l.data]),P=window.URL.createObjectURL(J),R=document.createElement("a");R.href=P,R.setAttribute("download",v),document.body.appendChild(R),R.click(),document.body.removeChild(R),window.URL.revokeObjectURL(P),h.success({title:"附件下载成功"})}catch(l){console.error("Failed to download attachment:",l),h.danger({title:"下载失败",description:l.message})}},Y=async r=>{try{T(!0);const s=await ye(t,r);s.code===200?(h.success({title:"题解上传成功",description:"感谢您分享您的解题思路！"}),k()):h.danger({title:"题解上传失败",description:s.msg||"请稍后再试"})}catch(s){console.error("Failed to upload writeup:",s),h.danger({title:"题解上传失败",description:s.message||"发生了未知错误"})}finally{T(!1)}};return C?e.jsx(te,{}):e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsx(le,{contestStatus:a,onStatusExpired:r=>{d(s=>({...s,status:r}))},notifications:S}),(a==null?void 0:a.status)==="upcoming"?e.jsx(de,{startTime:a.startTime,joined:a.joined,onJoin:()=>{}}):(a==null?void 0:a.status)==="ended"?e.jsx(ce,{contestInfo:{duration:`${a.duration}h`,totalTeams:a.teams,totalChallenges:a.totalChallenges,teamRank:a.team.rank,teamScore:a.team.score,teamSolved:a.team.solved},onViewScoreboard:()=>{i(`/contests/${t}/scoreboard`)},onUploadWriteup:Y,writeups:O}):e.jsxs("div",{children:[e.jsx(oe,{categories:g,selectedCategory:u,onCategoryChange:B,challenges:b,onChallengeClick:M,teamInfo:L}),e.jsx(me,{challenge:f,contest:a,isOpen:!!f,onClose:()=>n(null),onInitialize:D,onReset:G,onLaunchInstance:U,onExtendInstance:H,onDestroyInstance:_,onSubmitFlag:W,onDownloadAttachment:V})]})]})}export{De as default};
