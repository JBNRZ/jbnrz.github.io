import{j as e,m as u,B as h,e as S,r as m,L as k}from"./index-DcmwyZLT.js";import{c as w,a as T}from"./contest-CQpPtEGC.js";import{g as C}from"./team-CMd5r5Df.js";function $({totalTeams:t,totalSolves:o,highestScore:s,totalPlayers:n}){const r=[{label:"Total Teams",value:t,valueClass:"text-neutral-50"},{label:"Total Players",value:n,valueClass:"text-neutral-50"},{label:"Total Solves",value:o,valueClass:"text-geek-400"},{label:"Highest Score",value:s,valueClass:"text-yellow-400"}];return e.jsx("div",{className:"grid grid-cols-4 gap-6",children:r.map((i,a)=>e.jsxs(u.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:a*.05},children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:i.label}),e.jsx(u.div,{className:`font-mono text-2xl ${i.valueClass}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:a*.05},children:i.value})]},a))})}const L={Web:"bg-blue-400",Crypto:"bg-purple-400",Pwn:"bg-red-400",Reverse:"bg-green-400",Misc:"bg-yellow-400"};function p({solved:t=[],totalSolved:o=0}){return!Array.isArray(t)||t.length===0?null:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[t.map(({category:s,solved:n,all:r})=>e.jsxs("div",{className:"flex flex-col items-center",title:`${s}: ${n}/${r}`,children:[e.jsx("div",{className:"text-[10px] font-mono text-neutral-400 mb-1",children:s.toUpperCase()}),e.jsx("div",{className:"h-6 w-1.5 rounded-full bg-neutral-700 relative overflow-hidden",children:e.jsx(u.div,{className:`absolute bottom-0 left-0 right-0 ${L[s]||"bg-neutral-400"}`,initial:{height:0},animate:{height:`${n/r*100}%`},transition:{duration:1}})}),e.jsx("div",{className:"text-[10px] font-mono text-neutral-300 mt-1",children:n})]},s)),e.jsx("div",{className:"h-full w-[1px] bg-neutral-300/10 mx-2"}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-2xl font-mono text-geek-400",children:o}),e.jsx("div",{className:"text-[10px] text-neutral-400",children:"TOTAL"})]})]})}function R({currentPage:t,totalPages:o,onPageChange:s}){const n=Array.from({length:o},(r,i)=>i+1);return e.jsxs(u.div,{className:"flex items-center justify-center gap-2 mt-6 border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-2",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx(h,{variant:"ghost",size:"icon",className:`w-8 h-8 ${t===1?"!text-neutral-600 cursor-not-allowed":"!text-neutral-400 hover:!text-neutral-200 !border-neutral-300/30 hover:!border-neutral-300"}`,onClick:()=>t>1&&s(t-1),disabled:t===1,children:"←"}),n.map(r=>e.jsx(h,{variant:t===r?"primary":"ghost",size:"icon",className:`w-8 h-8 ${t===r?"!bg-geek-400/10":"!text-neutral-400 hover:!text-neutral-200 !border-neutral-300/30 hover:!border-neutral-300"}`,onClick:()=>s(r),children:r},r)),e.jsx(h,{variant:"ghost",size:"icon",className:`w-8 h-8 ${t===o?"!text-neutral-600 cursor-not-allowed":"!text-neutral-400 hover:!text-neutral-200 !border-neutral-300/30 hover:!border-neutral-300"}`,onClick:()=>t<o&&s(t+1),disabled:t===o,children:"→"})]})}function _({team:t}){return t?e.jsx(u.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg border border-neutral-300 bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar||"/default-team-avatar.png"})`}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-50 font-mono text-lg",children:t.name}),e.jsxs("div",{className:"text-neutral-400 text-sm",children:["Rank #",t.rank]})]})]}),t.solved&&e.jsx(p,{solved:t.solved,totalSolved:t.totalSolved}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Score"}),e.jsx("div",{className:"text-geek-400 font-mono text-2xl",children:t.score.toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Solved"}),e.jsx("div",{className:"text-neutral-50 font-mono text-2xl",children:t.totalSolved})]})]})]})}):null}function A({stats:t,teams:o,userTeam:s,currentPage:n,totalPages:r,onPageChange:i}){return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[s&&e.jsx(_,{team:s}),e.jsx($,{...t}),e.jsxs(u.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"grid grid-cols-[80px_240px_120px_auto_200px] gap-4 p-4 border-b border-neutral-300/30 place-items-center",children:[e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"RANK"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"TEAM"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"SCORE"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-center",children:"CHALLENGES"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"LAST SUBMIT"})]}),e.jsx("div",{className:"divide-y divide-neutral-300/10",children:o.map((a,v)=>e.jsxs(u.div,{className:"grid grid-cols-[80px_240px_120px_auto_200px] gap-4 p-4 hover:bg-neutral-300/5 transition-colors duration-200 cursor-pointer place-items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`font-mono text-xl
                                    ${a.rank===1?"text-yellow-400":a.rank===2?"text-neutral-300":a.rank===3?"text-orange-400":"text-neutral-400"}
                                `,children:["#",a.rank]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300 bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${a.avatar||"/default-team-avatar.png"})`}}),e.jsx("span",{className:"text-neutral-50 font-mono",children:a.name})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-geek-400 font-mono",children:a.score.toLocaleString()})}),a.solved&&e.jsx(p,{solved:a.solved,totalSolved:a.totalSolved}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:a.lastSubmit})})]},v))})]}),e.jsx(R,{currentPage:n,totalPages:r,onPageChange:i})]})}function B(){const{contestId:t}=S(),[o,s]=m.useState(1),[n]=m.useState(10),[r,i]=m.useState(0),[a,v]=m.useState(!0),[g,j]=m.useState({stats:{totalTeams:0,totalSolves:0,highestScore:0,totalPlayers:0},teams:[],userTeam:null}),b=l=>{const d=c=>c?new Date(c).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-";return{rank:l.rank,name:l.name,avatar:l.avatar,score:l.score,solved:l.solved,totalSolved:l.solved.reduce((c,x)=>c+x.solved,0),lastSubmit:d(l.last)}},N=l=>l.teams.map(d=>b(d)),y=l=>{s(l),f(l)},f=async l=>{v(!0);try{const d=await w(t,n,(l-1)*n),c=await C(t),x=await T(t);d.code===200&&c.code===200&&(j({stats:{totalTeams:x.data.teams||0,totalPlayers:x.data.users||0,totalSolves:x.data.solved||0,highestScore:x.data.highest||0},teams:N(d.data),userTeam:b(c.data)}),i(Math.ceil(d.data.count/n)))}catch(d){console.error("获取排行榜数据失败:",d)}finally{v(!1)}};return m.useEffect(()=>{f(1)},[t]),a?e.jsx(k,{}):e.jsx(A,{...g,currentPage:o,totalPages:r,onPageChange:y})}export{B as default};
