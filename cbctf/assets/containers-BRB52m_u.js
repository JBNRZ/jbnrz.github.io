import{e as U,r as n,t as r,j as e,B as I,m as y,L as X}from"./index-CLIU1Evb.js";import{D as Y,k as Z,e as ee,E as te,F as se}from"./contest-MSCdFmB0.js";import{A as ae}from"./AdminPagination-BAnjZrzg.js";import{A as _}from"./AdminModal-lDjp4PyQ.js";import{c as u}from"./createReactComponent-BQzirh7z.js";import"./IconX-1R0Qld0_.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var M=u("outline","ban","IconBan",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M5.7 5.7l12.6 12.6",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var z=u("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ne=u("outline","filter","IconFilter",[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var re=u("outline","player-play","IconPlayerPlay",[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]]);function he(){const{id:c}=U(),[i,P]=n.useState([]),[p,T]=n.useState(0),[f,C]=n.useState(1),[D,S]=n.useState(!1),[d,F]=n.useState({user_id:"",team_id:"",challenge_id:"",limit:10,offset:0}),[l,m]=n.useState([]),[O,g]=n.useState(!1),[$,b]=n.useState(!1),[A,E]=n.useState([]),[L,B]=n.useState([]),[j,N]=n.useState([]),[k,v]=n.useState([]),h=10;n.useEffect(()=>{x(),H(),V()},[c]),n.useEffect(()=>{x()},[f,d]);const x=async()=>{S(!0);try{const t={...d,limit:h,offset:(f-1)*h};Object.keys(t).forEach(a=>{t[a]===""&&delete t[a]});const s=await Y(parseInt(c),t);s.code===200?(P(s.data.victims||[]),T(s.data.count||0)):r.danger({description:s.msg||"获取容器列表失败"})}catch(t){console.error("获取容器列表失败:",t),r.danger({description:"获取容器列表失败"})}finally{S(!1)}},H=async()=>{try{const t=await Z(parseInt(c),{limit:100,offset:0});t.code===200&&E(t.data.teams||[])}catch(t){console.error("获取团队列表失败:",t)}},V=async()=>{try{const t=await ee(parseInt(c));t.code===200&&B(t.data.challenges||[])}catch(t){console.error("获取题目列表失败:",t)}},w=(t,s)=>{F(a=>({...a,[t]:s})),C(1)},R=t=>{C(t)},W=t=>{m(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},q=()=>{l.length===i.length?m([]):m(i.map(t=>t.id))},G=async()=>{if(l.length===0){r.warning({description:"请选择要停止的容器"});return}try{const t=await te(parseInt(c),l);t.code===200?(r.success({description:"停止容器成功"}),m([]),x()):r.danger({description:t.msg||"停止容器失败"})}catch(t){console.error("停止容器失败:",t),r.danger({description:"停止容器失败"})}b(!1)},J=async()=>{if(k.length===0||j.length===0){r.warning({description:"请选择题目和团队"});return}try{const t=await se(parseInt(c),k,j);t.code===200?(r.success({description:"开启容器成功"}),v([]),N([]),x()):r.danger({description:t.msg||"开启容器失败"})}catch(t){console.error("开启容器失败:",t),r.danger({description:"开启容器失败"})}g(!1)},K=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",Q=t=>{if(!t)return"-";const s=Math.floor(t/3600),a=Math.floor(t%3600/60),o=Math.floor(t%60);return`${s}h ${a}m ${o}s`};return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"容器管理"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(I,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(re,{size:16}),onClick:()=>g(!0),children:"开启容器"}),e.jsxs(I,{variant:"danger",size:"sm",align:"icon-left",icon:e.jsx(M,{size:16}),onClick:()=>b(!0),disabled:l.length===0,children:["停止容器 (",l.length,")"]})]})]}),e.jsxs(y.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ne,{size:20,className:"text-neutral-400"}),e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"过滤条件"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"用户ID"}),e.jsx("input",{type:"text",value:d.user_id,onChange:t=>w("user_id",t.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                          text-neutral-50 placeholder-neutral-500\r
                          focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                          transition-all duration-200`,placeholder:"输入用户ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"团队ID"}),e.jsx("input",{type:"text",value:d.team_id,onChange:t=>w("team_id",t.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                          text-neutral-50 placeholder-neutral-500\r
                          focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                          transition-all duration-200`,placeholder:"输入团队ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"题目ID"}),e.jsx("input",{type:"text",value:d.challenge_id,onChange:t=>w("challenge_id",t.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                          text-neutral-50 placeholder-neutral-500\r
                          focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                          transition-all duration-200`,placeholder:"输入题目ID"})]})]})]}),e.jsxs(y.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/40",children:[e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono",children:e.jsx("input",{type:"checkbox",checked:l.length===i.length&&i.length>0,onChange:q,className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                              focus:ring-geek-400 focus:ring-offset-0 bg-black/20`})}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"ID"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"题目"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"团队"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"用户"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"IP段"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"远程地址"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"开始时间"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"剩余时间"})]})}),e.jsx("tbody",{children:D?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"p-8 text-center",children:e.jsx(X,{})})}):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"p-8 text-center text-neutral-400",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("svg",{className:"w-12 h-12 text-neutral-300/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("span",{className:"font-mono",children:"暂无容器数据"})]})})}):i.map((t,s)=>e.jsxs(y.tr,{className:"border-t border-neutral-300/10 hover:bg-black/40 transition-colors",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.05},whileHover:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:[e.jsx("td",{className:"p-4 text-neutral-300 font-mono",children:e.jsx("input",{type:"checkbox",checked:l.includes(t.id),onChange:()=>W(t.id),className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                                  focus:ring-geek-400 focus:ring-offset-0 bg-black/20`})}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.id}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.challenge}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.team}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.user}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.ip_block}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono",children:t.remote&&t.remote.length>0?e.jsx("div",{className:"space-y-1",children:t.remote.map((a,o)=>e.jsx("div",{className:"text-xs bg-black/30 text-geek-400 px-2 py-1 rounded border border-geek-400/30",children:a},o))}):e.jsx("span",{className:"text-neutral-400",children:"-"})}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:K(t.start)}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:Q(t.remaining)})]},t.id))})]})}),p>0&&e.jsx("div",{className:"p-4 border-t border-neutral-300/30 bg-black/20 flex justify-center",children:e.jsx(ae,{total:Math.ceil(p/h),current:f,pageSize:h,onChange:R,showTotal:!0,totalItems:p})})]}),e.jsx(_,{isOpen:O,onClose:()=>g(!1),title:"开启容器",onConfirm:J,confirmText:"开启",confirmClassName:"bg-green-500/20 border-green-500/30 text-green-400 hover:bg-green-500/30",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{size:16,className:"text-geek-400"}),e.jsx("label",{className:"text-sm font-mono text-neutral-400",children:"选择题目"})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-neutral-300/30 rounded-md bg-black/10",children:L.map(t=>e.jsxs("div",{className:"flex items-center p-3 hover:bg-black/30 transition-colors",children:[e.jsx("input",{type:"checkbox",id:`challenge-${t.uuid}`,checked:k.includes(t.uuid),onChange:s=>{s.target.checked?v(a=>[...a,t.uuid]):v(a=>a.filter(o=>o!==t.uuid))},className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                              focus:ring-geek-400 focus:ring-offset-0 bg-black/20`}),e.jsx("label",{htmlFor:`challenge-${t.uuid}`,className:"ml-3 text-sm font-mono text-neutral-300 cursor-pointer",children:t.title})]},t.uuid))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{size:16,className:"text-geek-400"}),e.jsx("label",{className:"text-sm font-mono text-neutral-400",children:"选择团队"})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-neutral-300/30 rounded-md bg-black/10",children:A.map(t=>e.jsxs("div",{className:"flex items-center p-3 hover:bg-black/30 transition-colors",children:[e.jsx("input",{type:"checkbox",id:`team-${t.id}`,checked:j.includes(t.id),onChange:s=>{s.target.checked?N(a=>[...a,t.id]):N(a=>a.filter(o=>o!==t.id))},className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                              focus:ring-geek-400 focus:ring-offset-0 bg-black/20`}),e.jsx("label",{htmlFor:`team-${t.id}`,className:"ml-3 text-sm font-mono text-neutral-300 cursor-pointer",children:t.name})]},t.id))})]})]})}),e.jsx(_,{isOpen:$,onClose:()=>b(!1),title:"停止容器",onConfirm:G,confirmText:"停止",confirmClassName:"bg-red-500/20 border-red-500/30 text-red-400 hover:bg-red-500/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{size:20,className:"text-red-400"}),e.jsxs("p",{className:"text-neutral-300 font-mono",children:["确定要停止选中的 ",e.jsx("span",{className:"text-red-400",children:l.length})," ","个容器吗？此操作不可恢复。"]})]})})]})}export{he as default};
