import{j as e,m,r as x,B as b,R as ne,A as ie,b as w,e as re,u as le,t as f,L as oe}from"./index-BSaselTA.js";import{a as de,b as ce}from"./contest-CZmJC1-C.js";import{a as me,g as xe}from"./team-DXrBcaxK.js";function z({title:t,value:i,valueColor:s="text-neutral-50",subTitle:d,subValue:j,subValueColor:h,showProgress:u,progressValue:g}){return e.jsxs("div",{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:t}),e.jsx("div",{className:`font-mono text-xl ${s}`,children:i})]}),d&&j&&e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:d}),e.jsx("div",{className:`font-mono text-xl ${h}`,children:j})]}),u&&e.jsx("div",{className:"h-2 bg-neutral-700 rounded-full overflow-hidden mt-2",children:e.jsx(m.div,{className:"h-full bg-geek-400",initial:{width:0},animate:{width:`${g}%`},transition:{duration:1}})})]})}function Q({notifications:t}){return e.jsxs(m.div,{className:`border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4\r
                overflow-hidden`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("span",{className:"text-neutral-400 text-sm",children:"Notifications"})}),e.jsx("div",{className:"space-y-2",children:t.map((i,s)=>e.jsxs(m.div,{className:"text-sm",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.1},children:[e.jsx("span",{className:`
                            ${i.type==="success"?"text-green-400":i.type==="info"?"text-geek-400":"text-yellow-400"}
                        `,children:"•"}),e.jsx("span",{className:"text-neutral-300 ml-2",children:i.message})]},s))})]})}function ue({contestStatus:t,notifications:i,onStatusExpired:s}){const[d,j]=x.useState(0);x.useEffect(()=>{let u;const g=()=>{const N=Date.parse(t.endTime),l=Date.now(),v=N-l;return v<=0?(j(0),t.status==="upcoming"?s==null||s("active"):t.status==="active"&&(s==null||s("ended")),!1):(j(Math.floor(v/1e3)),!0)};return g(),u=setInterval(()=>{g()},1e3),()=>{clearInterval(u)}},[t.status,t.startTime,t.endTime]);const h=u=>{const g=Math.floor(u/3600),N=Math.floor(u%3600/60),l=u%60;return`${String(g).padStart(2,"0")}:${String(N).padStart(2,"0")}:${String(l).padStart(2,"0")}`};return t.status==="upcoming"?e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsxs(m.div,{className:"col-span-3 grid grid-cols-3 gap-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx(z,{title:"Contest Status",value:"UPCOMING",valueColor:"text-yellow-400"}),e.jsx(z,{title:"Start Time",value:new Date(t.startTime).toLocaleString(),valueColor:"text-neutral-50"}),e.jsx(z,{title:"Time Until Start",value:h(d),valueColor:"text-neutral-50"})]}),e.jsx(Q,{notifications:i})]}):t.status==="ended"?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsxs(m.div,{className:"col-span-3 grid grid-cols-3 gap-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx(z,{title:"Time Remaining",value:h(d),valueColor:"text-neutral-50"}),e.jsx(z,{title:"Team Score",value:t.team.score.toLocaleString(),valueColor:"text-geek-400",subTitle:"Rank",subValue:`#${t.team.rank}`,subValueColor:"text-yellow-400"}),e.jsx(z,{title:"Flags Solved",value:`${t.team.solved}/${t.totalChallenges}`,valueColor:"text-neutral-50",showProgress:!0,progressValue:t.team.solved/t.totalChallenges*100})]}),e.jsx(Q,{notifications:i})]})}function ee({categories:t,selectedCategory:i,onCategoryChange:s,challenges:d,onChallengeClick:j,teamInfo:h}){const[u,g]=x.useState(null),N=x.useMemo(()=>i==="ALL"?d:d.filter(l=>l.category===i),[d,i]);return e.jsxs(m.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("div",{className:"flex gap-4",children:t.map(l=>e.jsx(b,{variant:i===l?"primary":"ghost",size:"sm",className:`min-w-0 px-4 py-1 ${i===l?"":"text-neutral-400 hover:text-neutral-200"}`,onClick:()=>s(l),children:l},l))}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex -space-x-2",children:h.members.map((l,v)=>e.jsx("div",{className:"w-8 h-8 rounded-lg border-2 border-black bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${l})`}},v))}),e.jsx("span",{className:"text-neutral-400 font-mono",children:h.name})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:N.map((l,v)=>e.jsxs(m.div,{className:`p-4 border rounded-md transition-all duration-200 cursor-pointer backdrop-blur-none
                ${l.solved?"border-geek-400/50 bg-geek-400/5 hover:bg-geek-400/10":"border-neutral-300/30 bg-black/30 hover:bg-black/50"}
                ${u===v?"scale-[1.02]":""}`,onMouseEnter:()=>g(v),onMouseLeave:()=>g(null),whileHover:{y:-2},onClick:()=>j(l),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-geek-400 font-mono",children:l.category}),e.jsx("h3",{className:"text-neutral-50 font-mono",children:l.title}),e.jsxs("span",{className:"text-yellow-400 font-mono text-sm",children:[l.points," pts"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400 text-sm",children:"Solves:"}),e.jsx("span",{className:"text-neutral-50 font-mono",children:l.solves})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:l.tags&&l.tags.map((c,r)=>e.jsx("span",{className:`
                      px-2 py-0.5 rounded 
                      text-xs font-mono
                      border backdrop-blur-none
                      ${l.solved?"border-geek-400/30 bg-geek-400/20 text-neutral-50":"border-neutral-600 bg-neutral-900 text-neutral-300"}
                    `,children:c},r))}),e.jsxs("div",{className:"flex items-center gap-3",children:[!l.isInitialized&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-black/50 border border-yellow-400/30 rounded",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-yellow-400 animate-pulse"}),e.jsx("span",{className:"text-yellow-400 text-xs font-mono",children:"Not Initialized"})]}),l.hasInstance&&l.instanceRunning&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-black/50 border border-green-400/30 rounded",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"}),e.jsx("span",{className:"text-green-400 text-xs font-mono",children:"Instance Running"})]}),l.solved&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-black/50 border border-geek-400/30 rounded",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-geek-400"}),e.jsx("span",{className:"text-geek-400 text-xs font-mono",children:"Solved"})]})]})]})]},l.id))})]})}function he({startTime:t,joined:i,onJoin:s}){const[d,j]=x.useState({days:0,hours:0,minutes:0,seconds:0});return x.useEffect(()=>{const h=()=>{const g=new Date(t)-new Date;g>0&&j({days:Math.floor(g/864e5),hours:Math.floor(g/36e5%24),minutes:Math.floor(g/1e3/60%60),seconds:Math.floor(g/1e3%60)})};h();const u=setInterval(h,1e3);return()=>clearInterval(u)},[t]),e.jsx(m.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl text-neutral-50 font-mono mb-2",children:"Contest Starting In"}),e.jsx("p",{className:"text-neutral-400",children:"Get ready for the challenge"})]}),e.jsx("div",{className:"flex gap-8",children:[{label:"DAYS",value:d.days},{label:"HOURS",value:d.hours},{label:"MINUTES",value:d.minutes},{label:"SECONDS",value:d.seconds}].map((h,u)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-[100px] h-[100px] border border-geek-400 rounded-md \r
                                bg-black/50 flex items-center justify-center\r
                                text-4xl text-geek-400 font-mono\r
                                shadow-[0_0_15px_rgba(89,126,247,0.1)]`,children:String(h.value).padStart(2,"0")}),e.jsx("span",{className:"mt-2 text-neutral-400 text-sm font-mono",children:h.label})]},u))}),e.jsx("div",{className:"flex flex-col items-center space-y-4",children:i?e.jsx("div",{className:`px-8 py-2 border border-green-400 rounded-md\r
                            bg-green-400/5 text-green-400 font-mono\r
                            shadow-[0_0_15px_rgba(74,222,128,0.1)]`,children:"JOINED"}):e.jsx(b,{variant:"primary",size:"lg",className:"!text-lg",onClick:s,children:"JOIN NOW"})})]})})}function pe({contestInfo:t,onViewScoreboard:i,onUploadWriteup:s,onViewChallenges:d,writeups:j=[]}){const[h,u]=x.useState(!1),g=r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:`${(r/(1024*1024)).toFixed(1)} MB`,N=r=>new Date(r).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),l=r=>{r.preventDefault(),u(!0)},v=()=>{u(!1)},c=r=>{r.preventDefault(),u(!1),r.dataTransfer.files&&r.dataTransfer.files[0]&&s(r.dataTransfer.files[0])};return e.jsx("div",{className:"w-full max-w-[800px] mx-auto",children:e.jsxs(m.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center space-y-4 mb-8",children:[e.jsx(m.div,{className:`w-16 h-16 mx-auto border-2 border-yellow-400 rounded-full\r
                            flex items-center justify-center`,initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},children:e.jsx("span",{className:"text-3xl",children:"🏆"})}),e.jsxs("h2",{className:"text-2xl font-mono text-neutral-50",children:["Contest ",e.jsx("span",{className:"text-yellow-400",children:"Completed"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(m.div,{className:"p-4 border border-neutral-300/30 rounded-md text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Duration"}),e.jsx("div",{className:"text-neutral-50 font-mono",children:(t==null?void 0:t.duration)||"24h"})]}),e.jsxs(m.div,{className:"p-4 border border-neutral-300/30 rounded-md text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Teams"}),e.jsx("div",{className:"text-neutral-50 font-mono",children:(t==null?void 0:t.totalTeams)||"256"})]}),e.jsxs(m.div,{className:"p-4 border border-neutral-300/30 rounded-md text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Challenges"}),e.jsx("div",{className:"text-neutral-50 font-mono",children:(t==null?void 0:t.totalChallenges)||"30"})]})]}),e.jsxs(m.div,{className:"p-6 border border-geek-400 rounded-md bg-geek-400/5",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-neutral-50 font-mono",children:"Your Team Performance"}),e.jsxs("span",{className:"text-geek-400 font-mono",children:["#",(t==null?void 0:t.teamRank)||"1"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Score"}),e.jsx("div",{className:"text-geek-400 font-mono text-xl",children:(t==null?void 0:t.teamScore)||"0"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Solved"}),e.jsxs("div",{className:"text-neutral-50 font-mono text-xl",children:[(t==null?void 0:t.teamSolved)||"0","/",(t==null?void 0:t.totalChallenges)||"0"]})]})]})]}),e.jsxs(m.div,{className:"space-y-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},children:[e.jsx("div",{className:"text-neutral-50 font-mono text-lg",children:"Writeups"}),e.jsxs(m.div,{className:`border-2 border-dashed rounded-md p-6 text-center cursor-pointer transition-all duration-300
                ${h?"border-yellow-400 bg-yellow-400/10":"border-neutral-400 hover:border-yellow-400 hover:bg-yellow-400/5"}`,whileHover:{scale:1.01},onDragOver:l,onDragLeave:v,onDrop:c,onClick:()=>document.getElementById("writeup-upload").click(),children:[e.jsx("input",{id:"writeup-upload",type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:r=>{r.target.files&&r.target.files[0]&&(s(r.target.files[0]),r.target.value="")}}),e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("span",{className:"text-2xl",children:"📄"}),e.jsx("span",{className:"text-neutral-300 font-mono",children:"Drag and drop files or click here to upload your writeups"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Supports PDF, DOC, DOCX"})]})]}),j.length>0&&e.jsxs(m.div,{className:"mt-4 border border-neutral-300/30 rounded-md overflow-hidden",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{delay:.8},children:[e.jsx("div",{className:"p-3 bg-neutral-800/50 border-b border-neutral-300/30",children:e.jsx("div",{className:"text-neutral-300 font-mono text-sm",children:"Uploaded Writeups"})}),e.jsx("div",{className:"divide-y divide-neutral-300/20",children:j.map(r=>e.jsx("div",{className:"p-3 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-xl",children:r.suffix===".pdf"?"📕":r.suffix===".docx"||r.suffix===".doc"?"📘":"📄"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-50 font-mono text-sm",children:r.filename}),e.jsxs("div",{className:"text-neutral-400 text-xs flex space-x-3",children:[e.jsx("span",{children:g(r.size)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:N(r.date)})]})]})]})},r.id))})]})]}),e.jsxs(m.div,{className:"flex justify-center gap-4 pt-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.9},children:[e.jsx(b,{variant:"outline",size:"lg",onClick:d,children:"VIEW CHALLENGES"}),e.jsx(b,{variant:"primary",size:"lg",onClick:i,children:"VIEW FINAL SCOREBOARD"})]})]})]})})}const ae=ne.memo(({hint:t,index:i})=>{const[s,d]=x.useState(!1);return e.jsxs(m.div,{className:`
                border border-neutral-300/30 rounded-md overflow-hidden
                transition-colors duration-200
                ${s?"bg-neutral-900/50":"bg-black/20"}
            `,children:[e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer hover:bg-neutral-800/30",onClick:()=>d(!s),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-geek-400 font-mono text-sm",children:["#",i+1]}),e.jsx("span",{className:"text-neutral-300 font-mono text-sm",children:s?"Hide Hint":"Show Hint"})]}),e.jsx(m.span,{className:"text-neutral-400 text-[10px]",animate:{rotate:s?180:0},transition:{duration:.2},children:"▼"})]}),e.jsx(m.div,{initial:!1,animate:{height:s?"auto":0,opacity:s?1:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"p-3 border-t border-neutral-300/10",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:t})})})]})});ae.displayName="HintItem";function te({challenge:t,contest:i,isOpen:s,onClose:d,onInitialize:j,onReset:h,onLaunchInstance:u,onExtendInstance:g,onDestroyInstance:N,onSubmitFlag:l,onDownloadAttachment:v}){var F;const[c,r]=x.useState({initializing:!1,resetting:!1,launching:!1,extending:!1,destroying:!1,submitting:!1}),[k,L]=x.useState(null),[A,T]=x.useState(""),[Z,P]=x.useState({}),[O,G]=x.useState(0),S=x.useRef(null);x.useEffect(()=>{t!=null&&t.instanceTimeLeft&&G(t.instanceTimeLeft)},[t==null?void 0:t.instanceTimeLeft]),x.useEffect(()=>{if(!(!t||!s)&&!(!t.instanceRunning||!O))return S.current&&clearInterval(S.current),S.current=setInterval(()=>{G(o=>o<=0?(clearInterval(S.current),0):o-1)},1e3),()=>{S.current&&clearInterval(S.current)}},[t==null?void 0:t.instanceRunning,s]);const U=o=>{o=Math.floor(o);const p=Math.floor(o/3600),I=Math.floor(o%3600/60),n=Math.floor(o%60);return`${p.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},D=async(o,p,...I)=>{r(n=>({...n,[o]:!0})),L(null);try{await p(...I)}catch(n){L(n.message)}finally{r(n=>({...n,[o]:!1}))}},R=()=>{D("initializing",j,t.id)},H=()=>{D("resetting",h,t.id)},_=()=>{D("launching",u,t.id)},W=()=>{D("extending",g,t.id)},B=()=>{D("destroying",N,t.id)},V=async o=>{if(o.preventDefault(),!!A.trim()){r(p=>({...p,submitting:!0})),L(null);try{(await l(t.id,A)).success&&(T(""),d())}catch(p){L(p.message)}finally{r(p=>({...p,submitting:!1}))}}},M=o=>{navigator.clipboard.writeText(o),P(p=>({...p,[o]:!0})),setTimeout(()=>{P(p=>({...p,[o]:!1}))},2e3)},Y=()=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.instanceRunning?"bg-green-400":"bg-neutral-400"}`}),e.jsx("span",{className:"text-neutral-50 font-mono text-sm",children:t.instanceRunning?"RUNNING":"NOT RUNNING"})]}),t.instanceRunning&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-400 text-sm",children:"Time:"}),e.jsx("span",{className:"text-yellow-400 font-mono text-sm",children:U(O)})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.instanceRunning?e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"primary",size:"sm",onClick:W,disabled:c.extending,className:"border-yellow-400 text-yellow-400 hover:bg-yellow-400/10",children:c.extending?"EXTENDING...":"EXTEND TIME"}),e.jsx(b,{variant:"danger",size:"sm",onClick:B,disabled:c.destroying,children:c.destroying?"DESTROYING...":"DESTROY"})]}):e.jsx(b,{variant:"primary",size:"sm",onClick:_,disabled:c.launching,loading:c.launching,className:c.launching?"border-yellow-400 text-yellow-400":"",children:c.launching?"LAUNCHING...":"LAUNCH INSTANCE"})})]}),t.instanceRunning&&e.jsx("div",{className:"h-1.5 bg-neutral-700 rounded-full overflow-hidden",children:e.jsx(m.div,{className:"h-full bg-yellow-400",initial:{width:0},animate:{width:`${O/t.instanceDuration*100}%`},transition:{duration:.5}})}),t.instanceRunning&&t.instanceIP&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between p-2 bg-neutral-900 rounded-md",children:e.jsx("span",{className:"text-neutral-400 text-xs",children:"Address:"})}),t.instanceIP.map((o,p)=>e.jsxs("div",{className:"flex justify-between p-1.5",children:[e.jsx("span",{className:"font-mono text-neutral-50 text-sm",onClick:()=>M(o),children:o}),e.jsx(b,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-geek-400",onClick:()=>M(o),children:Z[o]?"✓":"📋"})]},p))]})]}),J=()=>!t.hints||t.hints.length===0?null:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Hints"}),e.jsx("div",{className:"space-y-2",children:t.hints.map((o,p)=>e.jsx(ae,{hint:o,index:p},`hint-${t.id}-${p}`))})]});return s?t.isInitialized?e.jsx(ie,{children:s&&e.jsxs("div",{className:"fixed inset-0 z-[900] flex items-center justify-center",children:[e.jsx(m.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{T(""),d()}}),e.jsx("div",{className:"relative z-10 w-full max-w-[800px] p-4",children:e.jsxs(m.div,{className:"relative w-full bg-black/80 border border-neutral-300 rounded-md",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("div",{className:"p-5 border-b border-neutral-300/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-geek-400 font-mono",children:t.category}),e.jsx("h2",{className:"text-2xl text-neutral-50 font-mono",children:t.title}),e.jsxs("span",{className:"text-yellow-400 font-mono",children:[t.points," pts"]})]}),e.jsx(b,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-50",onClick:()=>{T(""),d()},children:"✕"})]})}),e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1.5 flex-1 min-w-0",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Description"}),e.jsx("p",{className:"text-neutral-50",children:t.description})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{variant:"primary",size:"action",onClick:H,disabled:c.resetting,loading:c.resetting,className:c.resetting?"border-yellow-400 text-yellow-400":"",children:c.resetting?"RESETTING...":"RESET FLAG"})})]}),((F=t.attachments)==null?void 0:F.length)>0&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Attachments"}),e.jsx("div",{className:"space-y-1.5",children:t.attachments.map((o,p)=>e.jsxs(m.a,{href:o.url,target:"_blank",rel:"noopener noreferrer",className:`flex items-center gap-2 p-2 border border-neutral-300/30 rounded-md\r
                                                        text-neutral-300 hover:text-geek-400 hover:border-geek-400\r
                                                        transition-colors duration-200 cursor-pointer`,whileHover:{x:5},onClick:I=>{I.preventDefault(),v(o)},children:[e.jsx("span",{className:"text-sm",children:"📎"}),e.jsx("span",{className:"font-mono text-sm",children:o.name}),e.jsx("span",{className:"text-neutral-400 text-sm ml-auto",children:o.size})]},p))})]}),J(),t.hasInstance&&Y(),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"text-neutral-400 font-mono text-sm",children:"Submit Flag"}),e.jsxs("form",{onSubmit:V,className:"flex gap-2",children:[e.jsx("input",{type:"text",onChange:o=>T(o.target.value),placeholder:`${i.prefix}{...}`,className:`flex-1 h-[40px] bg-black/20 border border-neutral-300 rounded-md px-4\r
                                                text-neutral-50 placeholder-neutral-400\r
                                                focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                                                transition-all duration-200`}),e.jsx(b,{type:"submit",variant:"primary",size:"action",disabled:t.isSolved||c.submitting||!A.trim(),children:c.submitting?"SUBMITTING...":`${t.isSolved?"SOLVED":"SUBMIT"} ${t.attempts}/${t.maxAttempts||"∞"}`})]}),k&&e.jsx(m.div,{className:"text-red-400 text-sm mt-2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:k})]})]})]})})]})}):e.jsxs("div",{className:"fixed inset-0 z-[900] flex items-center justify-center",children:[e.jsx(m.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{T(""),d()}}),e.jsx("div",{className:"relative z-10 w-full max-w-[800px] p-4",children:e.jsxs(m.div,{className:"relative w-full bg-black/80 border border-neutral-300 rounded-md",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("div",{className:"p-5 border-b border-neutral-300/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-geek-400 font-mono",children:t.category}),e.jsx("h2",{className:"text-2xl text-neutral-50 font-mono",children:t.title}),e.jsxs("span",{className:"text-yellow-400 font-mono",children:[t.points," pts"]})]}),e.jsx(b,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-50",onClick:()=>{T(""),d()},children:"✕"})]})}),e.jsxs("div",{className:"p-12 flex flex-col items-center justify-center space-y-4",children:[k&&e.jsx(m.div,{className:"text-red-400 text-sm",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:k}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Initialize the challenge to view its content"}),e.jsx(b,{variant:"primary",size:"action",onClick:R,disabled:c.initializing,loading:c.initializing,className:c.initializing?"border-yellow-400 text-yellow-400":"",children:c.initializing?"INITIALIZING...":"INITIALIZE CHALLENGE"})]})]})})]}):null}const ge=t=>w({url:`/contests/${t}/challenges`,method:"GET"}),se=(t,i)=>w({url:`/contests/${t}/challenges/${i}`,method:"GET"}),fe=(t,i)=>w({url:`/contests/${t}/challenges/${i}/init`,method:"POST"}),je=(t,i)=>w({url:`/contests/${t}/challenges/${i}/attachment`,method:"GET",responseType:"blob"}).then(s=>s),ve=(t,i)=>w({url:`/contests/${t}/challenges/${i}/start`,method:"POST"}),ye=(t,i)=>w({url:`/contests/${t}/challenges/${i}/increase`,method:"POST"}),be=(t,i)=>w({url:`/contests/${t}/challenges/${i}/stop`,method:"POST"}),Ne=(t,i,s)=>w({url:`/contests/${t}/challenges/${i}/submit`,method:"POST",data:s}),we=(t,i)=>w({url:`/contests/${t}/challenges/${i}/reset`,method:"POST"}),Ce=(t,i)=>{const s=new FormData;return s.append("writeup",i),w({url:`/contests/${t}/writeups`,method:"POST",data:s,headers:{"Content-Type":"multipart/form-data"}})},ke=t=>w({url:`/contests/${t}/writeups`,method:"GET"}),Se=(t,i)=>{const s=new Date().getTime(),d=new Date(t.start).getTime(),j=d+t.duration*1e3;return{status:s<d?"upcoming":s>j?"ended":"running",startTime:new Date(d).toISOString(),endTime:new Date(j).toISOString(),joined:!0,duration:t.duration/3600,prefix:t.prefix,team:{score:i.data.score,rank:i.data.rank||0,solved:i.data.solved.reduce((h,u)=>h+u.solved,0)},teams:t.teams,totalChallenges:i.data.solved.reduce((h,u)=>h+u.all,0)}},Te=t=>{const i=new Set(["ALL"]);return t.forEach(s=>{s.category&&i.add(s.category)}),Array.from(i)},De=t=>({id:t.id,category:t.category,title:t.name,points:t.current_score,description:t.desc,attachments:[],hasInstance:t.type==="pods",instanceRunning:t.remote.status==="Running",instanceIP:t.remote.target||[""],instanceDuration:t.remote.remaining||0,instanceTimeLeft:t.remote.remaining||0,solves:t.solvers||0,isInitialized:t.init,solved:t.solved,attempts:t.attempts,maxAttempts:t.attempt,scoreInfo:{initial:t.score,current:t.current_score,minimum:t.min_score,decay:t.decay,scoreType:t.score_type},hints:t.hints,tags:t.tags,hidden:t.hidden});function Ie(){const{contestId:t}=re(),i=le(),[s,d]=x.useState({}),[j,h]=x.useState(["ALL"]),[u,g]=x.useState("ALL"),[N,l]=x.useState([]),[v,c]=x.useState(null),[r,k]=x.useState(!0),[L,A]=x.useState(null),[T,Z]=x.useState([]),[P,O]=x.useState([]),[G,S]=x.useState(!1);x.useEffect(()=>{U()},[t]),x.useEffect(()=>{(s==null?void 0:s.status)==="ended"&&D()},[t,s==null?void 0:s.status]);const U=async()=>{try{const[n,a,y,$,X]=await Promise.all([de(t),ge(t),me(t),xe(t),ce(t)]);if(n.code===200&&y.code===200){const q=Se(n.data,$);d(q),Z(X.data.notices.map(C=>({type:C.type||"info",message:C.content})));const K=Te(a.data.challenges);h(K),A({members:y.data.map(C=>C.avatar),name:$.data.name});const E=a.data.challenges.map(C=>De(C));l(E)}}catch(n){if((n==null?void 0:n.response.status)===403){f.danger({title:"403 Forbidden",description:"您的队伍已被封禁"}),i(`/contests/${t}`);return}f.danger({title:"获取数据失败",description:n.message})}finally{k(!1)}},D=async()=>{try{const n=await ke(t);n.code===200&&n.data.writeups&&O(n.data.writeups)}catch(n){console.error("Failed to fetch writeups:",n)}},R=async()=>{if(v)try{const n=await se(t,v.id);if(n.code===200){const a={...v,attachments:n.data.file?[{name:n.data.file}]:[],isInitialized:n.data.init,isSolved:n.data.solved,instanceRunning:n.data.remote.status==="Running",instanceIP:n.data.remote.target||[""],instanceDuration:n.data.remote.remaining||0,instanceTimeLeft:n.data.remote.remaining||0};c(a),l(y=>y.map($=>$.id===a.id?a:$))}}catch(n){console.error("Failed to refresh challenge status:",n)}},H=async n=>{try{const a=await fe(t,n);a.code===200&&(f.success({title:a.msg||"题目初始化成功"}),await R())}catch(a){f.danger({title:"初始化失败",description:a.message})}},_=async n=>{try{const a=await we(t,n);a.code===200&&(f.success({title:a.msg||"题目重置成功"}),await R())}catch(a){f.danger({title:"重置失败",description:a.message})}},W=async n=>{try{const a=await ve(t,n);a.code===200&&(f.success({title:a.msg||"靶机启动成功"}),await R())}catch(a){f.danger({title:"启动失败",description:a.message})}},B=async n=>{try{const a=await ye(t,n);if(a.code===200){f.success({title:a.msg||"延长时间成功"}),await R();return}f.danger({title:"延长时间失败",description:a.msg})}catch(a){f.danger({title:"延长时间失败",description:a.message})}},V=async n=>{try{const a=await be(t,n);a.code===200&&(f.success({title:a.msg||"靶机已销毁"}),await R())}catch(a){f.danger({title:"销毁失败",description:a.message})}},M=async(n,a)=>{try{const y=await Ne(t,n,{flag:a});return await R(),await U(),y.code===200?(f.success({title:y.msg||"提交成功"}),{success:!0,message:"提交成功！"}):(f.danger({title:y.msg}),{success:!0,message:y.msg})}catch(y){return{success:!1,message:y.message}}},Y=n=>{g(n)},J=async n=>{try{const a=await se(t,n.id);if(a.code===200){const y={...n,attachments:a.data.file?[{name:a.data.file}]:[],isInitialized:a.data.init,isSolved:a.data.solved,instanceRunning:a.data.remote.status==="Running",instanceIP:a.data.remote.target||[""],instanceTimeLeft:a.data.remote.remaining||0,instanceDuration:a.data.remote.duration||3600};c(y)}}catch(a){console.error("Failed to get challenge status:",a),f.danger({title:"获取题目状态失败",description:a.message}),c(n)}},F=async n=>{var a;try{const y=await je(t,v.id),$=(a=y.headers)==null?void 0:a["content-disposition"];let X=n.name;if($){const C=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec($);C!=null&&C[1]&&(X=C[1].replace(/['"]/g,""))}const q=new Blob([y.data]),K=window.URL.createObjectURL(q),E=document.createElement("a");E.href=K,E.setAttribute("download",X),document.body.appendChild(E),E.click(),document.body.removeChild(E),window.URL.revokeObjectURL(K),f.success({title:"附件下载成功"})}catch(y){console.error("Failed to download attachment:",y),f.danger({title:"下载失败",description:y.message})}},o=async n=>{try{k(!0);const a=await Ce(t,n);a.code===200?(f.success({title:"题解上传成功",description:"感谢您分享您的解题思路！"}),D()):f.danger({title:"题解上传失败",description:a.msg||"请稍后再试"})}catch(a){console.error("Failed to upload writeup:",a),f.danger({title:"题解上传失败",description:a.message||"发生了未知错误"})}finally{k(!1)}},p=()=>{S(!0)},I=()=>{S(!1),c(null)};return r?e.jsx(oe,{}):e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsx(ue,{contestStatus:s,onStatusExpired:n=>{d(a=>({...a,status:n}))},notifications:T}),(s==null?void 0:s.status)==="upcoming"?e.jsx(he,{startTime:s.startTime,joined:s.joined,onJoin:()=>{}}):(s==null?void 0:s.status)==="ended"?G?e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx(b,{variant:"secondary",size:"sm",onClick:I,children:"← BACK TO CONTEST SUMMARY"})}),e.jsx(ee,{categories:j,selectedCategory:u,onCategoryChange:Y,challenges:N,onChallengeClick:J,teamInfo:L}),e.jsx(te,{challenge:v,contest:s,isOpen:!!v,onClose:()=>c(null),onInitialize:H,onReset:_,onLaunchInstance:W,onExtendInstance:B,onDestroyInstance:V,onSubmitFlag:M,onDownloadAttachment:F})]}):e.jsx(pe,{contestInfo:{duration:`${s.duration}h`,totalTeams:s.teams,totalChallenges:s.totalChallenges,teamRank:s.team.rank,teamScore:s.team.score,teamSolved:s.team.solved},onViewScoreboard:()=>{i(`/contests/${t}/scoreboard`)},onUploadWriteup:o,onViewChallenges:p,writeups:P}):e.jsxs("div",{children:[e.jsx(ee,{categories:j,selectedCategory:u,onCategoryChange:Y,challenges:N,onChallengeClick:J,teamInfo:L}),e.jsx(te,{challenge:v,contest:s,isOpen:!!v,onClose:()=>c(null),onInitialize:H,onReset:_,onLaunchInstance:W,onExtendInstance:B,onDestroyInstance:V,onSubmitFlag:M,onDownloadAttachment:F})]})]})}export{Ie as default};
