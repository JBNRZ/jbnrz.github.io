import{e as X,r as n,t as l,j as e,m as v,B as h,L as Y}from"./index-T-fbxVIN.js";import{D as Z,k as ee,e as te,E as se,F as ae}from"./contest-3Kk5PDXM.js";import{A as ne}from"./AdminPagination-CkJjWKuQ.js";import{A as D,M as k}from"./AdminModal-hTsnbR6b.js";import{c as z}from"./createReactComponent-BWR0b8rR.js";import{I as le}from"./IconTable-Tgr9OMJY.js";import"./IconX-BrzqeyDW.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var F=z("outline","ban","IconBan",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M5.7 5.7l12.6 12.6",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var re=z("outline","filter","IconFilter",[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var I=z("outline","player-play","IconPlayerPlay",[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]]);function ue(){const{id:x}=X(),[m,T]=n.useState([]),[y,O]=n.useState(0),[w,M]=n.useState(1),[$,P]=n.useState(!1),[i,A]=n.useState({user_id:"",team_id:"",challenge_id:"",limit:10,offset:0}),[c,f]=n.useState([]),[B,g]=n.useState(!1),[E,j]=n.useState(!1),[C,L]=n.useState([]),[S,H]=n.useState([]),[r,u]=n.useState([]),[o,p]=n.useState([]),b=10;n.useEffect(()=>{N(),V(),R()},[x]),n.useEffect(()=>{N()},[w,i.user_id,i.team_id,i.challenge_id]);const N=async()=>{P(!0);try{const t={...i,limit:b,offset:(w-1)*b};Object.keys(t).forEach(a=>{t[a]===""&&delete t[a]});const s=await Z(parseInt(x),t);s.code===200?(T(s.data.victims||[]),O(s.data.count||0)):l.danger({description:s.msg||"获取容器列表失败"})}catch(t){console.error("获取容器列表失败:",t),l.danger({description:"获取容器列表失败"})}finally{P(!1)}},V=async()=>{try{const t=await ee(parseInt(x),{limit:100,offset:0});t.code===200&&L(t.data.teams||[])}catch(t){console.error("获取团队列表失败:",t)}},R=async()=>{try{const t=await te(parseInt(x));t.code===200&&H(t.data.challenges||[])}catch(t){console.error("获取题目列表失败:",t)}},_=(t,s)=>{A(a=>({...a,[t]:s})),M(1)},W=t=>{M(t)},q=t=>{f(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},G=()=>{c.length===m.length?f([]):f(m.map(t=>t.id))},J=async()=>{if(c.length===0){l.warning({description:"请选择要停止的容器"});return}try{const t=await se(parseInt(x),c);t.code===200?(l.success({description:"停止容器成功"}),f([]),N()):l.danger({description:t.msg||"停止容器失败"})}catch(t){console.error("停止容器失败:",t),l.danger({description:"停止容器失败"})}j(!1)},K=async()=>{if(o.length===0||r.length===0){l.warning({description:"请选择题目和团队"});return}try{const t=await ae(parseInt(x),o,r);t.code===200?(l.success({description:"开启容器成功"}),p([]),u([]),N()):l.danger({description:t.msg||"开启容器失败"})}catch(t){console.error("开启容器失败:",t),l.danger({description:"开启容器失败"})}g(!1)},Q=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",U=t=>{if(!t)return"-";const s=Math.floor(t/3600),a=Math.floor(t%3600/60),d=Math.floor(t%60);return`${s}h ${a}m ${d}s`};return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"容器管理"}),e.jsx("p",{className:"text-neutral-400 font-mono mt-2",children:"管理比赛中的容器实例，支持批量开启和停止操作"})]}),e.jsxs(v.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(re,{size:20,className:"text-neutral-400"}),e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"过滤条件"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"用户ID"}),e.jsx("input",{type:"text",value:i.user_id,onChange:t=>_("user_id",t.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                        text-neutral-50 placeholder-neutral-500\r
                        focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                        transition-all duration-200`,placeholder:"输入用户ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"团队ID"}),e.jsx("input",{type:"text",value:i.team_id,onChange:t=>_("team_id",t.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                        text-neutral-50 placeholder-neutral-500\r
                        focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                        transition-all duration-200`,placeholder:"输入团队ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"题目ID"}),e.jsx("input",{type:"text",value:i.challenge_id,onChange:t=>_("challenge_id",t.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                        text-neutral-50 placeholder-neutral-500\r
                        focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                        transition-all duration-200`,placeholder:"输入题目ID"})]})]})]}),e.jsxs(v.div,{className:"border border-neutral-300/30 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(I,{size:20,className:"text-neutral-400"}),e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"选择要开启的容器"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-mono text-neutral-400",children:"选择题目"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>p(S.map(t=>t.id)),className:"!text-xs !h-6 !px-2",children:"全选"}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>p([]),className:"!text-xs !h-6 !px-2",children:"清空"})]})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-neutral-300/30 rounded-md bg-black/10",children:S.map(t=>e.jsxs("div",{className:"flex items-center p-3 hover:bg-black/30 transition-colors",children:[e.jsx("input",{type:"checkbox",id:`challenge-${t.id}`,checked:o.includes(t.id),onChange:s=>{s.target.checked?p(a=>[...a,t.id]):p(a=>a.filter(d=>d!==t.id))},className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                              focus:ring-geek-400 focus:ring-offset-0 bg-black/20`}),e.jsx("label",{htmlFor:`challenge-${t.id}`,className:"ml-3 text-sm font-mono text-neutral-300 cursor-pointer",children:t.name})]},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-mono text-neutral-400",children:"选择团队"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>u(C.map(t=>t.id)),className:"!text-xs !h-6 !px-2",children:"全选"}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>u([]),className:"!text-xs !h-6 !px-2",children:"清空"})]})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-neutral-300/30 rounded-md bg-black/10",children:C.map(t=>e.jsxs("div",{className:"flex items-center p-3 hover:bg-black/30 transition-colors",children:[e.jsx("input",{type:"checkbox",id:`team-${t.id}`,checked:r.includes(t.id),onChange:s=>{s.target.checked?u(a=>[...a,t.id]):u(a=>a.filter(d=>d!==t.id))},className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                              focus:ring-geek-400 focus:ring-offset-0 bg-black/20`}),e.jsx("label",{htmlFor:`team-${t.id}`,className:"ml-3 text-sm font-mono text-neutral-300 cursor-pointer",children:t.name})]},t.id))})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs(h,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(I,{size:16}),onClick:()=>g(!0),disabled:o.length===0||r.length===0,children:["开启容器 (",o.length," 题目, ",r.length," 团队)"]})})]}),e.jsxs(v.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"p-4 bg-black/20 border-b border-neutral-300/30 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{size:20,className:"text-neutral-400"}),e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"容器列表"})]}),e.jsxs(h,{variant:"danger",size:"sm",align:"icon-left",icon:e.jsx(F,{size:16}),onClick:()=>j(!0),disabled:c.length===0,children:["停止容器 (",c.length,")"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/40",children:[e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono",children:e.jsx("input",{type:"checkbox",checked:c.length===m.length&&m.length>0,onChange:G,className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                              focus:ring-geek-400 focus:ring-offset-0 bg-black/20`})}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"ID"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"题目"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"团队"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"用户"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"IP段"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"远程地址"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"开始时间"}),e.jsx("th",{className:"p-4 text-left text-neutral-400 font-mono whitespace-nowrap",children:"剩余时间"})]})}),e.jsx("tbody",{children:$?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"p-8 text-center",children:e.jsx(Y,{})})}):m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"p-8 text-center text-neutral-400",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("svg",{className:"w-12 h-12 text-neutral-300/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("span",{className:"font-mono",children:"暂无容器数据"})]})})}):m.map((t,s)=>e.jsxs(v.tr,{className:"border-t border-neutral-300/10 hover:bg-black/40 transition-colors",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.05},whileHover:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:[e.jsx("td",{className:"p-4 text-neutral-300 font-mono",children:e.jsx("input",{type:"checkbox",checked:c.includes(t.id),onChange:()=>q(t.id),className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                                  focus:ring-geek-400 focus:ring-offset-0 bg-black/20`})}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.id}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.challenge}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.team}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.user}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:t.ip_block}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono",children:t.remote&&t.remote.length>0?e.jsx("div",{className:"space-y-1",children:t.remote.map((a,d)=>e.jsx("div",{className:"text-xs bg-black/30 text-geek-400 px-2 py-1 rounded border border-geek-400/30",children:a},d))}):e.jsx("span",{className:"text-neutral-400",children:"-"})}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:Q(t.start)}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono whitespace-nowrap",children:U(t.remaining)})]},t.id))})]})}),y>0&&e.jsx("div",{className:"p-4 border-t border-neutral-300/30 bg-black/20 flex justify-center",children:e.jsx(ne,{total:Math.ceil(y/b),current:w,pageSize:b,onChange:W,showTotal:!0,totalItems:y})})]}),e.jsx(D,{isOpen:B,onClose:()=>g(!1),title:"确认开启容器",footer:e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:()=>g(!1),children:"取消"}),e.jsx(k,{variant:"primary",onClick:K,children:"确认开启"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{size:20,className:"text-geek-400"}),e.jsx("p",{className:"text-neutral-300 font-mono",children:"确定要为以下选中的组合开启容器吗？"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-mono text-neutral-400 mb-2",children:["选中的题目 (",o.length,"个):"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border border-neutral-300/30 rounded-md bg-black/10 p-2",children:o.map(t=>{const s=S.find(a=>a.id===t);return s?e.jsxs("div",{className:"text-sm font-mono text-geek-400 py-1",children:["• ",s.name]},t):null})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-mono text-neutral-400 mb-2",children:["选中的团队 (",r.length,"个):"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border border-neutral-300/30 rounded-md bg-black/10 p-2",children:r.map(t=>{const s=C.find(a=>a.id===t);return s?e.jsxs("div",{className:"text-sm font-mono text-geek-400 py-1",children:["• ",s.name]},t):null})})]})]}),e.jsx("div",{className:"bg-neutral-800/50 border border-neutral-600/30 rounded-md p-3",children:e.jsxs("p",{className:"text-xs font-mono text-neutral-400",children:["将为 ",e.jsx("span",{className:"text-geek-400",children:o.length})," 个题目 ×"," ",e.jsx("span",{className:"text-geek-400",children:r.length})," 个团队 =",e.jsxs("span",{className:"text-green-400",children:[" ",o.length*r.length]})," ","个容器组合开启容器"]})})]})}),e.jsx(D,{isOpen:E,onClose:()=>j(!1),title:"停止容器",footer:e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:()=>j(!1),children:"取消"}),e.jsx(k,{variant:"danger",onClick:J,children:"停止"})]}),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{size:20,className:"text-red-400"}),e.jsxs("p",{className:"text-neutral-300 font-mono",children:["确定要停止选中的 ",e.jsx("span",{className:"text-red-400",children:c.length})," ","个容器吗？此操作不可恢复。"]})]})})]})}export{ue as default};
