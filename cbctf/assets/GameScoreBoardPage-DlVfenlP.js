import{j as e,m as f,B as b,e as R,r as h,L as _}from"./index-t9z4CTH9.js";import{I as M,S as B}from"./ScoreboardTable-Cq4oo9oc.js";import{I as F}from"./IconTable-wcUJ_4mL.js";import{c as G,a as H}from"./contest-DaM-JnOu.js";import{g as O}from"./team-DOtdZWk3.js";import"./createReactComponent-Dxssitb0.js";function U({totalTeams:t,totalSolves:d,highestScore:n,totalPlayers:c}){const o=[{label:"Total Teams",value:t,valueClass:"text-neutral-50"},{label:"Total Players",value:c,valueClass:"text-neutral-50"},{label:"Total Solves",value:d,valueClass:"text-geek-400"},{label:"Highest Score",value:n,valueClass:"text-yellow-400"}];return e.jsx("div",{className:"grid grid-cols-4 gap-6",children:o.map((x,m)=>e.jsxs(f.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:m*.05},children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:x.label}),e.jsx(f.div,{className:`font-mono text-2xl ${x.valueClass}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:m*.05},children:x.value})]},m))})}const K={Web:"bg-blue-400",Crypto:"bg-purple-400",Pwn:"bg-red-400",Reverse:"bg-green-400",Misc:"bg-yellow-400"};function $({solved:t=[],totalSolved:d=0}){return!Array.isArray(t)||t.length===0?null:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[t.map(({category:n,solved:c,all:o})=>e.jsxs("div",{className:"flex flex-col items-center",title:`${n}: ${c}/${o}`,children:[e.jsx("div",{className:"text-[10px] font-mono text-neutral-400 mb-1",children:n.toUpperCase()}),e.jsx("div",{className:"h-6 w-1.5 rounded-full bg-neutral-700 relative overflow-hidden",children:e.jsx(f.div,{className:`absolute bottom-0 left-0 right-0 ${K[n]||"bg-neutral-400"}`,initial:{height:0},animate:{height:`${c/o*100}%`},transition:{duration:1}})}),e.jsx("div",{className:"text-[10px] font-mono text-neutral-300 mt-1",children:c})]},n)),e.jsx("div",{className:"h-full w-[1px] bg-neutral-300/10 mx-2"}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-2xl font-mono text-geek-400",children:d}),e.jsx("div",{className:"text-[10px] text-neutral-400",children:"TOTAL"})]})]})}function w({currentPage:t,totalPages:d,onPageChange:n}){const c=Array.from({length:d},(o,x)=>x+1);return e.jsxs(f.div,{className:"flex items-center justify-center gap-2 mt-6 border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-2",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx(b,{variant:"ghost",size:"icon",className:`w-8 h-8 ${t===1?"!text-neutral-600 cursor-not-allowed":"!text-neutral-400 hover:!text-neutral-200 !border-neutral-300/30 hover:!border-neutral-300"}`,onClick:()=>t>1&&n(t-1),disabled:t===1,children:"←"}),c.map(o=>e.jsx(b,{variant:t===o?"primary":"ghost",size:"icon",className:`w-8 h-8 ${t===o?"!bg-geek-400/10":"!text-neutral-400 hover:!text-neutral-200 !border-neutral-300/30 hover:!border-neutral-300"}`,onClick:()=>n(o),children:o},o)),e.jsx(b,{variant:"ghost",size:"icon",className:`w-8 h-8 ${t===d?"!text-neutral-600 cursor-not-allowed":"!text-neutral-400 hover:!text-neutral-200 !border-neutral-300/30 hover:!border-neutral-300"}`,onClick:()=>t<d&&n(t+1),disabled:t===d,children:"→"})]})}function W({team:t}){return t?e.jsx(f.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg border border-neutral-300 bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${t.avatar||"/default-team-avatar.png"})`}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-50 font-mono text-lg",children:t.name}),e.jsxs("div",{className:"text-neutral-400 text-sm",children:["Rank #",t.rank]})]})]}),t.solved&&e.jsx($,{solved:t.solved,totalSolved:t.totalSolved}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Score"}),e.jsx("div",{className:"text-geek-400 font-mono text-2xl",children:t.score.toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-neutral-400 text-sm mb-1",children:"Solved"}),e.jsx("div",{className:"text-neutral-50 font-mono text-2xl",children:t.totalSolved})]})]})]})}):null}function q({stats:t,teams:d,userTeam:n,currentPage:c,totalPages:o,onPageChange:x,viewMode:m="ranking",onViewModeChange:g,challenges:j=[],totalCount:y=0}){return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[n&&e.jsx(W,{team:n}),e.jsx(U,{...t}),g&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-black/30 border border-neutral-300/30 rounded-md",children:[e.jsx(b,{variant:m==="ranking"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(M,{size:16}),onClick:()=>g("ranking"),children:"排名视图"}),e.jsx(b,{variant:m==="table"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(F,{size:16}),onClick:()=>g("table"),children:"表格视图"})]})}),m==="ranking"?e.jsxs(e.Fragment,{children:[e.jsxs(f.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"grid grid-cols-[80px_240px_120px_auto_200px] gap-4 p-4 border-b border-neutral-300/30 place-items-center",children:[e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"RANK"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"TEAM"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"SCORE"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-center",children:"CHALLENGES"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"LAST SUBMIT"})]}),e.jsx("div",{className:"divide-y divide-neutral-300/10",children:d.map((l,N)=>e.jsxs(f.div,{className:"grid grid-cols-[80px_240px_120px_auto_200px] gap-4 p-4 hover:bg-neutral-300/5 transition-colors duration-200 cursor-pointer place-items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`font-mono text-xl
                                        ${l.rank===1?"text-yellow-400":l.rank===2?"text-neutral-300":l.rank===3?"text-orange-400":"text-neutral-400"}
                                    `,children:["#",l.rank]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300 bg-neutral-700 bg-cover bg-center",style:{backgroundImage:`url(${l.avatar||"/default-team-avatar.png"})`}}),e.jsx("span",{className:"text-neutral-50 font-mono",children:l.name})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-geek-400 font-mono",children:l.score.toLocaleString()})}),l.solved&&e.jsx($,{solved:l.solved,totalSolved:l.totalSolved}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:l.lastSubmit})})]},N))})]}),e.jsx(w,{currentPage:c,totalPages:o,onPageChange:x})]}):e.jsx(B,{teams:d,challenges:j,totalCount:y,currentPage:c,pageSize:10,onPageChange:x,isAdmin:!1,PaginationComponent:w})]})}function Z(){const{contestId:t}=R(),[d,n]=h.useState(1),[c]=h.useState(10),[o,x]=h.useState(0),[m,g]=h.useState(!0),[j,y]=h.useState("ranking"),[l,N]=h.useState({stats:{totalTeams:0,totalSolves:0,highestScore:0,totalPlayers:0},teams:[],userTeam:null}),k=r=>{const i=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-";return{rank:r.rank,name:r.name,avatar:r.avatar,score:r.score,solved:r.solved,totalSolved:r.solved.reduce((a,s)=>a+s.solved,0),lastSubmit:i(r.last)}},T=r=>{const i=new Map;return r.forEach(a=>{a.solved&&Array.isArray(a.solved)&&a.solved.forEach(s=>{const u=s.category;s.solved;const S=s.all||0;for(let v=0;v<S;v++){const p=`${u}-${v+1}`;i.has(p)||i.set(p,{id:p,name:`${u} ${v+1}`,category:u,solved:0})}})}),Array.from(i.values()).sort((a,s)=>a.category!==s.category?a.category.localeCompare(s.category):a.name.localeCompare(s.name))},A=r=>{const i=T(r);return r.map(a=>({...a,users:a.solved&&a.solved.reduce((s,u)=>s+(u.users||0),0)||1,challenges:i.map(s=>{var v;const u=(v=a.solved)==null?void 0:v.find(p=>p.category===s.category),S=u?u.solved>0:!1;return{id:s.id,solved:S?1:0}})}))},I=r=>r.teams.map(i=>k(i)),L=r=>{n(r),C(r)},C=async r=>{g(!0);try{const i=await G(t,c,(r-1)*c),a=await O(t),s=await H(t);i.code===200&&a.code===200&&(N({stats:{totalTeams:s.data.teams||0,totalPlayers:s.data.users||0,totalSolves:s.data.solved||0,highestScore:s.data.highest||0},teams:I(i.data),userTeam:k(a.data)}),x(Math.ceil(i.data.count/c)))}catch(i){console.error("获取排行榜数据失败:",i)}finally{g(!1)}};if(h.useEffect(()=>{C(1)},[t]),m)return e.jsx(_,{});const z=A(l.teams),E=T(l.teams);return e.jsx(q,{...l,currentPage:d,totalPages:o,onPageChange:L,viewMode:j,onViewModeChange:y,challenges:E,totalCount:l.stats.totalTeams,teams:j==="table"?z:l.teams})}export{Z as default};
