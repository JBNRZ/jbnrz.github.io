import{r as p,R as Z,j as e,B as z,m as le,t as q}from"./index-t9z4CTH9.js";import{I as J}from"./IconPlus-DRkKHhWO.js";import{I as Pe}from"./IconUpload-BuJNrcYM.js";import{I as Fe}from"./IconDownload-B7mp2fQi.js";import{I as Le}from"./IconEdit-KD6gaF7h.js";import{I as Y}from"./IconTrash-_ag0DVFK.js";import{I as Ae}from"./IconServer-CbQVqCI-.js";import{c as de}from"./createReactComponent-Dxssitb0.js";import{I as Re}from"./IconChevronRight-B4p02Xm2.js";import{I as $e}from"./IconX-aVC1A54A.js";import{I as De}from"./IconDeviceFloppy-CsSfJC1a.js";import{g as Ie,a as Ve,d as qe,u as Ge,b as He,c as Ue,e as Te}from"./challenge-B7Ki6blr.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var We=de("outline","chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Be=de("outline","maximize","IconMaximize",[["path",{d:"M4 8v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M4 16v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M16 20h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ye=de("outline","minimize","IconMinimize",[["path",{d:"M15 19v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M15 5v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M5 15h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M5 9h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ke=de("outline","shield","IconShield",[["path",{d:"M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3",key:"svg-0"}]]);function Xe(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function ve(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);n&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,s)}return r}function be(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ve(Object(r),!0).forEach(function(s){Xe(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function Je(t,n){if(t==null)return{};var r={},s=Object.keys(t),o,u;for(u=0;u<s.length;u++)o=s[u],!(n.indexOf(o)>=0)&&(r[o]=t[o]);return r}function Qe(t,n){if(t==null)return{};var r=Je(t,n),s,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);for(o=0;o<u.length;o++)s=u[o],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(r[s]=t[s])}return r}function Ze(t,n){return et(t)||tt(t,n)||rt(t,n)||nt()}function et(t){if(Array.isArray(t))return t}function tt(t,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var r=[],s=!0,o=!1,u=void 0;try{for(var f=t[Symbol.iterator](),O;!(s=(O=f.next()).done)&&(r.push(O.value),!(n&&r.length===n));s=!0);}catch(S){o=!0,u=S}finally{try{!s&&f.return!=null&&f.return()}finally{if(o)throw u}}return r}}function rt(t,n){if(typeof t=="string")return je(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return je(t,n)}function je(t,n){(n==null||n>t.length)&&(n=t.length);for(var r=0,s=new Array(n);r<n;r++)s[r]=t[r];return s}function nt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function st(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function ye(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);n&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,s)}return r}function we(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ye(Object(r),!0).forEach(function(s){st(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function at(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(s){return n.reduceRight(function(o,u){return u(o)},s)}}function te(t){return function n(){for(var r=this,s=arguments.length,o=new Array(s),u=0;u<s;u++)o[u]=arguments[u];return o.length>=t.length?t.apply(this,o):function(){for(var f=arguments.length,O=new Array(f),S=0;S<f;S++)O[S]=arguments[S];return n.apply(r,[].concat(o,O))}}}function ce(t){return{}.toString.call(t).includes("Object")}function it(t){return!Object.keys(t).length}function ne(t){return typeof t=="function"}function ot(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function lt(t,n){return ce(n)||K("changeType"),Object.keys(n).some(function(r){return!ot(t,r)})&&K("changeField"),n}function ct(t){ne(t)||K("selectorType")}function dt(t){ne(t)||ce(t)||K("handlerType"),ce(t)&&Object.values(t).some(function(n){return!ne(n)})&&K("handlersType")}function ut(t){t||K("initialIsRequired"),ce(t)||K("initialType"),it(t)&&K("initialContent")}function mt(t,n){throw new Error(t[n]||t.default)}var pt={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},K=te(mt)(pt),ae={changes:lt,selector:ct,handler:dt,initial:ut};function ft(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ae.initial(t),ae.handler(n);var r={current:t},s=te(gt)(r,n),o=te(ht)(r),u=te(ae.changes)(t),f=te(xt)(r);function O(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(F){return F};return ae.selector(P),P(r.current)}function S(P){at(s,o,u,f)(P)}return[O,S]}function xt(t,n){return ne(n)?n(t.current):n}function ht(t,n){return t.current=we(we({},t.current),n),n}function gt(t,n,r){return ne(n)?n(t.current):Object.keys(r).forEach(function(s){var o;return(o=n[s])===null||o===void 0?void 0:o.call(n,t.current[s])}),r}var vt={create:ft},bt={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function jt(t){return function n(){for(var r=this,s=arguments.length,o=new Array(s),u=0;u<s;u++)o[u]=arguments[u];return o.length>=t.length?t.apply(this,o):function(){for(var f=arguments.length,O=new Array(f),S=0;S<f;S++)O[S]=arguments[S];return n.apply(r,[].concat(o,O))}}}function yt(t){return{}.toString.call(t).includes("Object")}function wt(t){return t||Ne("configIsRequired"),yt(t)||Ne("configType"),t.urls?(Nt(),{paths:{vs:t.urls.monacoBase}}):t}function Nt(){console.warn(ke.deprecation)}function kt(t,n){throw new Error(t[n]||t.default)}var ke={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Ne=jt(kt)(ke),Ct={config:wt},_t=function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return function(o){return r.reduceRight(function(u,f){return f(u)},o)}};function Ce(t,n){return Object.keys(n).forEach(function(r){n[r]instanceof Object&&t[r]&&Object.assign(n[r],Ce(t[r],n[r]))}),be(be({},t),n)}var Ot={type:"cancelation",msg:"operation is manually canceled"};function pe(t){var n=!1,r=new Promise(function(s,o){t.then(function(u){return n?o(Ot):s(u)}),t.catch(o)});return r.cancel=function(){return n=!0},r}var Mt=vt.create({config:bt,isInitialized:!1,resolve:null,reject:null,monaco:null}),_e=Ze(Mt,2),se=_e[0],ue=_e[1];function zt(t){var n=Ct.config(t),r=n.monaco,s=Qe(n,["monaco"]);ue(function(o){return{config:Ce(o.config,s),monaco:r}})}function St(){var t=se(function(n){var r=n.monaco,s=n.isInitialized,o=n.resolve;return{monaco:r,isInitialized:s,resolve:o}});if(!t.isInitialized){if(ue({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),pe(fe);if(window.monaco&&window.monaco.editor)return Oe(window.monaco),t.resolve(window.monaco),pe(fe);_t(Et,Ft)(Lt)}return pe(fe)}function Et(t){return document.body.appendChild(t)}function Pt(t){var n=document.createElement("script");return t&&(n.src=t),n}function Ft(t){var n=se(function(s){var o=s.config,u=s.reject;return{config:o,reject:u}}),r=Pt("".concat(n.config.paths.vs,"/loader.js"));return r.onload=function(){return t()},r.onerror=n.reject,r}function Lt(){var t=se(function(r){var s=r.config,o=r.resolve,u=r.reject;return{config:s,resolve:o,reject:u}}),n=window.require;n.config(t.config),n(["vs/editor/editor.main"],function(r){Oe(r),t.resolve(r)},function(r){t.reject(r)})}function Oe(t){se().monaco||ue({monaco:t})}function At(){return se(function(t){var n=t.monaco;return n})}var fe=new Promise(function(t,n){return ue({resolve:t,reject:n})}),Me={config:zt,init:St,__getMonacoInstance:At},Rt={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},xe=Rt,$t={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},Dt=$t;function It({children:t}){return Z.createElement("div",{style:Dt.container},t)}var Vt=It,qt=Vt;function Gt({width:t,height:n,isEditorReady:r,loading:s,_ref:o,className:u,wrapperProps:f}){return Z.createElement("section",{style:{...xe.wrapper,width:t,height:n},...f},!r&&Z.createElement(qt,null,s),Z.createElement("div",{ref:o,style:{...xe.fullWidth,...!r&&xe.hide},className:u}))}var Ht=Gt,ze=p.memo(Ht);function Ut(t){p.useEffect(t,[])}var Se=Ut;function Tt(t,n,r=!0){let s=p.useRef(!0);p.useEffect(s.current||!r?()=>{s.current=!1}:t,n)}var G=Tt;function re(){}function Q(t,n,r,s){return Wt(t,s)||Bt(t,n,r,s)}function Wt(t,n){return t.editor.getModel(Ee(t,n))}function Bt(t,n,r,s){return t.editor.createModel(n,r,s?Ee(t,s):void 0)}function Ee(t,n){return t.Uri.parse(n)}function Yt({original:t,modified:n,language:r,originalLanguage:s,modifiedLanguage:o,originalModelPath:u,modifiedModelPath:f,keepCurrentOriginalModel:O=!1,keepCurrentModifiedModel:S=!1,theme:P="light",loading:F="Loading...",options:L={},height:B="100%",width:R="100%",className:E,wrapperProps:U={},beforeMount:$=re,onMount:T=re}){let[y,A]=p.useState(!1),[D,M]=p.useState(!0),c=p.useRef(null),v=p.useRef(null),k=p.useRef(null),C=p.useRef(T),b=p.useRef($),I=p.useRef(!1);Se(()=>{let a=Me.init();return a.then(m=>(v.current=m)&&M(!1)).catch(m=>(m==null?void 0:m.type)!=="cancelation"&&console.error("Monaco initialization: error:",m)),()=>c.current?x():a.cancel()}),G(()=>{if(c.current&&v.current){let a=c.current.getOriginalEditor(),m=Q(v.current,t||"",s||r||"text",u||"");m!==a.getModel()&&a.setModel(m)}},[u],y),G(()=>{if(c.current&&v.current){let a=c.current.getModifiedEditor(),m=Q(v.current,n||"",o||r||"text",f||"");m!==a.getModel()&&a.setModel(m)}},[f],y),G(()=>{let a=c.current.getModifiedEditor();a.getOption(v.current.editor.EditorOption.readOnly)?a.setValue(n||""):n!==a.getValue()&&(a.executeEdits("",[{range:a.getModel().getFullModelRange(),text:n||"",forceMoveMarkers:!0}]),a.pushUndoStop())},[n],y),G(()=>{var a,m;(m=(a=c.current)==null?void 0:a.getModel())==null||m.original.setValue(t||"")},[t],y),G(()=>{let{original:a,modified:m}=c.current.getModel();v.current.editor.setModelLanguage(a,s||r||"text"),v.current.editor.setModelLanguage(m,o||r||"text")},[r,s,o],y),G(()=>{var a;(a=v.current)==null||a.editor.setTheme(P)},[P],y),G(()=>{var a;(a=c.current)==null||a.updateOptions(L)},[L],y);let l=p.useCallback(()=>{var g;if(!v.current)return;b.current(v.current);let a=Q(v.current,t||"",s||r||"text",u||""),m=Q(v.current,n||"",o||r||"text",f||"");(g=c.current)==null||g.setModel({original:a,modified:m})},[r,n,o,t,s,u,f]),d=p.useCallback(()=>{var a;!I.current&&k.current&&(c.current=v.current.editor.createDiffEditor(k.current,{automaticLayout:!0,...L}),l(),(a=v.current)==null||a.editor.setTheme(P),A(!0),I.current=!0)},[L,P,l]);p.useEffect(()=>{y&&C.current(c.current,v.current)},[y]),p.useEffect(()=>{!D&&!y&&d()},[D,y,d]);function x(){var m,g,_,V;let a=(m=c.current)==null?void 0:m.getModel();O||((g=a==null?void 0:a.original)==null||g.dispose()),S||((_=a==null?void 0:a.modified)==null||_.dispose()),(V=c.current)==null||V.dispose()}return Z.createElement(ze,{width:R,height:B,isEditorReady:y,loading:F,_ref:k,className:E,wrapperProps:U})}var Kt=Yt;p.memo(Kt);function Xt(t){let n=p.useRef();return p.useEffect(()=>{n.current=t},[t]),n.current}var Jt=Xt,ie=new Map;function Qt({defaultValue:t,defaultLanguage:n,defaultPath:r,value:s,language:o,path:u,theme:f="light",line:O,loading:S="Loading...",options:P={},overrideServices:F={},saveViewState:L=!0,keepCurrentModel:B=!1,width:R="100%",height:E="100%",className:U,wrapperProps:$={},beforeMount:T=re,onMount:y=re,onChange:A,onValidate:D=re}){let[M,c]=p.useState(!1),[v,k]=p.useState(!0),C=p.useRef(null),b=p.useRef(null),I=p.useRef(null),l=p.useRef(y),d=p.useRef(T),x=p.useRef(),a=p.useRef(s),m=Jt(u),g=p.useRef(!1),_=p.useRef(!1);Se(()=>{let w=Me.init();return w.then(i=>(C.current=i)&&k(!1)).catch(i=>(i==null?void 0:i.type)!=="cancelation"&&console.error("Monaco initialization: error:",i)),()=>b.current?ee():w.cancel()}),G(()=>{var i,h,j,N;let w=Q(C.current,t||s||"",n||o||"",u||r||"");w!==((i=b.current)==null?void 0:i.getModel())&&(L&&ie.set(m,(h=b.current)==null?void 0:h.saveViewState()),(j=b.current)==null||j.setModel(w),L&&((N=b.current)==null||N.restoreViewState(ie.get(u))))},[u],M),G(()=>{var w;(w=b.current)==null||w.updateOptions(P)},[P],M),G(()=>{!b.current||s===void 0||(b.current.getOption(C.current.editor.EditorOption.readOnly)?b.current.setValue(s):s!==b.current.getValue()&&(_.current=!0,b.current.executeEdits("",[{range:b.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),b.current.pushUndoStop(),_.current=!1))},[s],M),G(()=>{var i,h;let w=(i=b.current)==null?void 0:i.getModel();w&&o&&((h=C.current)==null||h.editor.setModelLanguage(w,o))},[o],M),G(()=>{var w;O!==void 0&&((w=b.current)==null||w.revealLine(O))},[O],M),G(()=>{var w;(w=C.current)==null||w.editor.setTheme(f)},[f],M);let V=p.useCallback(()=>{var w;if(!(!I.current||!C.current)&&!g.current){d.current(C.current);let i=u||r,h=Q(C.current,s||t||"",n||o||"",i||"");b.current=(w=C.current)==null?void 0:w.editor.create(I.current,{model:h,automaticLayout:!0,...P},F),L&&b.current.restoreViewState(ie.get(i)),C.current.editor.setTheme(f),O!==void 0&&b.current.revealLine(O),c(!0),g.current=!0}},[t,n,r,s,o,u,P,F,L,f,O]);p.useEffect(()=>{M&&l.current(b.current,C.current)},[M]),p.useEffect(()=>{!v&&!M&&V()},[v,M,V]),a.current=s,p.useEffect(()=>{var w,i;M&&A&&((w=x.current)==null||w.dispose(),x.current=(i=b.current)==null?void 0:i.onDidChangeModelContent(h=>{_.current||A(b.current.getValue(),h)}))},[M,A]),p.useEffect(()=>{if(M){let w=C.current.editor.onDidChangeMarkers(i=>{var j;let h=(j=b.current.getModel())==null?void 0:j.uri;if(h&&i.find(N=>N.path===h.path)){let N=C.current.editor.getModelMarkers({resource:h});D==null||D(N)}});return()=>{w==null||w.dispose()}}return()=>{}},[M,D]);function ee(){var w,i;(w=x.current)==null||w.dispose(),B?L&&ie.set(u,b.current.saveViewState()):(i=b.current.getModel())==null||i.dispose(),b.current.dispose()}return Z.createElement(ze,{width:R,height:E,isEditorReady:M,loading:S,_ref:I,className:U,wrapperProps:$})}var Zt=Qt,er=p.memo(Zt),oe=er;function tr({challenges:t=[],totalCount:n=0,currentPage:r=1,pageSize:s=10,categories:o=[],filterCategory:u="all",filterType:f="all",onPageChange:O,onAddChallenge:S,onEditChallenge:P,onDeleteChallenge:F,onUploadAttachment:L,onDownloadAttachment:B,onFilterTypeChange:R,onFilterCategoryChange:E}){const[U,$]=p.useState({}),T=(c,v)=>{const k=`${c}-${v}`;$(C=>({...C,[k]:!C[k]}))},y=c=>{const k={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[c.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${k}`,children:c})},A=c=>{const k={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},question:{label:"问答题目",class:"bg-geek-400/20 text-geek-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[c]||{label:c,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${k.class}`,children:k.label})},D=c=>!c||c.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:c.map((v,k)=>e.jsx("span",{className:"px-2 py-1 bg-black/30 border border-neutral-300/30 rounded text-xs font-mono text-neutral-300",title:v.value,children:v.value.length>15?`${v.value.substring(0,15)}...`:v.value},k))}),M=(c,v)=>!c||c.length===0?null:e.jsxs("div",{className:"mt-3 border-t border-neutral-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ae,{size:14,className:"text-cyan-400"}),e.jsx("span",{className:"text-sm text-neutral-400 font-mono",children:"容器配置："})]}),e.jsx("div",{className:"space-y-2",children:c.map((k,C)=>{const b=`${v}-${C}`,I=U[b];return e.jsxs("div",{className:"p-2 bg-black/40 border border-neutral-300/20 rounded-md text-xs font-mono",children:[e.jsx("div",{className:"flex items-center gap-1 mb-2",children:e.jsxs("span",{className:"text-cyan-400",children:["Docker 组 ",C+1]})}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1 cursor-pointer hover:text-neutral-300 transition-colors",onClick:()=>T(v,C),children:[I?e.jsx(We,{size:14,className:"text-neutral-400"}):e.jsx(Re,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-neutral-400",children:"YAML 配置"}),e.jsxs("span",{className:"text-neutral-500",children:["(",I?"点击收缩":"点击展开",")"]})]}),I&&e.jsx("div",{className:"border border-neutral-300/20 rounded overflow-hidden",children:e.jsx(oe,{value:k.yaml||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:12,fontFamily:'Consolas, "Courier New", monospace',renderLineHighlight:"none"},height:`${16*k.yaml.split(`
`).length}px`,theme:"vs-dark"})}),!I&&e.jsx("div",{className:"p-2 bg-black/50 border border-neutral-300/20 rounded text-neutral-500 overflow-hidden",children:e.jsx("div",{className:"text-xs",children:k.yaml?e.jsxs(e.Fragment,{children:[k.yaml.split(`
`).slice(0,2).map((l,d)=>e.jsx("div",{className:"truncate",children:l||" "},d)),k.yaml.split(`
`).length>2&&e.jsx("div",{className:"text-neutral-600",children:"..."})]}):e.jsx("div",{className:"truncate",children:"暂无配置"})})})]}),k.network_policies&&k.network_policies.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-neutral-700 border-dashed",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(Ke,{size:12,className:"text-geek-400"}),e.jsx("span",{className:"text-neutral-400",children:"网络策略:"})]}),e.jsx("div",{className:"space-y-2 pl-2 mt-1",children:k.network_policies.map((l,d)=>e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"mb-1",children:e.jsxs("span",{className:"text-neutral-300",children:["策略 ",d+1]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 pl-2",children:[l.from&&l.from.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"From:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:l.from.map((x,a)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:x.cidr||"任意"}),x.except&&x.except.length>0&&x.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",x.except.join(", ")]})]},a))})]}),l.to&&l.to.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"To:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:l.to.map((x,a)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:x.cidr||"任意"}),x.except&&x.except.length>0&&x.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",x.except.join(", ")]})]},a))})]})]})]},d))})]})]},C)})})]});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"题目管理"}),e.jsx(z,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(J,{size:16}),onClick:S,children:"添加题目"})]}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"flex gap-8",children:[{id:"all",label:"全部"},{id:"static",label:"静态题目"},{id:"question",label:"问答题目"},{id:"dynamic",label:"动态题目"},{id:"pods",label:"容器题目"}].map(c=>e.jsxs("div",{className:"relative",children:[e.jsx(z,{variant:f===c.id?"primary":"ghost",size:"sm",className:`!px-2 !min-w-0 !border-0 pb-3 ${f===c.id?"!bg-transparent !text-geek-400":"!text-neutral-400"}`,onClick:()=>R(c.id),children:c.label}),f===c.id&&e.jsx(le.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]},c.id))})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:u,onChange:c=>E(c.target.value),className:`w-full h-[38px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                text-neutral-50 placeholder-neutral-500\r
                focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部分类"}),o.map(c=>e.jsx("option",{value:c,children:c},c))]})})]})}),t.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"space-y-4",children:t.map(c=>e.jsx(le.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:c.name}),e.jsxs("div",{className:"flex gap-2",children:[y(c.category),A(c.type)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>L(c),children:e.jsx(Pe,{size:18})}),e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>B(c),children:e.jsx(Fe,{size:18})}),e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>P(c),children:e.jsx(Le,{size:18})}),e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>F(c),children:e.jsx(Y,{size:18})})]})]}),e.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:c.desc}),c.type!=="pods"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"Flags:"}),D(c.flags)]}),c.type==="pods"&&M(c.dockers,c.id||c.name)]})},c.id||c.name))}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{variant:"ghost",size:"sm",disabled:r===1,onClick:()=>O(r>1?r-1:1),className:r===1?"!border-neutral-700 !text-neutral-600":"",children:"上一页"}),e.jsxs("span",{className:"text-neutral-400 text-sm",children:[r," / ",Math.ceil(n/s)]}),e.jsx(z,{variant:"ghost",size:"sm",disabled:r>=Math.ceil(n/s),onClick:()=>O(r<Math.ceil(n/s)?r+1:Math.ceil(n/s)),className:r>=Math.ceil(n/s)?"!border-neutral-700 !text-neutral-600":"",children:"下一页"})]})})]})}const X=`
services:
  test_service:
    container_name: test_service
    image: nicolaka/netshoot:latest
    ports:
      - "80:80/tcp"
    cpus: 0.5
    mem_limit: 500m
    environment:
      - FLAG=static{static_flag}
      - FLAG_2=dynamic{dynamic_flag}
      - FLAG_3=uuid{}
    volumes:
      - FLAG_0:/flag
    working_dir: /root
    command:
      - "sleep"
      - "infinity"
    networks:
      network1:
        ipv4_address: 192.168.0.2
      network2:
        ipv4_address: 192.168.1.2
  
  another_service:
    container_name: another_service
    image: nicolaka/netshoot:latest
    ports:
      - "4000:4000/tcp"
    cpus: 0.5
    mem_limit: 500m
    environment:
      - FLAG_3=static{another_env_flag_value}
    volumes:
      - FLAG_1:/flag
    working_dir: /root
    command:
      - "sleep"
      - "infinity"
    networks:
      network1:
        ipv4_address: 192.168.0.3
      network2:
        ipv4_address: 192.168.1.3

volumes:
  FLAG_0:
    labels:
      - value=static{static_flag_value}
  FLAG_1:
    labels:
      - value=dynamic{dynamic_flag_value}

networks:
  network1:
    external: true
    ipam:
      config:
        - subnet: 192.168.0.0/24
          gateway: 192.168.0.1
  
  network2:
    ipam:
      config:
        - subnet: 192.168.1.0/24
          gateway: 192.168.1.1
`.trim();function rr({isOpen:t=!1,mode:n="add",challenge:r={name:"",desc:"",category:"",type:"static",generator_image:"",flags:[""],docker_compose:"",network_policies:[{from:[{cidr:"",except:[""]}],to:[{cidr:"",except:[""]}]}]},categories:s=[],onClose:o,onSubmit:u,onChange:f,onAddFlag:O,onRemoveFlag:S,onFlagChange:P}){const[F,L]=p.useState({isOpen:!1,value:""}),B=()=>{L({isOpen:!0,value:r.docker_compose||X})};p.useEffect(()=>{r.type==="pods"&&!r.docker_compose&&f({...r,docker_compose:X})},[r.type,r.docker_compose,f]);const R=()=>{L({isOpen:!1,value:""})},E=()=>{const l=F.value||X;f({...r,docker_compose:l}),R()},U=l=>{L({...F,value:l})},$=l=>{f({...r,docker_compose:l||X})},T=()=>{const l=[...r.network_policies||[],{from:[{cidr:"",except:[""]}],to:[{cidr:"0.0.0.0/0",except:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","100.64.0.0/10"]}]}];f({...r,network_policies:l})},y=l=>{const d=r.network_policies.filter((x,a)=>a!==l);f({...r,network_policies:d})},A=(l,d)=>{const x=[...r.network_policies],a={...x[l]};a[d]=[...a[d],{cidr:"",except:[""]}],x[l]=a,f({...r,network_policies:x})},D=(l,d,x)=>{const a=[...r.network_policies],m={...a[l]};m[d]=m[d].filter((g,_)=>_!==x),a[l]=m,f({...r,network_policies:a})},M=(l,d,x,a)=>{const m=[...r.network_policies],g={...m[l]},_={...g[d][x]};_.cidr=a,g[d]=[...g[d]],g[d][x]=_,m[l]=g,f({...r,network_policies:m})},c=(l,d,x)=>{const a=[...r.network_policies],m={...a[l]},g={...m[d][x]};g.except=[...g.except,""],m[d]=[...m[d]],m[d][x]=g,a[l]=m,f({...r,network_policies:a})},v=(l,d,x,a)=>{const m=[...r.network_policies],g={...m[l]},_={...g[d][x]};_.except=_.except.filter((V,ee)=>ee!==a),g[d]=[...g[d]],g[d][x]=_,m[l]=g,f({...r,network_policies:m})},k=(l,d,x,a,m)=>{const g=[...r.network_policies],_={...g[l]},V={..._[d][x]};V.except=[...V.except],V.except[a]=m,_[d]=[..._[d]],_[d][x]=V,g[l]=_,f({...r,network_policies:g})};p.useEffect(()=>{const l=d=>{F.isOpen&&(d.key==="Escape"?R():d.ctrlKey&&d.key==="s"&&(d.preventDefault(),E()))};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[F.isOpen,F.value]);const C="w-full h-10 bg-black/20 border border-neutral-300/30 rounded-md px-4 text-neutral-50 focus:outline-none focus:border-geek-400",b="w-full h-10 bg-black/20 border border-neutral-300/30 rounded-md px-4 text-neutral-50 focus:outline-none focus:border-geek-400",I="w-full h-20 bg-black/20 border border-neutral-300/30 rounded-md px-4 py-2 text-neutral-50 focus:outline-none focus:border-geek-400 resize-none";return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:[e.jsxs(le.div,{className:"w-full max-w-4xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:n==="add"?"添加题目":n==="edit"?"编辑题目":"删除题目"}),e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:o,children:e.jsx($e,{size:18})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:n==="delete"?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-red-400/20 rounded-full flex items-center justify-center mb-6",children:e.jsx(Y,{size:40,className:"text-red-400"})}),e.jsx("h3",{className:"text-2xl font-mono text-neutral-50 mb-4",children:"确认删除题目"}),e.jsx("p",{className:"text-neutral-400 font-mono text-lg mb-2",children:"您确定要删除这个题目吗？"}),e.jsx("p",{className:"text-red-400 font-mono text-sm",children:"⚠️ 此操作无法撤销，请谨慎操作"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),e.jsx("input",{type:"text",value:r.name,onChange:l=>f({...r,name:l.target.value}),className:C,placeholder:"输入题目名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目分类"}),e.jsxs("select",{value:r.category,onChange:l=>f({...r,category:l.target.value}),className:b,children:[e.jsx("option",{value:"",children:"请选择分类"}),s.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目类型"}),e.jsxs("select",{value:r.type,onChange:l=>f({...r,type:l.target.value}),className:b,children:[e.jsx("option",{value:"static",children:"静态题目"}),e.jsx("option",{value:"question",children:"问答题目"}),e.jsx("option",{value:"dynamic",children:"动态题目"}),e.jsx("option",{value:"pods",children:"容器题目"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),e.jsx("textarea",{value:r.desc,onChange:l=>f({...r,desc:l.target.value}),className:I,placeholder:"输入题目描述内容"})]})]})]}),r.type==="dynamic"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"生成器镜像"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"Generator镜像地址"}),e.jsx("input",{type:"text",value:r.generator_image,onChange:l=>f({...r,generator_image:l.target.value}),className:C,placeholder:"输入Generator镜像地址"})]})]}),r.type!=="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag设置"}),e.jsx(z,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(J,{size:16}),onClick:O,children:"添加Flag"})]}),e.jsx("div",{className:"space-y-3",children:r.flags.map((l,d)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:typeof l=="string"?l:l.value||"",onChange:x=>P(d,x.target.value),className:C,placeholder:`Flag ${d+1}`}),r.flags.length>1&&e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>S(d),children:e.jsx(Y,{size:18})})]},d))})]}),r.type==="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"docker-compose注意事项"}),e.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-400 font-mono",children:["flag格式: ","`static{}`, `dynamic{}`, `uuid{}`",e.jsx("br",{}),"flag `环境变量` / `文件挂载` 必须以 `FLAG` 为前缀; 变量名可重复，不作为注入时的标识符使用",e.jsx("br",{}),"flag `文件挂载` 通过 volumes.FLAG_x.labels.value 字段指定值",e.jsx("br",{}),e.jsx("br",{}),"services参数只接受: image, expose, ports, environment, volumes, working_dir, command, cpus, mem_limit",e.jsx("br",{}),e.jsx("br",{}),"可通过networks配置多个网段, 每个容器可占据多个网段",e.jsx("br",{}),"当设置networks时, 每个容器必须指定所使用的network; 不指定时具体IP时, 随机从定义的网段中选取",e.jsx("br",{}),"当不设置networks时, 容器之间共用同一个随机IP地址, 容器间通信请使用本地地址: 127.0.0.1",e.jsx("br",{}),"共用IP地址时, 请注意端口唯一性",e.jsx("br",{}),e.jsx("br",{}),"下述示例中包含了所有可接受字段, 未在其中的字段将被忽略; 务必使用2个空格进行缩进"]})})]}),r.type==="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"容器设置"}),n==="edit"&&e.jsx("span",{className:"text-xs text-neutral-500",children:"容器配置仅在创建时确定"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border border-neutral-700 rounded-md p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["docker-compose.yaml",n==="edit"&&e.jsx("span",{className:"ml-2 text-xs text-neutral-500",children:"(只读)"})]}),n==="add"&&e.jsx(z,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(Be,{size:14}),className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300 !text-xs",onClick:B,children:"全屏编辑"})]}),n==="add"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:e.jsx(oe,{value:r.docker_compose||X,onChange:$,language:"yaml",options:{readOnly:!1,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:14,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:`${19*(r.docker_compose||X).split(`
`).length}px`,theme:"vs-dark"})}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-500 font-mono",children:["flag格式: ","`static{}`, `dynamic{}`, `uuid{}`",e.jsx("br",{}),"flag `环境变量` / `文件挂载` 必须以 `FLAG` 为前缀; 变量名可重复，不作为注入时的标识符使用",e.jsx("br",{}),"flag `文件挂载` 通过 labels value 字段指定值",e.jsx("br",{}),"Docker参数只接受: image, expose, ports, environment, volumes, working_dir, command",e.jsx("br",{}),"同一道题目中, 所有的容器名必须唯一, 作为唯一 DNS Hostname",e.jsx("br",{}),"容器间通过 Hostname 或 本地地址 通信"]})]}):e.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:e.jsx(oe,{value:r.docker_compose||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:14,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:`${19*(r.docker_compose||X).split(`
`).length}px`,theme:"vs-dark"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"网络策略"}),e.jsx(z,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(J,{size:14}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:T,children:"添加策略"})]}),e.jsx("div",{className:"space-y-4",children:(r.network_policies||[]).map((l,d)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md p-3 bg-black/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h5",{className:"text-sm font-mono text-neutral-200",children:["策略 ",d+1]}),e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>y(d),children:e.jsx(Y,{size:16})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"允许入站"}),e.jsx(z,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(J,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>A(d,"from"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(l.from||[]).map((x,a)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"}),l.from.length>1&&e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>D(d,"from",a),children:e.jsx(Y,{size:12})})]}),e.jsx("input",{type:"text",value:x.cidr,onChange:m=>M(d,"from",a,m.target.value),className:"w-full h-8 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"192.168.1.0/24"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"排除列表"}),e.jsx(z,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(J,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>c(d,"from",a),children:"添加排除"})]}),e.jsx("div",{className:"space-y-1",children:(x.except||[]).map((m,g)=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("input",{type:"text",value:m,onChange:_=>k(d,"from",a,g,_.target.value),className:"flex-1 h-6 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"192.168.1.1"}),e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300 !w-6 !h-6",onClick:()=>v(d,"from",a,g),children:e.jsx(Y,{size:10})})]},g))})]})]},a))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"允许出站"}),e.jsx(z,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(J,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>A(d,"to"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(l.to||[]).map((x,a)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"}),l.to.length>1&&e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>D(d,"to",a),children:e.jsx(Y,{size:12})})]}),e.jsx("input",{type:"text",value:x.cidr,onChange:m=>M(d,"to",a,m.target.value),className:"w-full h-8 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"0.0.0.0/0"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"排除列表"}),e.jsx(z,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(J,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>c(d,"to",a),children:"添加排除"})]}),e.jsx("div",{className:"space-y-1",children:(x.except||[]).map((m,g)=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("input",{type:"text",value:m,onChange:_=>k(d,"to",a,g,_.target.value),className:"flex-1 h-6 bg-black/30 border border-neutral-700 rounded px-2 text-neutral-50 text-xs",placeholder:"10.0.0.0/8"}),e.jsx(z,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300 !w-6 !h-6",onClick:()=>v(d,"to",a,g),children:e.jsx(Y,{size:10})})]},g))})]})]},a))})]})]},d))})]})]})})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:o,children:"取消"}),e.jsx(z,{variant:"primary",size:"sm",onClick:()=>u(r),children:n==="add"?"添加题目":n==="edit"?"保存更改":"确认删除"})]})]}),F.isOpen&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center",children:e.jsxs(le.div,{className:"w-[95vw] h-[95vh] bg-neutral-900 border border-neutral-700 rounded-lg overflow-hidden",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"全屏编辑 - docker-compose.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"primary",size:"sm",onClick:E,children:[e.jsx(De,{size:16,className:"mr-2"}),"保存 (Ctrl+S)"]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:R,children:[e.jsx(Ye,{size:16,className:"mr-2"}),"退出 (Esc)"]})]})]}),e.jsx("div",{className:"flex-1 h-full",children:e.jsx(oe,{value:F.value,onChange:U,language:"yaml",options:{readOnly:!1,minimap:{enabled:!0},scrollBeyondLastLine:!1,lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:16,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line"},height:"calc(95vh - 70px)",theme:"vs-dark"})})]})})]}):null}function hr(){const[t,n]=p.useState([]),[r,s]=p.useState(0),[o,u]=p.useState(1),[f,O]=p.useState("all"),[S,P]=p.useState([]),[F,L]=p.useState("all"),[B,R]=p.useState(!1),[E,U]=p.useState("add"),[$,T]=p.useState(null),[y,A]=p.useState({name:"",desc:"",category:"",type:"static",flags:[{id:0,value:""}],docker_compose:"",network_policies:[]}),D=p.useRef(null),M=10;p.useEffect(()=>{c()},[]),p.useEffect(()=>{v()},[o,f,F]);const c=async()=>{try{const i=await Ie();if(i.code===200){const h=["Web","Misc","Pwn","Crypto","Reverse"],j=[...new Set([...h,...i.data||[]])];P(j)}else q.danger({description:i.msg||"获取题目分类失败"}),P(["Web","Misc","Pwn","Crypto","Reverse"])}catch(i){console.error("获取题目分类失败:",i),q.danger({description:"获取题目分类失败"}),P(["Web","Misc","Pwn","Crypto","Reverse"])}},v=async()=>{try{const i={limit:M,offset:(o-1)*M};f!=="all"&&(i.type=f),F!=="all"&&(i.category=F);const h=await Ve(i);h.code===200?(n(h.data.challenges.map(j=>{let N=[];j.flags&&Array.isArray(j.flags)?N=j.flags:j.flag?N=[j.flag]:N=[""];let W=[];return j.docker_groups&&Array.isArray(j.docker_groups)&&j.docker_groups.length>0&&(W=j.docker_groups.map((me,nr)=>{var he;return{id:me.id,yaml:me.yaml||"",network_policies:((he=me.network_policies)==null?void 0:he.map(ge=>({from:ge.from||[],to:ge.to||[]})))||[]}})),{...j,flags:N,docker_groups:W,dockers:W}})),s(h.data.count)):q.danger({description:h.msg||"获取题目列表失败"})}catch(i){q.danger({description:"获取题目列表失败"}),console.error(i)}},k=i=>{O(i),u(1)},C=i=>{L(i),u(1)},b=()=>{U("add"),A({name:"",desc:"",category:"",type:"static",flags:[{id:0,value:""}],docker_compose:"",network_policies:[]}),R(!0)},I=i=>{U("edit"),T(i),A(i),R(!0)},l=i=>{U("delete"),T(i),R(!0)},d=i=>{var h;(h=D.current)==null||h.click(),T(i)},x=async i=>{try{const h=await qe(i.id,"attachment.zip"),j=window.URL.createObjectURL(new Blob([h.data])),N=document.createElement("a");N.href=j,N.setAttribute("download","attachment.zip"),document.body.appendChild(N),N.click(),N.remove()}catch(h){console.error("下载附件失败:",h),q.danger({description:"下载附件失败"})}},a=async i=>{var j;const h=(j=i.target.files)==null?void 0:j[0];if(i.target.value="",!!h){if(($.type==="static"||$.type==="question")&&h.name!=="attachment.zip"||$.type==="dynamic"&&h.name!=="generator.zip"||$.type==="pods"&&h.name!=="attachment.zip"){q.danger({description:"文件名必须与题目类型匹配"});return}try{const N=await Ge($.id,h);N.code===200?q.success({description:"上传附件成功"}):q.danger({description:N.msg||"上传附件失败"})}catch(N){console.error("上传附件失败:",N),q.danger({description:"上传附件失败"})}}},m=i=>{i.type!==y.type&&(i.type==="pods"?i.flags=[]:y.type==="pods"&&(i.flags=[{id:0,value:""}])),A(i)},g=()=>{y.type!=="pods"&&A({...y,flags:[...y.flags||[],{id:0,value:""}]})},_=i=>{if(y.type==="pods")return;const h=[...y.flags||[]];h.splice(i,1),A({...y,flags:h})},V=(i,h)=>{if(y.type==="pods")return;const j=[...y.flags||[]];j[i]={id:y.flags[i]&&y.flags[i].id||0,value:h},A({...y,flags:j})},ee=()=>{R(!1)},w=async i=>{var h;try{let j;if(E==="delete")j=await He($.id);else{const N={name:i.name,desc:i.desc,category:i.category,type:i.type};let W;if(i.type==="pods"?W=[]:E==="add"?W=i.flags.map(H=>typeof H=="string"?H:H.value||""):E==="edit"&&(W=i.flags.map(H=>typeof H=="string"?{id:0,value:H}:{id:H.id||0,value:H.value||""})),i.type==="static"||i.type==="question")N.flags=W||[];else if(i.type==="dynamic")N.flags=W||[],N.generator_image=i.generator_image||"";else if(i.type==="pods")N.docker_compose=i.docker_compose||"",N.generator_image=i.generator_image||"",N.flags=W,N.network_policies=((h=i.network_policies)==null?void 0:h.map(H=>({from:H.from||[],to:H.to||[]})))||[];else{q.danger({description:"错误的题目类型"});return}E==="add"?j=await Ue(N):E==="edit"&&(j=await Te($.id,N))}j.code===200?(q.success({description:`${E==="add"?"创建":E==="edit"?"更新":"删除"}题目成功`}),R(!1),await v()):q.danger({description:j.msg||`${E==="add"?"创建":E==="edit"?"更新":"删除"}题目失败`})}catch(j){console.error(`${E==="add"?"创建":E==="edit"?"更新":"删除"}题目失败:`,j),q.danger({description:`${E==="add"?"创建":E==="edit"?"更新":"删除"}题目失败`})}};return e.jsxs(e.Fragment,{children:[e.jsx(tr,{challenges:t,totalCount:r,currentPage:o,pageSize:M,categories:S,filterCategory:F,filterType:f,onPageChange:u,onAddChallenge:b,onEditChallenge:I,onDeleteChallenge:l,onUploadAttachment:d,onDownloadAttachment:x,onFilterTypeChange:k,onFilterCategoryChange:C}),e.jsx(rr,{isOpen:B,mode:E,challenge:y,categories:S,onClose:ee,onSubmit:w,onChange:m,onAddFlag:g,onRemoveFlag:_,onFlagChange:V}),e.jsx("input",{type:"file",ref:D,className:"hidden",onChange:a})]})}export{hr as default};
