import{r as d,R as K,j as r,B as A,m as re,t as I}from"./index-CDsAQtye.js";import{I as je}from"./IconPlus-Bi0eUWpg.js";import{I as Ee}from"./IconUpload-DjNzNy9-.js";import{I as Fe}from"./IconDownload-CMk3hE6M.js";import{I as ze}from"./IconEdit-gSJxwsm8.js";import{I as de}from"./IconTrash-BrtagUIe.js";import{c as ye}from"./createReactComponent-Dfj2g3Yj.js";import{I as Ae}from"./IconChevronRight-WZRfd72z.js";import{I as fe}from"./IconX-BGEv_3sg.js";import{g as Le,a as Ie,b as Re,d as Pe,u as De,c as $e,e as Te,f as Ge}from"./challenge-lOLY4Zwe.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var qe=ye("outline","chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ve=ye("outline","maximize","IconMaximize",[["path",{d:"M4 8v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M4 16v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M16 20h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]]);function Ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,a)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?me(Object(n),!0).forEach(function(a){Ue(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function Be(e,t){if(e==null)return{};var n={},a=Object.keys(e),o,l;for(l=0;l<a.length;l++)o=a[l],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function He(e,t){if(e==null)return{};var n=Be(e,t),a,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)a=l[o],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function We(e,t){return Ye(e)||Ke(e,t)||Xe(e,t)||Je()}function Ye(e){if(Array.isArray(e))return e}function Ke(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],a=!0,o=!1,l=void 0;try{for(var f=e[Symbol.iterator](),y;!(a=(y=f.next()).done)&&(n.push(y.value),!(t&&n.length===t));a=!0);}catch(C){o=!0,l=C}finally{try{!a&&f.return!=null&&f.return()}finally{if(o)throw l}}return n}}function Xe(e,t){if(typeof e=="string")return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return he(e,t)}function he(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Je(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Qe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,a)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ge(Object(n),!0).forEach(function(a){Qe(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function Ze(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(a){return t.reduceRight(function(o,l){return l(o)},a)}}function X(e){return function t(){for(var n=this,a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return o.length>=e.length?e.apply(this,o):function(){for(var f=arguments.length,y=new Array(f),C=0;C<f;C++)y[C]=arguments[C];return t.apply(n,[].concat(o,y))}}}function ne(e){return{}.toString.call(e).includes("Object")}function et(e){return!Object.keys(e).length}function Q(e){return typeof e=="function"}function tt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function rt(e,t){return ne(t)||V("changeType"),Object.keys(t).some(function(n){return!tt(e,n)})&&V("changeField"),t}function nt(e){Q(e)||V("selectorType")}function at(e){Q(e)||ne(e)||V("handlerType"),ne(e)&&Object.values(e).some(function(t){return!Q(t)})&&V("handlersType")}function st(e){e||V("initialIsRequired"),ne(e)||V("initialType"),et(e)&&V("initialContent")}function ot(e,t){throw new Error(e[t]||e.default)}var it={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},V=X(ot)(it),ee={changes:rt,selector:nt,handler:at,initial:st};function lt(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ee.initial(e),ee.handler(t);var n={current:e},a=X(ut)(n,t),o=X(dt)(n),l=X(ee.changes)(e),f=X(ct)(n);function y(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(M){return M};return ee.selector(O),O(n.current)}function C(O){Ze(a,o,l,f)(O)}return[y,C]}function ct(e,t){return Q(t)?t(e.current):t}function dt(e,t){return e.current=xe(xe({},e.current),t),t}function ut(e,t,n){return Q(t)?t(e.current):Object.keys(n).forEach(function(a){var o;return(o=t[a])===null||o===void 0?void 0:o.call(t,e.current[a])}),n}var ft={create:lt},mt={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function pt(e){return function t(){for(var n=this,a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return o.length>=e.length?e.apply(this,o):function(){for(var f=arguments.length,y=new Array(f),C=0;C<f;C++)y[C]=arguments[C];return t.apply(n,[].concat(o,y))}}}function ht(e){return{}.toString.call(e).includes("Object")}function gt(e){return e||ve("configIsRequired"),ht(e)||ve("configType"),e.urls?(xt(),{paths:{vs:e.urls.monacoBase}}):e}function xt(){console.warn(we.deprecation)}function vt(e,t){throw new Error(e[t]||e.default)}var we={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},ve=pt(vt)(we),bt={config:gt},jt=function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return function(o){return n.reduceRight(function(l,f){return f(l)},o)}};function Ne(e,t){return Object.keys(t).forEach(function(n){t[n]instanceof Object&&e[n]&&Object.assign(t[n],Ne(e[n],t[n]))}),pe(pe({},e),t)}var yt={type:"cancelation",msg:"operation is manually canceled"};function ie(e){var t=!1,n=new Promise(function(a,o){e.then(function(l){return t?o(yt):a(l)}),e.catch(o)});return n.cancel=function(){return t=!0},n}var wt=ft.create({config:mt,isInitialized:!1,resolve:null,reject:null,monaco:null}),Ce=We(wt,2),Z=Ce[0],ae=Ce[1];function Nt(e){var t=bt.config(e),n=t.monaco,a=He(t,["monaco"]);ae(function(o){return{config:Ne(o.config,a),monaco:n}})}function Ct(){var e=Z(function(t){var n=t.monaco,a=t.isInitialized,o=t.resolve;return{monaco:n,isInitialized:a,resolve:o}});if(!e.isInitialized){if(ae({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),ie(le);if(window.monaco&&window.monaco.editor)return ke(window.monaco),e.resolve(window.monaco),ie(le);jt(kt,Mt)(_t)}return ie(le)}function kt(e){return document.body.appendChild(e)}function Ot(e){var t=document.createElement("script");return e&&(t.src=e),t}function Mt(e){var t=Z(function(a){var o=a.config,l=a.reject;return{config:o,reject:l}}),n=Ot("".concat(t.config.paths.vs,"/loader.js"));return n.onload=function(){return e()},n.onerror=t.reject,n}function _t(){var e=Z(function(n){var a=n.config,o=n.resolve,l=n.reject;return{config:a,resolve:o,reject:l}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(n){ke(n),e.resolve(n)},function(n){e.reject(n)})}function ke(e){Z().monaco||ae({monaco:e})}function St(){return Z(function(e){var t=e.monaco;return t})}var le=new Promise(function(e,t){return ae({resolve:e,reject:t})}),Oe={config:Nt,init:Ct,__getMonacoInstance:St},Et={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},ce=Et,Ft={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},zt=Ft;function At({children:e}){return K.createElement("div",{style:zt.container},e)}var Lt=At,It=Lt;function Rt({width:e,height:t,isEditorReady:n,loading:a,_ref:o,className:l,wrapperProps:f}){return K.createElement("section",{style:{...ce.wrapper,width:e,height:t},...f},!n&&K.createElement(It,null,a),K.createElement("div",{ref:o,style:{...ce.fullWidth,...!n&&ce.hide},className:l}))}var Pt=Rt,Me=d.memo(Pt);function Dt(e){d.useEffect(e,[])}var _e=Dt;function $t(e,t,n=!0){let a=d.useRef(!0);d.useEffect(a.current||!n?()=>{a.current=!1}:e,t)}var R=$t;function J(){}function Y(e,t,n,a){return Tt(e,a)||Gt(e,t,n,a)}function Tt(e,t){return e.editor.getModel(Se(e,t))}function Gt(e,t,n,a){return e.editor.createModel(t,n,a?Se(e,a):void 0)}function Se(e,t){return e.Uri.parse(t)}function qt({original:e,modified:t,language:n,originalLanguage:a,modifiedLanguage:o,originalModelPath:l,modifiedModelPath:f,keepCurrentOriginalModel:y=!1,keepCurrentModifiedModel:C=!1,theme:O="light",loading:M="Loading...",options:S={},height:T="100%",width:L="100%",className:k,wrapperProps:P={},beforeMount:_=J,onMount:D=J}){let[j,F]=d.useState(!1),[p,h]=d.useState(!0),i=d.useRef(null),g=d.useRef(null),z=d.useRef(null),N=d.useRef(D),b=d.useRef(_),G=d.useRef(!1);_e(()=>{let m=Oe.init();return m.then(w=>(g.current=w)&&h(!1)).catch(w=>(w==null?void 0:w.type)!=="cancelation"&&console.error("Monaco initialization: error:",w)),()=>i.current?U():m.cancel()}),R(()=>{if(i.current&&g.current){let m=i.current.getOriginalEditor(),w=Y(g.current,e||"",a||n||"text",l||"");w!==m.getModel()&&m.setModel(w)}},[l],j),R(()=>{if(i.current&&g.current){let m=i.current.getModifiedEditor(),w=Y(g.current,t||"",o||n||"text",f||"");w!==m.getModel()&&m.setModel(w)}},[f],j),R(()=>{let m=i.current.getModifiedEditor();m.getOption(g.current.editor.EditorOption.readOnly)?m.setValue(t||""):t!==m.getValue()&&(m.executeEdits("",[{range:m.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),m.pushUndoStop())},[t],j),R(()=>{var m,w;(w=(m=i.current)==null?void 0:m.getModel())==null||w.original.setValue(e||"")},[e],j),R(()=>{let{original:m,modified:w}=i.current.getModel();g.current.editor.setModelLanguage(m,a||n||"text"),g.current.editor.setModelLanguage(w,o||n||"text")},[n,a,o],j),R(()=>{var m;(m=g.current)==null||m.editor.setTheme(O)},[O],j),R(()=>{var m;(m=i.current)==null||m.updateOptions(S)},[S],j);let H=d.useCallback(()=>{var $;if(!g.current)return;b.current(g.current);let m=Y(g.current,e||"",a||n||"text",l||""),w=Y(g.current,t||"",o||n||"text",f||"");($=i.current)==null||$.setModel({original:m,modified:w})},[n,t,o,e,a,l,f]),W=d.useCallback(()=>{var m;!G.current&&z.current&&(i.current=g.current.editor.createDiffEditor(z.current,{automaticLayout:!0,...S}),H(),(m=g.current)==null||m.editor.setTheme(O),F(!0),G.current=!0)},[S,O,H]);d.useEffect(()=>{j&&N.current(i.current,g.current)},[j]),d.useEffect(()=>{!p&&!j&&W()},[p,j,W]);function U(){var w,$,q,B;let m=(w=i.current)==null?void 0:w.getModel();y||(($=m==null?void 0:m.original)==null||$.dispose()),C||((q=m==null?void 0:m.modified)==null||q.dispose()),(B=i.current)==null||B.dispose()}return K.createElement(Me,{width:L,height:T,isEditorReady:j,loading:M,_ref:z,className:k,wrapperProps:P})}var Vt=qt;d.memo(Vt);function Ut(e){let t=d.useRef();return d.useEffect(()=>{t.current=e},[e]),t.current}var Bt=Ut,te=new Map;function Ht({defaultValue:e,defaultLanguage:t,defaultPath:n,value:a,language:o,path:l,theme:f="light",line:y,loading:C="Loading...",options:O={},overrideServices:M={},saveViewState:S=!0,keepCurrentModel:T=!1,width:L="100%",height:k="100%",className:P,wrapperProps:_={},beforeMount:D=J,onMount:j=J,onChange:F,onValidate:p=J}){let[h,i]=d.useState(!1),[g,z]=d.useState(!0),N=d.useRef(null),b=d.useRef(null),G=d.useRef(null),H=d.useRef(j),W=d.useRef(D),U=d.useRef(),m=d.useRef(a),w=Bt(l),$=d.useRef(!1),q=d.useRef(!1);_e(()=>{let v=Oe.init();return v.then(s=>(N.current=s)&&z(!1)).catch(s=>(s==null?void 0:s.type)!=="cancelation"&&console.error("Monaco initialization: error:",s)),()=>b.current?se():v.cancel()}),R(()=>{var s,c,u,x;let v=Y(N.current,e||a||"",t||o||"",l||n||"");v!==((s=b.current)==null?void 0:s.getModel())&&(S&&te.set(w,(c=b.current)==null?void 0:c.saveViewState()),(u=b.current)==null||u.setModel(v),S&&((x=b.current)==null||x.restoreViewState(te.get(l))))},[l],h),R(()=>{var v;(v=b.current)==null||v.updateOptions(O)},[O],h),R(()=>{!b.current||a===void 0||(b.current.getOption(N.current.editor.EditorOption.readOnly)?b.current.setValue(a):a!==b.current.getValue()&&(q.current=!0,b.current.executeEdits("",[{range:b.current.getModel().getFullModelRange(),text:a,forceMoveMarkers:!0}]),b.current.pushUndoStop(),q.current=!1))},[a],h),R(()=>{var s,c;let v=(s=b.current)==null?void 0:s.getModel();v&&o&&((c=N.current)==null||c.editor.setModelLanguage(v,o))},[o],h),R(()=>{var v;y!==void 0&&((v=b.current)==null||v.revealLine(y))},[y],h),R(()=>{var v;(v=N.current)==null||v.editor.setTheme(f)},[f],h);let B=d.useCallback(()=>{var v;if(!(!G.current||!N.current)&&!$.current){W.current(N.current);let s=l||n,c=Y(N.current,a||e||"",t||o||"",s||"");b.current=(v=N.current)==null?void 0:v.editor.create(G.current,{model:c,automaticLayout:!0,...O},M),S&&b.current.restoreViewState(te.get(s)),N.current.editor.setTheme(f),y!==void 0&&b.current.revealLine(y),i(!0),$.current=!0}},[e,t,n,a,o,l,O,M,S,f,y]);d.useEffect(()=>{h&&H.current(b.current,N.current)},[h]),d.useEffect(()=>{!g&&!h&&B()},[g,h,B]),m.current=a,d.useEffect(()=>{var v,s;h&&F&&((v=U.current)==null||v.dispose(),U.current=(s=b.current)==null?void 0:s.onDidChangeModelContent(c=>{q.current||F(b.current.getValue(),c)}))},[h,F]),d.useEffect(()=>{if(h){let v=N.current.editor.onDidChangeMarkers(s=>{var u;let c=(u=b.current.getModel())==null?void 0:u.uri;if(c&&s.find(x=>x.path===c.path)){let x=N.current.editor.getModelMarkers({resource:c});p==null||p(x)}});return()=>{v==null||v.dispose()}}return()=>{}},[h,p]);function se(){var v,s;(v=U.current)==null||v.dispose(),T?S&&te.set(l,b.current.saveViewState()):(s=b.current.getModel())==null||s.dispose(),b.current.dispose()}return K.createElement(Me,{width:L,height:k,isEditorReady:h,loading:C,_ref:G,className:P,wrapperProps:_})}var Wt=Ht,Yt=d.memo(Wt),ue=Yt;function Kt({challenges:e=[],totalCount:t=0,currentPage:n=1,pageSize:a=10,categories:o=[],filterCategory:l="all",filterType:f="all",onPageChange:y,onAddChallenge:C,onEditChallenge:O,onDeleteChallenge:M,onUploadAttachment:S,onDownloadAttachment:T,onFilterTypeChange:L,onFilterCategoryChange:k}){const[P,_]=d.useState({}),D=i=>{_(g=>({...g,[i]:!g[i]}))},j=i=>{const z={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[i.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${z}`,children:i})},F=i=>{const z={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},question:{label:"问答题目",class:"bg-geek-400/20 text-geek-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[i]||{label:i,class:"bg-neutral-400/20 text-neutral-400"};return r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${z.class}`,children:z.label})},p=i=>!i||i.length===0?r.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):r.jsx("div",{className:"flex flex-wrap gap-1",children:i.map((g,z)=>{const N=typeof g=="object"?g.value:g;return r.jsx("span",{className:"px-2 py-1 bg-black/30 border border-neutral-300/30 rounded text-xs font-mono text-neutral-300",title:N,children:N&&N.length>15?`${N.substring(0,15)}...`:N||""},z)})}),h=i=>{if(!i.docker_compose)return r.jsx("div",{className:"text-neutral-500 text-sm",children:r.jsx("span",{children:"暂无 Docker Compose 配置"})});const g=P[i.id]||!1;return r.jsxs("div",{className:"mt-2 pt-2 border-t border-neutral-700 border-dashed",children:[r.jsxs("div",{className:"flex items-center gap-1 mb-1 cursor-pointer hover:text-neutral-300 transition-colors",onClick:()=>D(i.id),children:[g?r.jsx(qe,{size:14,className:"text-neutral-400"}):r.jsx(Ae,{size:14,className:"text-neutral-400"}),r.jsx("span",{className:"text-neutral-400",children:"Docker Compose 配置"}),r.jsxs("span",{className:"text-neutral-500",children:["(",g?"点击收缩":"点击展开",")"]})]}),g&&r.jsx("div",{className:"border border-neutral-300/20 rounded overflow-hidden",children:r.jsx(ue,{value:i.docker_compose||"暂无配置",language:"yaml",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:12,fontFamily:'Consolas, "Courier New", monospace',renderLineHighlight:"none"},height:`${Math.max(16*i.docker_compose.split(`
`).length,200)}px`,theme:"vs-dark"})}),!g&&r.jsx("div",{className:"p-2 bg-black/50 border border-neutral-300/20 rounded text-neutral-500 overflow-hidden",children:r.jsxs("div",{className:"text-xs",children:[i.docker_compose.split(`
`).slice(0,2).map((z,N)=>r.jsx("div",{className:"truncate",children:z||" "},N)),i.docker_compose.split(`
`).length>2&&r.jsx("div",{className:"text-neutral-600",children:"..."})]})})]})};return r.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[r.jsxs("div",{className:"flex justify-between items-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"题目管理"}),r.jsx(A,{variant:"primary",size:"sm",align:"icon-left",icon:r.jsx(je,{size:16}),onClick:C,children:"添加题目"})]}),r.jsx("div",{className:"mb-6 border-b border-neutral-700",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("div",{className:"flex items-center",children:r.jsx("div",{className:"flex gap-8",children:[{id:"all",label:"全部"},{id:"static",label:"静态题目"},{id:"question",label:"问答题目"},{id:"dynamic",label:"动态题目"},{id:"pods",label:"容器题目"}].map(i=>r.jsxs("div",{className:"relative",children:[r.jsx(A,{variant:f===i.id?"primary":"ghost",size:"sm",className:`!px-2 !min-w-0 !border-0 pb-3 ${f===i.id?"!bg-transparent !text-geek-400":"!text-neutral-400"}`,onClick:()=>L(i.id),children:i.label}),f===i.id&&r.jsx(re.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]},i.id))})}),r.jsx("div",{className:"w-48",children:r.jsxs("select",{value:l,onChange:i=>k(i.target.value),className:`w-full h-[38px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                text-neutral-50 placeholder-neutral-500\r
                focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                transition-all duration-200`,children:[r.jsx("option",{value:"all",children:"全部分类"}),o.map(i=>r.jsx("option",{value:i,children:i},i))]})})]})}),e.length===0?r.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:r.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):r.jsx("div",{className:"space-y-4",children:e.map(i=>r.jsx(re.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:i.name}),r.jsxs("div",{className:"flex gap-2",children:[j(i.category),F(i.type)]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(A,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>S(i),children:r.jsx(Ee,{size:18})}),r.jsx(A,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>T(i),children:r.jsx(Fe,{size:18})}),r.jsx(A,{variant:"ghost",size:"icon",className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>O(i),children:r.jsx(ze,{size:18})}),r.jsx(A,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>M(i),children:r.jsx(de,{size:18})})]})]}),r.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:i.desc}),i.type!=="pods"&&r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"text-neutral-400 font-mono",children:"Flags:"}),p(i.flags)]}),i.type==="pods"&&h(i)]})},i.id||i.name))}),r.jsx("div",{className:"mt-6 flex justify-center",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(A,{variant:"ghost",size:"sm",disabled:n===1,onClick:()=>y(n>1?n-1:1),className:n===1?"!border-neutral-700 !text-neutral-600":"",children:"上一页"}),r.jsxs("span",{className:"text-neutral-400 text-sm",children:[n," / ",Math.ceil(t/a)]}),r.jsx(A,{variant:"ghost",size:"sm",disabled:n>=Math.ceil(t/a),onClick:()=>y(n<Math.ceil(t/a)?n+1:Math.ceil(t/a)),className:n>=Math.ceil(t/a)?"!border-neutral-700 !text-neutral-600":"",children:"下一页"})]})})]})}const be=`
services:
  test_service:
    image: docker.example.com/example/test_image:123
    expose:
      - "80"
      - "443"
    ports:
      - "8080:80"
    environment:
      - FLAG=static{static_flag}
      - FLAG_2=dynamic{dynamic_flag}
      - FLAG_3=uuid{}
    volumes:
      - FLAG_0:/path/to/flag
    working_dir: /path

  another_service:
    image: docker.example.com/example/test2_image:123
    expose:
      - "80"
      - "443"
    ports:
      - "8080:80"
    environment:
      - FLAG_3=another_env_flag_value
    volumes:
      - FLAG_1:/path/to/another_flag
    working_dir: /path

volumes:
  FLAG_0:
    labels:
      - value=static{static_flag_value}
  FLAG_1:
    labels:
      - value=dynamic{dynamic_flag_value}
`.trim();function Xt({isOpen:e=!1,mode:t="add",challenge:n={name:"",desc:"",category:"",type:"static",generator_image:"",flags:[""],docker_compose:""},categories:a=[],onClose:o,onSubmit:l,onChange:f,onAddFlag:y,onRemoveFlag:C,onFlagChange:O}){const[M,S]=d.useState({isOpen:!1,value:""}),T=()=>{S({isOpen:!0,value:n.docker_compose||be})},L=()=>{S({isOpen:!1,value:""})},k=()=>{f({...n,docker_compose:M.value}),L()},P=p=>{S(h=>({...h,value:p}))};d.useEffect(()=>{const p=h=>{M.isOpen&&(h.ctrlKey&&h.key==="s"&&(h.preventDefault(),k()),h.key==="Escape"&&(h.preventDefault(),L()))};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[M.isOpen]);const _="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",D=`${_} min-h-[100px] resize-none`,j=`${_} h-[48px] appearance-none`,F=p=>{f({...n,docker_compose:p})};return e?r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:[r.jsxs(re.div,{className:"w-full max-w-4xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[r.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:t==="add"?"添加题目":t==="edit"?"编辑题目":"删除题目"}),r.jsx(A,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:o,children:r.jsx(fe,{size:18})})]}),r.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:t==="delete"?r.jsx("div",{className:"text-center py-12",children:r.jsxs("div",{className:"mb-8",children:[r.jsx("div",{className:"mx-auto w-20 h-20 bg-red-400/20 rounded-full flex items-center justify-center mb-6",children:r.jsx(de,{size:40,className:"text-red-400"})}),r.jsx("h3",{className:"text-2xl font-mono text-neutral-50 mb-4",children:"确认删除题目"}),r.jsx("p",{className:"text-neutral-400 font-mono text-lg mb-2",children:"您确定要删除这个题目吗？"}),r.jsx("p",{className:"text-red-400 font-mono text-sm",children:"⚠️ 此操作无法撤销，请谨慎操作"})]})}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),r.jsx("input",{type:"text",value:n.name,onChange:p=>f({...n,name:p.target.value}),className:_,placeholder:"输入题目名称"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目分类"}),r.jsxs("select",{value:n.category,onChange:p=>f({...n,category:p.target.value}),className:j,children:[r.jsx("option",{value:"",children:"请选择分类"}),a.map(p=>r.jsx("option",{value:p,children:p},p))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目类型"}),r.jsxs("select",{value:n.type,onChange:p=>f({...n,type:p.target.value}),className:j,children:[r.jsx("option",{value:"static",children:"静态题目"}),r.jsx("option",{value:"question",children:"问答题目"}),r.jsx("option",{value:"dynamic",children:"动态题目"}),r.jsx("option",{value:"pods",children:"容器题目"})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),r.jsx("textarea",{value:n.desc,onChange:p=>f({...n,desc:p.target.value}),className:D,placeholder:"输入题目描述内容"})]})]})]}),n.type==="dynamic"&&r.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[r.jsx("div",{className:"flex justify-between items-center mb-3",children:r.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Generator 设置"})}),r.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"附件生成器镜像"}),r.jsx("div",{className:"space-y-2",children:r.jsx("div",{className:"flex gap-2 items-center",children:r.jsx("input",{type:"text",value:n.generator_image,onChange:p=>f({...n,generator_image:p.target.value}),className:_})})})]}),r.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag 设置"}),n.type!=="question"&&r.jsx(A,{variant:"primary",size:"sm",align:"icon-left",icon:r.jsx(je,{size:16}),onClick:y,children:"添加 Flag"})]}),n.type!=="question"?r.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["Flags: ","static{}, uuid{}, dynamic{}"]}):r.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"Answer:"}),r.jsx("div",{className:"space-y-2",children:n.flags.map((p,h)=>r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx("input",{type:"text",value:typeof p=="object"?p.value||"":p||"",onChange:i=>O(h,i.target.value),className:_,placeholder:`Flag ${h+1}`}),n.type!=="question"&&n.flags.length>1&&r.jsx(A,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>C(h),children:r.jsx(de,{size:18})})]},h))})]}),n.type==="pods"&&r.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Docker Compose 设置"}),t==="edit"&&r.jsx("span",{className:"text-xs text-neutral-500",children:"配置创建后不可修改"})]}),r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-1",children:[r.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["docker-compose.yaml",t==="edit"&&r.jsx("span",{className:"ml-2 text-xs text-neutral-500",children:"(只读)"})]}),t==="add"&&r.jsx(A,{variant:"ghost",size:"sm",align:"icon-left",icon:r.jsx(Ve,{size:14}),className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300 !text-xs",onClick:T,children:"全屏编辑"})]}),r.jsx("div",{className:"border border-neutral-300/30 rounded-md overflow-hidden",children:r.jsx(ue,{value:n.docker_compose||(t==="add"?be:"暂无配置"),onChange:t==="add"?F:void 0,language:"yaml",options:{readOnly:t==="edit",minimap:{enabled:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:14,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:t==="add"?"line":"none"},height:"400px",theme:"vs-dark"})}),t==="add"&&r.jsxs("div",{className:"mt-1 text-xs text-neutral-500 font-mono",children:["flag格式: ","`static{}`, `dynamic{}`, `uuid{}`",r.jsx("br",{}),"flag `环境变量` / `文件挂载` 必须以 `FLAG` 为前缀; 变量名可重复，不作为注入时的标识符使用",r.jsx("br",{}),"flag `文件挂载` 通过 labels value 字段指定值",r.jsx("br",{}),"Docker参数只接受: image, expose, ports, environment, volumes, working_dir, command",r.jsx("br",{}),"同一道题目中, 所有的容器名必须唯一, 作为唯一 DNS Hostname"]})]})})]})]})}),r.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[r.jsx(A,{variant:"ghost",size:"sm",onClick:o,children:"取消"}),r.jsx(A,{variant:"primary",size:"sm",onClick:()=>l(n),children:t==="add"?"添加题目":t==="edit"?"保存更改":"确认删除"})]})]}),M.isOpen&&r.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center",children:r.jsxs(re.div,{className:"w-[95vw] h-[95vh] bg-neutral-900 border border-neutral-700 rounded-lg overflow-hidden",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700 bg-neutral-800",children:[r.jsx("div",{className:"flex items-center gap-3",children:r.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Docker Compose 配置编辑器"})}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(A,{variant:"primary",size:"sm",onClick:k,children:"保存"}),r.jsx(A,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:L,children:r.jsx(fe,{size:18})})]})]}),r.jsx("div",{className:"h-[calc(95vh-80px)] overflow-hidden",children:r.jsx(ue,{value:M.value,onChange:P,language:"yaml",options:{readOnly:!1,minimap:{enabled:!0},scrollBeyondLastLine:!1,scrollbar:{vertical:"auto",horizontal:"auto"},lineNumbers:"on",folding:!0,wordWrap:"on",fontSize:16,fontFamily:'Consolas, "Courier New", monospace',tabSize:2,insertSpaces:!0,renderLineHighlight:"line",automaticLayout:!0,suggest:{showKeywords:!0,showSnippets:!0}},theme:"vs-dark"})}),r.jsxs("div",{className:"absolute bottom-4 left-4 text-xs text-neutral-500 font-mono bg-neutral-800/80 px-3 py-2 rounded border border-neutral-700",children:[r.jsx("div",{children:"使用 Ctrl+S 保存并关闭 • ESC 取消编辑"}),r.jsxs("div",{className:"mt-1",children:["flag格式: static","{}",", dynamic","{}",", uuid","{}"]})]})]})})]}):null}function ir(){const[e,t]=d.useState([]),[n,a]=d.useState(0),[o,l]=d.useState(1),[f,y]=d.useState("all"),[C,O]=d.useState([]),[M,S]=d.useState("all"),[T,L]=d.useState(!1),[k,P]=d.useState("add"),[_,D]=d.useState(null),[j,F]=d.useState({name:"",desc:"",category:"",type:"static",flags:[{id:0,value:""}],docker_compose:""}),p=d.useRef(null),h=10;d.useEffect(()=>{i()},[]),d.useEffect(()=>{g()},[o,f,M]);const i=async()=>{try{const s=await Le();if(s.code===200){const c=["Web","Misc","Pwn","Crypto","Reverse"],u=[...new Set([...c,...s.data||[]])];O(u)}else I.danger({description:s.msg||"获取题目分类失败"}),O(["Web","Misc","Pwn","Crypto","Reverse"])}catch(s){console.error("获取题目分类失败:",s),I.danger({description:"获取题目分类失败"}),O(["Web","Misc","Pwn","Crypto","Reverse"])}},g=async()=>{try{const s={limit:h,offset:(o-1)*h};f!=="all"&&(s.type=f),M!=="all"&&(s.category=M);const c=await Ie(s);c.code===200?(t(c.data.challenges.map(u=>{let x=[];return u.flags&&Array.isArray(u.flags)?u.flags.length>0&&typeof u.flags[0]=="object"?x=u.flags:x=u.flags.map((E,oe)=>({id:oe,value:E||""})):u.flag?x=[{id:0,value:u.flag}]:x=[{id:0,value:""}],{...u,flags:x}})),a(c.data.count)):I.danger({description:c.msg||"获取题目列表失败"})}catch(s){I.danger({description:"获取题目列表失败"}),console.error(s)}},z=s=>{y(s),l(1)},N=s=>{S(s),l(1)},b=()=>{P("add"),F({name:"",desc:"",category:"",type:"static",flags:[{id:0,value:""}],docker_compose:""}),L(!0)},G=async s=>{P("edit"),D(s);try{const c=await Re(s.id);if(c.code===200){const u=c.data;let x=[];u.flags&&Array.isArray(u.flags)?u.flags.length>0&&typeof u.flags[0]=="object"?x=u.flags:x=u.flags.map((E,oe)=>({id:oe,value:E||""})):x=[{id:0,value:""}],F({...u,flags:x}),L(!0)}else I.danger({description:c.msg||"获取题目详情失败"})}catch(c){console.error("获取题目详情失败:",c),I.danger({description:"获取题目详情失败"})}},H=s=>{P("delete"),D(s),L(!0)},W=s=>{var c;(c=p.current)==null||c.click(),D(s)},U=async s=>{try{const c=await Pe(s.id,"attachment.zip"),u=window.URL.createObjectURL(new Blob([c.data])),x=document.createElement("a");x.href=u,x.setAttribute("download","attachment.zip"),document.body.appendChild(x),x.click(),x.remove()}catch(c){console.error("下载附件失败:",c),I.danger({description:"下载附件失败"})}},m=async s=>{var u;const c=(u=s.target.files)==null?void 0:u[0];if(s.target.value="",!!c){if((_.type==="static"||_.type==="question")&&c.name!=="attachment.zip"||_.type==="dynamic"&&c.name!=="generator.zip"||_.type==="pods"&&c.name!=="attachment.zip"){I.danger({description:"文件名必须与题目类型匹配"});return}try{const x=await De(_.id,c);x.code===200?I.success({description:"上传附件成功"}):I.danger({description:x.msg||"上传附件失败"})}catch(x){console.error("上传附件失败:",x),I.danger({description:"上传附件失败"})}}},w=s=>{F(s)},$=()=>{F({...j,flags:[...j.flags,{id:0,value:""}]})},q=s=>{const c=[...j.flags];c.splice(s,1),F({...j,flags:c})},B=(s,c)=>{const u=[...j.flags];typeof u[s]=="object"&&u[s]!==null?u[s]={id:u[s].id||0,value:c}:u[s]={id:0,value:c},F({...j,flags:u})},se=()=>{L(!1)},v=async s=>{try{let c;if(k==="delete")c=await $e(_.id);else{const u={name:s.name,desc:s.desc,category:s.category,type:s.type};let x=[];if(s.flags&&s.flags.length>0?k==="edit"?x=s.flags.map(E=>typeof E=="object"&&E!==null&&"value"in E?{id:E.id||0,value:E.value||""}:{id:0,value:E||""}):x=s.flags.map(E=>typeof E=="object"&&E!==null&&"value"in E?E.value||"":E||""):x=k==="edit"?[]:[""],s.type==="static"||s.type==="question")u.flags=x;else if(s.type==="dynamic")u.flags=x,u.generator_image=s.generator_image||"";else if(s.type==="pods")if(k==="add"){const E=`
services:
  test_service:
    image: docker.example.com/example/test_image:123
    expose:
      - "80"
      - "443"
    ports:
      - "8080:80"
    environment:
      - FLAG=static{static_flag}
      - FLAG_2=dynamic{dynamic_flag}
      - FLAG_3=uuid{}
    volumes:
      - FLAG_0:/path/to/flag
    working_dir: /path

  another_service:
    image: docker.example.com/example/test2_image:123
    expose:
      - "80"
      - "443"
    ports:
      - "8080:80"
    environment:
      - FLAG_3=another_env_flag_value
    volumes:
      - FLAG_1:/path/to/another_flag
    working_dir: /path

volumes:
  FLAG_0:
    labels:
      - value=static{static_flag_value}
  FLAG_1:
    labels:
      - value=dynamic{dynamic_flag_value}
`.trim();u.docker_compose=s.docker_compose&&s.docker_compose.trim()?s.docker_compose:E}else u.flags=x;else{I.danger({description:"错误的题目类型"});return}k==="add"?c=await Te(u):k==="edit"&&(c=await Ge(_.id,u))}c.code===200?(I.success({description:`${k==="add"?"创建":k==="edit"?"更新":"删除"}题目成功`}),L(!1),await g()):I.danger({description:c.msg||`${k==="add"?"创建":k==="edit"?"更新":"删除"}题目失败`})}catch(c){console.error(`${k==="add"?"创建":k==="edit"?"更新":"删除"}题目失败:`,c),I.danger({description:`${k==="add"?"创建":k==="edit"?"更新":"删除"}题目失败`})}};return r.jsxs(r.Fragment,{children:[r.jsx(Kt,{challenges:e,totalCount:n,currentPage:o,pageSize:h,categories:C,filterCategory:M,filterType:f,onPageChange:l,onAddChallenge:b,onEditChallenge:G,onDeleteChallenge:H,onUploadAttachment:W,onDownloadAttachment:U,onFilterTypeChange:z,onFilterCategoryChange:N}),r.jsx(Xt,{isOpen:T,mode:k,challenge:j,categories:C,onClose:se,onSubmit:v,onChange:w,onAddFlag:$,onRemoveFlag:q,onFlagChange:B}),r.jsx("input",{type:"file",ref:p,className:"hidden",onChange:m})]})}export{ir as default};
