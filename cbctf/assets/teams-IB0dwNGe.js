import{j as e,m as R,B as w,e as V,u as H,r as o,t as r}from"./index-CgZTD9Pu.js";import{A as O,M as E}from"./AdminModal-CumzojcM.js";import{A as q}from"./AdminPagination-DNdGZRjR.js";import{c as S}from"./createReactComponent-BlgYQX3K.js";import{I as G}from"./IconEdit-B766bSf8.js";import{I as J}from"./IconTrash-lqlEo6-K.js";import{j as Q,k as W,l as X,m as Y,n as Z}from"./contest-BfTH-A8S.js";import"./IconX-Bsw7qwE9.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var F=S("outline","container","IconContainer",[["path",{d:"M20 4v.01",key:"svg-0"}],["path",{d:"M20 20v.01",key:"svg-1"}],["path",{d:"M20 16v.01",key:"svg-2"}],["path",{d:"M20 12v.01",key:"svg-3"}],["path",{d:"M20 8v.01",key:"svg-4"}],["path",{d:"M8 4m0 1a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-6a1 1 0 0 1 -1 -1z",key:"svg-5"}],["path",{d:"M4 4v.01",key:"svg-6"}],["path",{d:"M4 20v.01",key:"svg-7"}],["path",{d:"M4 16v.01",key:"svg-8"}],["path",{d:"M4 12v.01",key:"svg-9"}],["path",{d:"M4 8v.01",key:"svg-10"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ee=S("outline","user-minus","IconUserMinus",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4c.348 0 .686 .045 1.009 .128",key:"svg-1"}],["path",{d:"M16 19h6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var se=S("outline","users","IconUsers",[["path",{d:"M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0",key:"svg-0"}],["path",{d:"M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2",key:"svg-1"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"svg-2"}],["path",{d:"M21 21v-2a4 4 0 0 0 -3 -3.85",key:"svg-3"}]]);function te({teams:c=[],totalCount:h=0,currentPage:M=1,pageSize:u=6,teamMembers:m=[],loadingMembers:C=!1,editForm:n={},selectedUserId:j="",showModal:I=!1,modalMode:a="edit",selectedTeam:l=null,onPageChange:p,onEditTeam:i,onDeleteTeam:g,onKickMember:v,onViewContainers:k,onModalClose:x,onModalSubmit:f,onFormChange:d,onUserSelect:N}){const _=()=>a==="delete"?e.jsxs("p",{className:"text-neutral-300",children:["确定要删除团队 ",l==null?void 0:l.name," 吗？此操作不可恢复。"]}):a==="kick"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-neutral-300",children:["从团队 ",l==null?void 0:l.name," 中移出成员："]}),C?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("p",{className:"text-neutral-400",children:"加载成员列表中..."})}):m.length===0?e.jsx("p",{className:"text-neutral-400",children:"暂无团队成员"}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"选择要移出的成员"}),e.jsxs("select",{value:j,onChange:s=>N(s.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                                    text-neutral-50\r
                                    focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                                    transition-all duration-200`,children:[e.jsx("option",{value:"",children:"请选择成员"}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"团队名称"}),e.jsx("input",{type:"text",value:n.name,onChange:s=>d({...n,name:s.target.value}),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50 placeholder-neutral-500\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"团队描述"}),e.jsx("textarea",{value:n.desc,onChange:s=>d({...n,desc:s.target.value}),rows:3,className:`w-full p-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50 placeholder-neutral-500\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200 resize-none`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"队长"}),e.jsxs("select",{value:j,onChange:s=>N(s.target.value),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200`,children:[e.jsx("option",{value:"",children:"选择队长"}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-2",children:"邀请码"}),e.jsx("input",{type:"text",value:n.captcha,onChange:s=>d({...n,captcha:s.target.value}),className:`w-full h-[40px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                            text-neutral-50 placeholder-neutral-500\r
                            focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                            transition-all duration-200`})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"banned",checked:n.banned,onChange:s=>d({...n,banned:s.target.checked}),className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                                focus:ring-geek-400 focus:ring-offset-0 bg-black/20`}),e.jsx("label",{htmlFor:"banned",className:"text-sm font-mono text-neutral-400",children:"封禁"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"hidden",checked:n.hidden,onChange:s=>d({...n,hidden:s.target.checked}),className:`w-4 h-4 rounded border-neutral-300/30 text-geek-400 \r
                                focus:ring-geek-400 focus:ring-offset-0 bg-black/20`}),e.jsx("label",{htmlFor:"hidden",className:"text-sm font-mono text-neutral-400",children:"隐藏"})]})]})]}),y=()=>e.jsxs(e.Fragment,{children:[e.jsx(E,{onClick:x,children:"取消"}),e.jsx(E,{variant:a==="delete"?"danger":"primary",onClick:f,children:"确认"})]});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center mb-8",children:e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"团队管理"})}),c.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300/30 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/50 text-left",children:[e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"团队"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"得分"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"成员数"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"最后提交"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono",children:"状态"}),e.jsx("th",{className:"p-4 text-neutral-400 font-mono text-right",children:"操作"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs(R.tr,{className:"border-t border-neutral-700 hover:bg-black/20",whileHover:{backgroundColor:"rgba(0,0,0,0.3)"},children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full bg-black/40 border border-neutral-300/30 \r
                                                    flex items-center justify-center text-neutral-400`,children:e.jsx(se,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-neutral-50 font-medium",children:s.name}),s.desc&&e.jsx("div",{className:"text-sm text-neutral-400 mt-0.5",children:s.desc})]})]})}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono",children:s.score}),e.jsxs("td",{className:"p-4 text-neutral-300 font-mono",children:[s.users," 人"]}),e.jsx("td",{className:"p-4 text-neutral-300 font-mono",children:s.last?new Date(s.last).toLocaleString():"无提交"}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex gap-4 items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono
                                                        ${s.banned?"bg-red-400/20 text-red-400":"bg-neutral-400/20 text-neutral-400"}`,children:s.banned?"已封禁":"正常"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono
                                                        ${s.hidden?"bg-yellow-400/20 text-yellow-400":"bg-neutral-400/20 text-neutral-400"}`,children:s.hidden?"已隐藏":"可见"})]})})}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(w,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>i(s),children:e.jsx(G,{size:18})}),e.jsx(w,{variant:"ghost",size:"icon",className:"!text-yellow-400 hover:!text-yellow-300",onClick:()=>v(s),children:e.jsx(ee,{size:18})}),e.jsx(w,{variant:"ghost",size:"icon",className:"!text-neutral-400 hover:!text-neutral-300",onClick:()=>k(s),children:e.jsx(F,{size:18})}),e.jsx(w,{variant:"ghost",size:"icon",className:"!text-red-400 hover:!text-red-300",onClick:()=>g(s),children:e.jsx(J,{size:18})})]})})]},s.id))})]})})}),h>u&&e.jsx("div",{className:"mt-6",children:e.jsx(q,{total:Math.ceil(h/u),current:M,pageSize:u,onChange:p,showTotal:!0,totalItems:h})}),e.jsx(O,{isOpen:I,onClose:x,title:a==="edit"?"编辑团队信息":a==="delete"?"删除团队":"移出团队成员",size:a==="edit"?"lg":"sm",footer:y(),children:_()})]})}function xe(){const{id:c}=V(),h=H(),[M,u]=o.useState([]),[m,C]=o.useState(0),[n,j]=o.useState(1),[I,a]=o.useState(!1),[l,p]=o.useState(null),[i,g]=o.useState("edit"),[v,k]=o.useState({name:"",desc:"",hidden:!1,banned:!1,captcha:"",captain_id:""}),[x,f]=o.useState(""),[d,N]=o.useState([]),[_,y]=o.useState(!1),s=6;o.useEffect(()=>{z()},[c,n]);const z=async()=>{try{const t=await Q(parseInt(c),{limit:s,offset:(n-1)*s});t.code===200?(console.log(t.data),u(t.data.teams),C(t.data.count)):r.danger({description:t.msg||"获取团队列表失败"})}catch(t){console.log(t),r.danger({description:"获取团队列表失败"})}},T=async t=>{try{y(!0);const b=await Z(parseInt(c),t.id);b.code===200?N(b.data||[]):r.danger({description:b.msg||"获取团队成员失败"})}catch(b){console.log(b),r.danger({description:"获取团队成员失败"})}finally{y(!1)}},A=t=>{p(t),f(""),k({name:t.name,desc:t.desc||"",hidden:t.hidden,banned:t.banned,captcha:t.captcha||"",captain_id:t.captain_id||""}),g("edit"),T(t),a(!0)},U=t=>{p(t),g("delete"),a(!0)},P=t=>{p(t),f(""),g("kick"),T(t),a(!0)},$=t=>{h(`/admin/contests/${c}/teams/${t.id}/containers`)},B=()=>{a(!1)},D=t=>{k(t)},K=t=>{f(t)},L=async()=>{try{if(i==="edit"){const t=await W(parseInt(c),l.id,v);t.code===200?r.success({description:"更新团队信息成功"}):r.danger({description:t.msg||"更新团队信息失败"})}else if(i==="delete"){const t=await X(parseInt(c),l.id);t.code===200?r.success({description:"删除团队成功"}):r.danger({description:t.msg||"删除团队失败"})}else if(i==="kick"){if(!x){r.warning({description:"请选择要移出的成员"});return}const t=await Y(parseInt(c),l.id,x);t.code===200?r.success({description:"移出成员成功"}):r.danger({description:t.msg||"移出成员失败"})}a(!1),z()}catch(t){console.log(t),r.danger({description:"操作失败"})}};return e.jsx(te,{teams:M,totalCount:m,currentPage:n,pageSize:s,teamMembers:d,loadingMembers:_,editForm:v,selectedUserId:x,showModal:I,modalMode:i,selectedTeam:l,onPageChange:j,onEditTeam:A,onDeleteTeam:U,onKickMember:P,onViewContainers:$,onModalClose:B,onModalSubmit:L,onFormChange:D,onUserSelect:K})}export{xe as default};
