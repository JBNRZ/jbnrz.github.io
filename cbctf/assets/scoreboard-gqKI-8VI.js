import{r as o,j as e,m as $,B as P,e as Z,t as C}from"./index-T-fbxVIN.js";import{i as q,j as J}from"./contest-3Kk5PDXM.js";import{A as K}from"./AdminPagination-CkJjWKuQ.js";import{I as Q}from"./IconEdit-BPSPd7gw.js";import{I as X}from"./IconRefresh-q-u7R-2Y.js";import{c as ee}from"./createReactComponent-BWR0b8rR.js";import{I as te}from"./IconTable-Tgr9OMJY.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var se=ee("outline","list","IconList",[["path",{d:"M9 6l11 0",key:"svg-0"}],["path",{d:"M9 12l11 0",key:"svg-1"}],["path",{d:"M9 18l11 0",key:"svg-2"}],["path",{d:"M5 6l0 .01",key:"svg-3"}],["path",{d:"M5 12l0 .01",key:"svg-4"}],["path",{d:"M5 18l0 .01",key:"svg-5"}]]);const ae={WEB:"bg-blue-400",CRYPTO:"bg-purple-400",PWN:"bg-red-400",REVERSE:"bg-green-400",MISC:"bg-yellow-400"};function re({solved:m,totalSolved:l}){const h=l-Object.values(m).reduce((d,r)=>d+r,0);return e.jsxs("div",{className:"flex items-center justify-center gap-2 w-full",children:[Object.entries(m).map(([d,r])=>r<=0?null:e.jsxs("div",{className:"flex items-center gap-1.5 font-mono text-xs",title:`${d}: ${r}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${ae[d]||"bg-gray-400"}`}),e.jsx("span",{className:"text-neutral-300",children:r})]},d)),h>0&&e.jsxs("div",{className:"flex items-center gap-1.5 font-mono text-xs",title:`未解题目: ${h}`,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-neutral-600"}),e.jsx("span",{className:"text-neutral-400",children:h})]})]})}function ne({totalTeams:m,totalSolves:l,highestScore:h,totalPlayers:d}){const r=[{label:"Total Teams",value:m,valueClass:"text-neutral-50"},{label:"Total Players",value:d,valueClass:"text-neutral-50"},{label:"Total Solves",value:l,valueClass:"text-geek-400"},{label:"Highest Score",value:h,valueClass:"text-yellow-400"}];return e.jsx("div",{className:"grid grid-cols-4 gap-6",children:r.map((b,v)=>{var i;return e.jsxs($.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:v*.05},children:[e.jsx("div",{className:"text-neutral-400 text-sm",children:b.label}),e.jsx($.div,{className:`font-mono text-2xl ${b.valueClass}`,initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:v*.05},children:((i=b.value)==null?void 0:i.toLocaleString())||0})]},v)})})}function le({stats:m,teams:l=[],currentPage:h=1,totalPages:d=1,pageSize:r=6,totalCount:b=0,onPageChange:v,onResetTeamScore:i,onUpdateTeamScore:j,onExportScoreboard:L}){const[_,y]=o.useState(null),[t,a]=o.useState(null),[c,g]=o.useState(""),f=s=>{a(s),g(s.score.toString())},N=()=>{if(t&&j){const s=parseInt(c);isNaN(s)||j(t.id,s)}a(null)},k=()=>{a(null)};return e.jsxs("div",{className:"w-full space-y-6",children:[e.jsx(ne,{...m}),e.jsxs($.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"grid grid-cols-[80px_240px_120px_auto_120px_150px] gap-4 p-4 border-b border-neutral-300/30 place-items-center",children:[e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"RANK"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm",children:"TEAM"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"SCORE"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-center",children:"CHALLENGES"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"LAST SUBMIT"}),e.jsx("div",{className:"text-neutral-400 font-mono text-sm flex items-center justify-end",children:"OPERATIONS"})]}),e.jsx("div",{className:"divide-y divide-neutral-300/10",children:l.length===0?e.jsx("div",{className:"py-12 flex justify-center items-center",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):l.map((s,A)=>e.jsxs($.div,{className:"grid grid-cols-[80px_240px_120px_auto_120px_150px] gap-4 p-4 hover:bg-neutral-300/5 transition-colors duration-200 place-items-center",onMouseEnter:()=>y(A),onMouseLeave:()=>y(null),children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`font-mono text-xl
                                      ${s.rank===1?"text-yellow-400":s.rank===2?"text-neutral-300":s.rank===3?"text-orange-400":"text-neutral-400"}
                                  `,children:["#",s.rank]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border border-neutral-300/30 bg-neutral-700/50 bg-cover bg-center",style:{backgroundImage:`url(${s.avatar||"/default-team-avatar.png"})`}}),e.jsx("span",{className:"text-neutral-50 font-mono",children:s.name})]}),e.jsx("div",{className:"flex items-center justify-end",children:t&&t.id===s.id?e.jsx("input",{type:"number",value:c,onChange:T=>g(T.target.value),className:"w-20 bg-black/50 border border-geek-400 rounded-md p-1 text-neutral-50 font-mono text-center",autoFocus:!0,onKeyDown:T=>{T.key==="Enter"&&N(),T.key==="Escape"&&k()},onBlur:N}):e.jsx("span",{className:"text-geek-400 font-mono",children:s.score.toLocaleString()})}),s.solved&&e.jsx(re,{solved:s.solved,totalSolved:s.totalSolved}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("span",{className:"text-neutral-400 font-mono text-sm",children:s.lastSubmit})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(P,{variant:"ghost",size:"icon",className:"!text-geek-400 hover:!text-geek-300",onClick:()=>f(s),children:e.jsx(Q,{size:18})}),e.jsx(P,{variant:"ghost",size:"icon",className:"!text-yellow-400 hover:!text-yellow-300",onClick:()=>i==null?void 0:i(s.id),children:e.jsx(X,{size:18})})]})]},A))})]}),b>r&&e.jsx("div",{className:"mt-6",children:e.jsx(K,{total:Math.ceil(b/r),current:h,pageSize:r,onChange:v,showTotal:!0,totalItems:b})})]})}const oe={Web:"bg-blue-500",Crypto:"bg-purple-500",Pwn:"bg-red-500",Reverse:"bg-green-500",Misc:"bg-yellow-500",Forensics:"bg-pink-500",Blockchain:"bg-indigo-500"};function ie({teams:m=[],challenges:l=[],totalCount:h=0,currentPage:d=1,pageSize:r=10,onPageChange:b}){const[v,i]=o.useState(null),j=l.reduce((t,a)=>(t[a.category]||(t[a.category]=[]),t[a.category].push(a),t),{}),L=(t,a)=>{var g;const c=(g=t.challenges)==null?void 0:g.find(f=>f.id===a);return c?c.solved>0:!1},_=t=>t?"bg-green-400/80 border-green-400":"bg-neutral-600/50 border-neutral-600/30",y=t=>(d-1)*r+t+1;return e.jsxs("div",{className:"w-full space-y-6",children:[e.jsx("div",{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",style:{minWidth:"800px"},children:[e.jsxs("thead",{children:[e.jsxs("tr",{className:"bg-black/50",children:[e.jsx("th",{className:"sticky left-0 z-10 bg-black/50 p-3 text-left text-neutral-400 font-mono text-sm border-r border-neutral-300/30",children:"排名"}),e.jsx("th",{className:"sticky left-[60px] z-10 bg-black/50 p-3 text-left text-neutral-400 font-mono text-sm border-r border-neutral-300/30 min-w-[150px]",children:"队伍"}),e.jsx("th",{className:"sticky left-[210px] z-10 bg-black/50 p-3 text-center text-neutral-400 font-mono text-sm border-r border-neutral-300/30 min-w-[80px]",children:"分数"}),Object.entries(j).map(([t,a])=>e.jsx("th",{className:"text-center text-neutral-400 font-mono text-sm border-r border-neutral-300/30",colSpan:a.length,children:e.jsxs("div",{className:"flex items-center justify-center gap-2 p-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${oe[t]||"bg-gray-500"}`}),e.jsx("span",{children:t}),e.jsxs("span",{className:"text-xs text-neutral-500",children:["(",a.length,")"]})]})},t))]}),e.jsxs("tr",{className:"bg-black/40 border-t border-neutral-300/30",children:[e.jsx("th",{className:"sticky left-0 z-10 bg-black/40 p-2 border-r border-neutral-300/30"}),e.jsx("th",{className:"sticky left-[60px] z-10 bg-black/40 p-2 border-r border-neutral-300/30"}),e.jsx("th",{className:"sticky left-[210px] z-10 bg-black/40 p-2 border-r border-neutral-300/30"}),Object.entries(j).map(([t,a])=>a.map((c,g)=>e.jsx("th",{className:"p-3 text-center text-neutral-400 font-mono text-xs border-r border-neutral-300/30 min-w-[150px]",title:c.name,children:e.jsx("div",{className:"whitespace-nowrap",children:c.name})},c.id)))]})]}),e.jsx("tbody",{children:m.map((t,a)=>e.jsxs($.tr,{className:"border-t border-neutral-300/10 hover:bg-neutral-300/5",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},children:[e.jsx("td",{className:"sticky left-0 z-10 bg-black/30 p-3 text-center text-neutral-300 font-mono border-r border-neutral-300/30",children:y(a)}),e.jsx("td",{className:"sticky left-[60px] z-10 bg-black/30 p-3 border-r border-neutral-300/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border border-neutral-300/30 bg-neutral-700/50 flex items-center justify-center overflow-hidden",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover",onError:c=>{c.target.style.display="none"}}):e.jsx("div",{className:"w-3 h-3 bg-neutral-400/50 rounded-full"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-neutral-50 font-medium text-sm truncate",title:t.name,children:t.name}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[t.users,"人"]})]})]})}),e.jsx("td",{className:"sticky left-[210px] z-10 bg-black/30 p-3 text-center text-neutral-50 font-mono border-r border-neutral-300/30",children:t.score}),Object.entries(j).map(([c,g])=>g.map(f=>{const N=L(t,f.id),k=`${t.id}-${f.id}`;return e.jsx("td",{className:"p-3 text-center border-r border-neutral-300/30 min-w-[150px]",onMouseEnter:()=>i(k),onMouseLeave:()=>i(null),children:e.jsx("div",{className:`w-8 h-8 mx-auto rounded border-2 transition-all duration-200 ${_(N)}
                              ${v===k?"scale-110 shadow-lg":""}
                              flex items-center justify-center
                            `,title:`${t.name} - ${f.name}: ${N?"已解出":"未解出"}`,children:N&&e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})})})},f.id)}))]},t.id))})]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(K,{total:Math.ceil(h/r),current:d,pageSize:r,onChange:b,showTotal:!0,totalItems:h})})]})}function pe(){const{id:m}=Z(),[l,h]=o.useState("ranking"),[d,r]=o.useState([]),[b,v]=o.useState(0),[i,j]=o.useState(1),[L,_]=o.useState(!0),y=l==="ranking"?20:10,[t,a]=o.useState({totalTeams:0,totalSolves:0,highestScore:0,totalPlayers:0}),[c,g]=o.useState([]),[f,N]=o.useState([]),[k,s]=o.useState(1),[A,T]=o.useState(0),B=10;o.useEffect(()=>{l==="ranking"?V():D()},[m,l,i,k]);const V=async(x=!1)=>{try{const n=await q(parseInt(m),{limit:y,offset:(i-1)*y},x);if(n.code===200){let p;L?p=n.data.teams:p=n.data.teams.filter(u=>!u.hidden);const R=Math.max(...p.map(u=>u.score),0),S=p.reduce((u,z)=>u+z.users,0),w=p.reduce((u,z)=>{var I;const O=((I=z.solved)==null?void 0:I.reduce((M,Y)=>M+(Y.solved||0),0))||0;return u+O},0);a({totalTeams:p.length,totalSolves:w,highestScore:R,totalPlayers:S});const E=p.map((u,z)=>{const O={};let I=0;return u.solved&&Array.isArray(u.solved)&&u.solved.forEach(M=>{M.category&&(O[M.category]=M.solved||0,I+=M.all||0)}),{...u,rank:(i-1)*y+z+1,lastSubmit:F(u.last),solved:O,totalSolved:I}});r(E),v(n.data.count)}else C.danger({description:n.msg||"获取团队列表失败"})}catch(n){console.error("获取团队列表失败:",n),C.danger({description:"获取团队列表失败"})}},D=async()=>{var x;try{const n=await J(parseInt(m),{limit:B,offset:(k-1)*B});if(n.code===200){g(n.data.teams||[]),T(n.data.count||0);const p=[],R=new Map;(x=n.data.teams)==null||x.forEach(S=>{var w;(w=S.challenges)==null||w.forEach(E=>{R.has(E.id)||(R.set(E.id,E),p.push(E))})}),p.sort((S,w)=>S.category!==w.category?S.category.localeCompare(w.category):S.name.localeCompare(w.name)),N(p)}else C.danger({description:n.msg||"获取积分榜失败"})}catch(n){console.error("获取积分榜失败:",n),C.danger({description:"获取积分榜失败"})}},F=x=>!x||x==="0001-01-01T00:00:00Z"?"无提交":new Date(x).toLocaleString(),U=async x=>{C.info({description:"此功能暂未实现"})},G=async(x,n)=>{C.info({description:"此功能暂未实现"})},H=async()=>{C.info({description:"此功能暂未实现"})},W=x=>{h(x),x==="table"?s(1):j(1)};return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"积分榜管理"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-black/30 border border-neutral-300/30 rounded-md",children:[e.jsx(P,{variant:l==="ranking"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(se,{size:16}),onClick:()=>W("ranking"),children:"排名视图"}),e.jsx(P,{variant:l==="table"?"primary":"ghost",size:"sm",align:"icon-left",icon:e.jsx(te,{size:16}),onClick:()=>W("table"),children:"表格视图"})]}),e.jsx(P,{variant:"outline",size:"sm",onClick:H,children:"导出积分榜"})]})]}),l==="ranking"?e.jsx(le,{stats:t,teams:d,currentPage:i,pageSize:y,totalCount:b,onPageChange:j,onResetTeamScore:U,onUpdateTeamScore:G,onExportScoreboard:H}):e.jsx(ie,{teams:c,challenges:f,totalCount:A,currentPage:k,pageSize:B,onPageChange:s})]})}export{pe as default};
