import{j as e,B as x,m as T,r as N,t as k}from"./index-D74-Vvq7.js";import{I as _}from"./IconPlus-CxCi8Tai.js";import{I as ee}from"./IconUpload-Dv1zfMDl.js";import{I as se}from"./IconDownload-DupLH-g7.js";import{I as te}from"./IconEdit-BcgJcCls.js";import{I as F}from"./IconTrash-b1LAdmqV.js";import{I as ae}from"./IconServer-CWW2H2v_.js";import{c as re}from"./createReactComponent-D1qxsC-S.js";import{I as ne}from"./IconX-CsfapbUz.js";import{g as le,a as ie,d as oe,u as ce,c as de,b as me,e as xe}from"./challenge-BIVtKZBf.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var pe=re("outline","shield","IconShield",[["path",{d:"M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3",key:"svg-0"}]]);function he({challenges:R=[],totalCount:C=0,currentPage:i=1,pageSize:D=10,categories:M=[],filterCategory:S="all",filterType:j="all",onPageChange:U,onAddChallenge:B,onEditChallenge:E,onDeleteChallenge:h,onUploadAttachment:O,onDownloadAttachment:G,onFilterTypeChange:$,onFilterCategoryChange:f}){const p=c=>{const b={web:"bg-blue-400/20 text-blue-400",crypto:"bg-purple-400/20 text-purple-400",pwn:"bg-red-400/20 text-red-400",reverse:"bg-green-400/20 text-green-400",misc:"bg-yellow-400/20 text-yellow-400"}[c.toLowerCase()]||"bg-neutral-400/20 text-neutral-400";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${b}`,children:c})},z=c=>{const b={static:{label:"静态题目",class:"bg-geek-400/20 text-geek-400"},dynamic:{label:"动态题目",class:"bg-orange-400/20 text-orange-400"},pods:{label:"容器题目",class:"bg-cyan-400/20 text-cyan-400"}}[c]||{label:c,class:"bg-neutral-400/20 text-neutral-400"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-mono ${b.class}`,children:b.label})},P=c=>!c||c.length===0?e.jsx("span",{className:"text-neutral-500 font-mono text-sm",children:"无"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:c.map((g,b)=>e.jsx("span",{className:"px-2 py-1 bg-black/30 border border-neutral-300/30 rounded text-xs font-mono text-neutral-300",title:g,children:g.length>15?`${g.substring(0,15)}...`:g},b))}),w=c=>!c||c.length===0?null:e.jsxs("div",{className:"mt-3 border-t border-neutral-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{size:14,className:"text-cyan-400"}),e.jsx("span",{className:"text-sm text-neutral-400 font-mono",children:"容器配置："})]}),e.jsx("div",{className:"space-y-2",children:c.map((g,b)=>e.jsxs("div",{className:"p-2 bg-black/40 border border-neutral-300/20 rounded-md text-xs font-mono",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsxs("span",{className:"text-cyan-400",children:["容器 ",b+1,":"]}),e.jsx("span",{className:"text-neutral-300",children:g.image||"未指定镜像"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"容器组号"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:e.jsx("span",{className:"px-1 bg-black/30 border border-neutral-300/20 rounded text-white",children:g.pod_group})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"开放端口:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:(g.ports||[]).length>0?g.ports.map((u,y)=>e.jsx("span",{className:"px-1 bg-black/30 border border-neutral-300/20 rounded text-white",children:u},y)):e.jsx("span",{className:"text-neutral-500",children:"无"})})]}),g.flags&&g.flags.length>0&&g.flags[0]!==""&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"容器Flag:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:g.flags.map((u,y)=>e.jsx("span",{className:"px-1 bg-black/30 border border-cyan-400/30 rounded text-cyan-300",title:u,children:u.length>15?`${u.substring(0,15)}...`:u},y))})]})]}),g.network_policies&&g.network_policies.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-neutral-700 border-dashed",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(pe,{size:12,className:"text-geek-400"}),e.jsx("span",{className:"text-neutral-400",children:"网络策略:"})]}),e.jsx("div",{className:"space-y-2 pl-2 mt-1",children:g.network_policies.map((u,y)=>e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"mb-1",children:e.jsxs("span",{className:"text-neutral-300",children:["策略 ",y+1]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 pl-2",children:[u.from&&u.from.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"From:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:u.from.map((v,H)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:v.cidr||"任意"}),v.except&&v.except.length>0&&v.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",v.except.join(", ")]})]},H))})]}),u.to&&u.to.length>0&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-neutral-400",children:"To:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:u.to.map((v,H)=>e.jsxs("div",{className:"px-1 py-0.5 bg-black/30 border border-geek-400/20 rounded",children:[e.jsx("span",{className:"text-white",children:v.cidr||"任意"}),v.except&&v.except.length>0&&v.except[0]!==""&&e.jsxs("span",{className:"text-red-300",children:[" except: ",v.except.join(", ")]})]},H))})]})]})]},y))})]})]},b))})]});return e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-mono text-neutral-50 tracking-wider",children:"题目管理"}),e.jsx(x,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(_,{size:16}),onClick:B,children:"添加题目"})]}),e.jsx("div",{className:"mb-6 border-b border-neutral-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"flex gap-8",children:[{id:"all",label:"全部"},{id:"static",label:"静态题目"},{id:"dynamic",label:"动态题目"},{id:"pods",label:"容器题目"}].map(c=>e.jsxs("div",{className:"relative",children:[e.jsx(x,{variant:j===c.id?"primary":"ghost",size:"sm",className:`!px-2 !min-w-0 !border-0 pb-3 ${j===c.id?"!bg-transparent !text-geek-400":"!text-neutral-400"}`,onClick:()=>$(c.id),children:c.label}),j===c.id&&e.jsx(T.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-geek-400",layoutId:"filterTypeIndicator"})]},c.id))})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:S,onChange:c=>f(c.target.value),className:`w-full h-[38px] px-4 bg-black/20 border border-neutral-300/30 rounded-md\r
                text-neutral-50 placeholder-neutral-500\r
                focus:outline-none focus:border-geek-400 focus:shadow-[0_0_15px_rgba(89,126,247,0.3)]\r
                transition-all duration-200`,children:[e.jsx("option",{value:"all",children:"全部分类"}),M.map(c=>e.jsx("option",{value:c,children:c},c))]})})]})}),R.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 border border-neutral-300 rounded-md bg-black/30",children:e.jsx("p",{className:"text-neutral-400 font-mono",children:"暂无数据"})}):e.jsx("div",{className:"space-y-4",children:R.map(c=>e.jsx(T.div,{className:"border border-neutral-300 rounded-md bg-black/30 backdrop-blur-[2px] overflow-hidden",whileHover:{y:-2,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},transition:{duration:.2},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-mono text-neutral-50",children:c.name}),e.jsxs("div",{className:"flex gap-2",children:[p(c.category),z(c.type)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>O(c),children:e.jsx(ee,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:()=>G(c),children:e.jsx(se,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>E(c),children:e.jsx(te,{size:18})}),e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>h(c),children:e.jsx(F,{size:18})})]})]}),e.jsx("p",{className:"text-neutral-300 mb-4 font-mono text-sm",children:c.desc}),c.type!=="pods"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-neutral-400 font-mono",children:"Flags:"}),P(c.flags)]}),c.type==="pods"&&w(c.dockers)]})},c.id||c.name))}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"sm",disabled:i===1,onClick:()=>U(i>1?i-1:1),className:i===1?"!border-neutral-700 !text-neutral-600":"",children:"上一页"}),e.jsxs("span",{className:"text-neutral-400 text-sm",children:[i," / ",Math.ceil(C/D)]}),e.jsx(x,{variant:"ghost",size:"sm",disabled:i>=Math.ceil(C/D),onClick:()=>U(i<Math.ceil(C/D)?i+1:Math.ceil(C/D)),className:i>=Math.ceil(C/D)?"!border-neutral-700 !text-neutral-600":"",children:"下一页"})]})})]})}function ge({isOpen:R=!1,mode:C="add",challenge:i={name:"",desc:"",category:"",type:"static",generator:"",flags:[""],dockers:[{pod_group:0,flags:[""],image:"",ports:[0],hostname:"",network_policies:[{from:[{hostname:"",cidr:"",except:[""]}],to:[{hostname:"",cidr:"",except:[""]}]}]}]},categories:D=[],onClose:M,onSubmit:S,onChange:j,onAddFlag:U,onRemoveFlag:B,onFlagChange:E}){const h="w-full bg-black/20 border border-neutral-300/30 rounded-md p-3 text-neutral-50 font-mono focus:border-geek-400 focus:outline-none transition-colors duration-200",O=`${h} min-h-[100px] resize-none`,G=`${h} h-[48px] appearance-none`,$=()=>{const a=[...i.dockers||[],{pod_group:0,flags:[""],image:"",ports:[0],hostname:"",network_policies:[]}];j({...i,dockers:a})},f=a=>{const s=[...i.dockers];s.splice(a,1),j({...i,dockers:s})},p=(a,s)=>{const r=[...i.dockers];r[a]=s,j({...i,dockers:r})},z=(a,s)=>{const r={...i.dockers[a]};r.pod_group=s,p(a,r)},P=(a,s)=>{const r={...i.dockers[a]};r.hostname=s,p(a,r)},w=a=>{const s={...i.dockers[a]};s.flags=[...s.flags,""],p(a,s)},c=(a,s)=>{const r={...i.dockers[a]};r.flags=r.flags.filter((l,d)=>d!==s),p(a,r)},g=(a,s,r)=>{const l={...i.dockers[a]};l.flags=[...l.flags],l.flags[s]=r,p(a,l)},b=a=>{const s={...i.dockers[a]};s.ports=[...s.ports,0],p(a,s)},u=(a,s)=>{const r={...i.dockers[a]};r.ports=r.ports.filter((l,d)=>d!==s),p(a,r)},y=(a,s,r)=>{const l={...i.dockers[a]};l.ports=[...l.ports],l.ports[s]=parseInt(r)||0,p(a,l)},v=a=>{const s={...i.dockers[a]};s.network_policies||(s.network_policies=[]),s.network_policies=[...s.network_policies,{from:[{hostname:"",cidr:"",except:[""]}],to:[{hostname:"",cidr:"0.0.0.0/0",except:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","100.64.0.0/10"]}]}],p(a,s)},H=(a,s)=>{const r={...i.dockers[a]};r.network_policies=r.network_policies.filter((l,d)=>d!==s),p(a,r)},V=(a,s,r)=>{const l={...i.dockers[a]},d={...l.network_policies[s]};d[r]=[...d[r],{hostname:"",cidr:"",except:[""]}],l.network_policies[s]=d,p(a,l)},X=(a,s,r,l)=>{const d={...i.dockers[a]},t={...d.network_policies[s]};t[r]=t[r].filter((n,o)=>o!==l),d.network_policies[s]=t,p(a,d)},q=(a,s,r,l,d)=>{const t={...i.dockers[a]},n={...t.network_policies[s]},o={...n[r][l]};o.hostname=d,n[r]=[...n[r]],n[r][l]=o,t.network_policies[s]=n,p(a,t)},J=(a,s,r,l,d)=>{const t={...i.dockers[a]},n={...t.network_policies[s]},o={...n[r][l]};o.cidr=d,n[r]=[...n[r]],n[r][l]=o,t.network_policies[s]=n,p(a,t)},K=(a,s,r,l)=>{const d={...i.dockers[a]},t={...d.network_policies[s]},n={...t[r][l]};n.except=[...n.except,""],t[r]=[...t[r]],t[r][l]=n,d.network_policies[s]=t,p(a,d)},Q=(a,s,r,l,d)=>{const t={...i.dockers[a]},n={...t.network_policies[s]},o={...n[r][l]};o.except=o.except.filter((m,L)=>L!==d),n[r]=[...n[r]],n[r][l]=o,t.network_policies[s]=n,p(a,t)},Y=(a,s,r,l,d,t)=>{const n={...i.dockers[a]},o={...n.network_policies[s]},m={...o[r][l]};m.except=[...m.except],m.except[d]=t,o[r]=[...o[r]],o[r][l]=m,n.network_policies[s]=o,p(a,n)};return R?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs(T.div,{className:"w-full max-w-4xl bg-neutral-900 border border-neutral-300 rounded-md overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-neutral-700",children:[e.jsx("h2",{className:"text-xl font-mono text-neutral-50",children:C==="add"?"添加题目":"编辑题目"}),e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-neutral-400 hover:!text-neutral-300",onClick:M,children:e.jsx(ne,{size:18})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50 mb-3",children:"基本信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目名称"}),e.jsx("input",{type:"text",value:i.name,onChange:a=>j({...i,name:a.target.value}),className:h,placeholder:"输入题目名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目分类"}),e.jsxs("select",{value:i.category,onChange:a=>j({...i,category:a.target.value}),className:G,children:[e.jsx("option",{value:"",children:"请选择分类"}),D.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目类型"}),e.jsxs("select",{value:i.type,onChange:a=>j({...i,type:a.target.value}),className:G,children:[e.jsx("option",{value:"static",children:"静态题目"}),e.jsx("option",{value:"dynamic",children:"动态题目"}),e.jsx("option",{value:"pods",children:"容器题目"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"题目描述"}),e.jsx("textarea",{value:i.desc,onChange:a=>j({...i,desc:a.target.value}),className:O,placeholder:"输入题目描述内容"})]})]})]}),i.type==="dynamic"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Generator 设置"})}),e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"附件生成器镜像"}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("input",{type:"text",value:i.generator,onChange:a=>j({...i,generator:a.target.value}),className:h})})})]}),i.type!=="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"Flag 设置"}),e.jsx(x,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(_,{size:16}),onClick:U,children:"添加 Flag"})]}),e.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["Flags: ","static{}, uuid{}, dynamic{}"]}),e.jsx("div",{className:"space-y-2",children:i.flags.map((a,s)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:a,onChange:r=>E(s,r.target.value),className:h,placeholder:`Flag ${s+1}`}),i.flags.length>1&&e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>B(s),children:e.jsx(F,{size:18})})]},s))})]}),i.type==="pods"&&e.jsxs("div",{className:"border-t border-neutral-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-mono text-neutral-50",children:"容器设置"}),e.jsx(x,{variant:"primary",size:"sm",align:"icon-left",icon:e.jsx(_,{size:16}),onClick:$,children:"添加容器"})]}),e.jsx("div",{className:"space-y-6",children:(i.dockers||[]).map((a,s)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"text-md font-mono text-neutral-50",children:["容器 ",s+1]}),i.dockers.length>1&&e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>f(s),children:e.jsx(F,{size:18})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400 mb-1",children:"镜像名称"}),e.jsx("input",{type:"text",value:a.image||"",onChange:r=>{const l={...a,image:r.target.value};p(s,l)},className:h,placeholder:"例如: username/image:tag"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"容器组号 (组号相同的 docker, 编写 Dockerfile 时请使用本地地址通信, 例: 127.0.0.1)"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("input",{type:"number",value:a.pod_group,onChange:r=>z(s,parseInt(r.target.value)),className:`${h} w-28`})})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"Hostname (容器组号不同的 docker, 编写 Dockerfile 时请使用 hostname 通信)"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("input",{type:"string",value:a.hostname,onChange:r=>P(s,r.target.value),className:`${h} w-28`})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"block text-sm font-mono text-neutral-400",children:["Flags: ","static{}, uuid{}, dynamic{}",", will be ENV: FLAG1, FLAG2..."]}),e.jsx(x,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(_,{size:14}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>w(s),children:"添加 Flag"})]}),e.jsx("div",{className:"space-y-2",children:(a.flags||[""]).map((r,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:r,onChange:d=>g(s,l,d.target.value),className:h,placeholder:`Flag ${l+1}`}),a.flags.length>1&&e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>c(s,l),children:e.jsx(F,{size:18})})]},l))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"开放端口"}),e.jsx(x,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(_,{size:14}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>b(s),children:"添加端口"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(a.ports||[0]).map((r,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"number",value:r,onChange:d=>y(s,l,d.target.value),className:`${h} w-28`,placeholder:`端口 ${l+1}`}),a.ports.length>1&&e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>u(s,l),children:e.jsx(F,{size:18})})]},l))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-mono text-neutral-400",children:"网络策略"}),e.jsx(x,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(_,{size:14}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300",onClick:()=>v(s),children:"添加策略"})]}),e.jsx("div",{className:"space-y-4",children:(a.network_policies||[]).map((r,l)=>e.jsxs("div",{className:"border border-neutral-700 rounded-md p-3 bg-black/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h5",{className:"text-sm font-mono text-neutral-200",children:["策略 ",l+1]}),e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>H(s,l),children:e.jsx(F,{size:16})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"入站规则"}),e.jsx(x,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(_,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>V(s,l,"from"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(r.from||[]).map((d,t)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"Hostname"}),r.from.length&&e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>X(s,l,"from",t),children:e.jsx(F,{size:12})})]}),e.jsx("input",{type:"text",value:d.hostname,onChange:n=>q(s,l,"from",t,n.target.value),className:`${h} text-sm mb-2`,placeholder:"Hostname"}),e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"})}),e.jsx("input",{type:"text",value:d.cidr,onChange:n=>J(s,l,"from",t,n.target.value),className:`${h} text-sm mb-2`,placeholder:"CIDR (例如: 192.168.0.0/16)"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"Except"}),e.jsx(x,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(_,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>K(s,l,"from",t),children:"添加"})]}),e.jsx("div",{className:"space-y-2",children:(d.except||[""]).map((n,o)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:n,onChange:m=>Y(s,l,"from",t,o,m.target.value),className:`${h} text-sm`,placeholder:"排除 CIDR"}),d.except.length>1&&e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>Q(s,l,"from",t,o),children:e.jsx(F,{size:14})})]},o))})]})]},t))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"出站规则"}),e.jsx(x,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(_,{size:12}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>V(s,l,"to"),children:"添加规则"})]}),e.jsx("div",{className:"space-y-2",children:(r.to||[]).map((d,t)=>e.jsxs("div",{className:"border border-neutral-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"Hostname"}),r.to.length&&e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>X(s,l,"to",t),children:e.jsx(F,{size:12})})]}),e.jsx("input",{type:"text",value:d.hostname,onChange:n=>q(s,l,"to",t,n.target.value),className:`${h} text-sm mb-2`,placeholder:"Hostname"}),e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"CIDR"})}),e.jsx("input",{type:"text",value:d.cidr,onChange:n=>J(s,l,"to",t,n.target.value),className:`${h} text-sm mb-2`,placeholder:"CIDR (例如: 192.168.0.0/16)"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-mono text-neutral-400",children:"Except"}),e.jsx(x,{variant:"ghost",size:"sm",align:"icon-left",icon:e.jsx(_,{size:10}),className:"!bg-transparent !text-geek-400 hover:!text-geek-300 !text-xs",onClick:()=>K(s,l,"to",t),children:"添加"})]}),e.jsx("div",{className:"space-y-2",children:(d.except||[""]).map((n,o)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:n,onChange:m=>Y(s,l,"to",t,o,m.target.value),className:`${h} text-sm`,placeholder:"排除 CIDR"}),d.except.length>1&&e.jsx(x,{variant:"ghost",size:"icon",className:"!bg-transparent !text-red-400 hover:!text-red-300",onClick:()=>Q(s,l,"to",t,o),children:e.jsx(F,{size:14})})]},o))})]})]},t))})]})]},l))})]})]},s))})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 border-t border-neutral-700",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:M,children:"取消"}),e.jsx(x,{variant:"primary",size:"sm",onClick:()=>S(i),children:C==="add"?"添加题目":"保存更改"})]})]})}):null}function ze(){const[R,C]=N.useState([]),[i,D]=N.useState(0),[M,S]=N.useState(1),[j,U]=N.useState("all"),[B,E]=N.useState([]),[h,O]=N.useState("all"),[G,$]=N.useState(!1),[f,p]=N.useState("add"),[z,P]=N.useState(null),[w,c]=N.useState({name:"",desc:"",category:"",type:"static",flags:[""],dockers:[{pod_group:0,flags:[""],image:"",ports:[0],hostname:"",network_policies:[]}]}),g=N.useRef(null),b=10;N.useEffect(()=>{u()},[]),N.useEffect(()=>{y()},[M,j,h]);const u=async()=>{try{const t=await le();if(t.code===200){const n=["Web","Misc","Pwn","Crypto","Reverse"],o=[...new Set([...n,...t.data||[]])];E(o)}else k.danger({description:t.msg||"获取题目分类失败"}),E(["Web","Misc","Pwn","Crypto","Reverse"])}catch(t){console.error("获取题目分类失败:",t),k.danger({description:"获取题目分类失败"}),E(["Web","Misc","Pwn","Crypto","Reverse"])}},y=async()=>{try{const t={limit:b,offset:(M-1)*b};j!=="all"&&(t.type=j),h!=="all"&&(t.category=h);const n=await ie(t);n.code===200?(C(n.data.challenges.map(o=>{let m=[];o.flags&&Array.isArray(o.flags)?m=o.flags:o.flag?m=[o.flag]:m=[""];let L=[];return o.dockers&&Array.isArray(o.dockers)&&o.dockers.length>0&&(L=o.dockers.map((A,W)=>{var I;return{pod_group:A.pod_group||W,image:A.image||"",ports:A.ports||[0],flags:A.flags||[""],hostname:A.hostname||"",network_policies:((I=A.network_policies)==null?void 0:I.map(Z=>({hostname:Z.hostname||"",from:Z.from||[],to:Z.to||[]})))||[]}})),{...o,flags:m,dockers:L}})),D(n.data.count)):k.danger({description:n.msg||"获取题目列表失败"})}catch(t){k.danger({description:"获取题目列表失败"}),console.error(t)}},v=t=>{U(t),S(1)},H=t=>{O(t),S(1)},V=()=>{p("add"),c({name:"",desc:"",category:"",type:"static",flags:[""],dockers:[{pod_group:0,flags:[""],image:"",ports:[0],hostname:"",network_policies:[]}]}),$(!0)},X=t=>{p("edit"),P(t),c(t),$(!0)},q=t=>{p("delete"),P(t),$(!0)},J=t=>{var n;(n=g.current)==null||n.click(),P(t)},K=async t=>{try{const n=await oe(t.id,"attachment.zip"),o=window.URL.createObjectURL(new Blob([n.data])),m=document.createElement("a");m.href=o,m.setAttribute("download","attachment.zip"),document.body.appendChild(m),m.click(),m.remove()}catch(n){console.error("下载附件失败:",n),k.danger({description:"下载附件失败"})}},Q=async t=>{var o;const n=(o=t.target.files)==null?void 0:o[0];if(t.target.value="",!!n){if(z.type==="static"&&n.name!=="attachment.zip"||z.type==="dynamic"&&n.name!=="generator.zip"||z.type==="pods"&&n.name!=="attachment.zip"){k.danger({description:"文件名必须与题目类型匹配"});return}try{const m=await ce(z.id,n);m.code===200?k.success({description:"上传附件成功"}):k.danger({description:m.msg||"上传附件失败"})}catch(m){console.error("上传附件失败:",m),k.danger({description:"上传附件失败"})}}},Y=t=>{c(t)},a=()=>{c({...w,flags:[...w.flags,""]})},s=t=>{const n=[...w.flags];n.splice(t,1),c({...w,flags:n})},r=(t,n)=>{const o=[...w.flags];o[t]=n,c({...w,flags:o})},l=()=>{$(!1)},d=async t=>{try{let n;const o={name:t.name,desc:t.desc,category:t.category,type:t.type};if(t.type==="static")o.flags=t.flags||[""];else if(t.type==="dynamic")o.flags=t.flags||[""],o.generator=t.generator||"";else if(t.type==="pods")t.dockers&&t.dockers.length>0&&(o.dockers=t.dockers.map((m,L)=>{var A;return{pod_group:m.pod_group||L,image:m.image||"",ports:m.ports||[0],flags:m.flags||[""],hostname:m.hostname||`container${L+1}`,network_policies:((A=m.network_policies)==null?void 0:A.map(W=>({hostname:W.hostname||"",from:W.from||[],to:W.to||[]})))||[]}}));else{k.danger({description:"错误的题目类型"});return}f==="add"?n=await de(o):f==="edit"?n=await me(z.id,o):n=await xe(z.id),n.code===200?(k.success({description:`${f==="add"?"创建":f==="edit"?"更新":"删除"}题目成功`}),$(!1),await y()):k.danger({description:n.msg||`${f==="add"?"创建":f==="edit"?"更新":"删除"}题目失败`})}catch(n){console.error(`${f==="add"?"创建":f==="edit"?"更新":"删除"}题目失败:`,n),k.danger({description:`${f==="add"?"创建":f==="edit"?"更新":"删除"}题目失败`})}};return e.jsxs(e.Fragment,{children:[e.jsx(he,{challenges:R,totalCount:i,currentPage:M,pageSize:b,categories:B,filterCategory:h,filterType:j,onPageChange:S,onAddChallenge:V,onEditChallenge:X,onDeleteChallenge:q,onUploadAttachment:J,onDownloadAttachment:K,onFilterTypeChange:v,onFilterCategoryChange:H}),e.jsx(ge,{isOpen:G,mode:f,challenge:w,categories:B,onClose:l,onSubmit:d,onChange:Y,onAddFlag:a,onRemoveFlag:s,onFlagChange:r}),e.jsx("input",{type:"file",ref:g,className:"hidden",onChange:Q})]})}export{ze as default};
